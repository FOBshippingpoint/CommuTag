!function(t){var e={};function a(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/dist/production",a(a.s=86)}([function(t,e,a){"use strict";function i(t,e,a,i,s,n,o,r){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=a,c._compiled=!0),i&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),o?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):s&&(l=r?function(){s.call(this,this.$root.$options.shadowRoot)}:s),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(t,e){return l.call(e),u(t,e)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,l):[l]}return{exports:t,options:c}}a.d(e,"a",(function(){return i}))},function(t,e,a){"use strict";var i,s=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},n=function(){var t={};return function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(t){a=null}t[e]=a}return t[e]}}(),o={};function r(t,e,a){for(var i=0;i<e.length;i++){var s={css:e[i][1],media:e[i][2],sourceMap:e[i][3]};o[t][i]?o[t][i](s):o[t].push(p(s,a))}}function l(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var s=a.nc;s&&(i.nonce=s)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var o=n(t.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(e)}return e}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function h(t,e,a,i){var s=a?"":i.css;if(t.styleSheet)t.styleSheet.cssText=u(e,s);else{var n=document.createTextNode(s),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(n,o[e]):t.appendChild(n)}}function d(t,e,a){var i=a.css,s=a.media,n=a.sourceMap;if(s?t.setAttribute("media",s):t.removeAttribute("media"),n&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var f=null,m=0;function p(t,e){var a,i,s;if(e.singleton){var n=m++;a=f||(f=l(e)),i=h.bind(null,a,n,!1),s=h.bind(null,a,n,!0)}else a=l(e),i=d.bind(null,a,e),s=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(a)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else s()}}t.exports=function(t,e,a){return(a=a||{}).singleton||"boolean"==typeof a.singleton||(a.singleton=s()),t=a.base?t+a.base:t,e=e||[],o[t]||(o[t]=[]),r(t,e,a),function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){o[t]||(o[t]=[]),r(t,e,a);for(var i=e.length;i<o[t].length;i++)o[t][i]();o[t].length=e.length,0===o[t].length&&delete o[t]}}}},function(t,e,a){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var a=function(t,e){var a=t[1]||"",i=t[3];if(!i)return a;if(e&&"function"==typeof btoa){var s=(o=i,r=btoa(unescape(encodeURIComponent(JSON.stringify(o)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),"/*# ".concat(l," */")),n=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[a].concat(n).concat([s]).join("\n")}var o,r,l;return[a].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(a,"}"):a})).join("")},e.i=function(t,a){"string"==typeof t&&(t=[[null,t,""]]);for(var i=0;i<t.length;i++){var s=[].concat(t[i]);a&&(s[2]?s[2]="".concat(a," and ").concat(s[2]):s[2]=a),e.push(s)}},e}},function(t,e,a){"use strict";var i={GetUrlParameter:function(){for(var t=window.location.search.substring(1).split("&"),e={},a=0;a<t.length;a++){var i=t[a].split("=");e[i[0]]=i[1]}return e},GetUrlHash:function(){for(var t=window.location.hash.substr(1).split("&"),e={},a=0;a<t.length;a++){var i=t[a].split("=");e[i[0]]=i[1]}return e},ValidateEmail:function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},PadLeft:function(t,e,a){var i=e-String(t).length+1;return i>0?new Array(i).join(a||"0")+t:t}};e.a=i},function(t,e,a){var i=a(1),s=a(29);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(39);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){"use strict";var i=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"location-select"},[e("div",{ref:"map",staticClass:"map"})])};i._withStripped=!0;var s={name:"location-select",props:{mode:String,initLoc:Object},components:{},data:function(){return{loc:null,status:"",OnGPSReady:null,map:null,locMarker:null,rangeMarker:null,range:10}},mounted:function(){this.InitMap()},methods:{InitMap:function(){switch(this.map=L.map(this.$refs.map).setView([23.682094,120.7764642],7),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="https://www.openstreetmap.org/">OSM</a>',maxZoom:18}).addTo(this.map),this.mode){case"selectLoc":this.map.on("click",function(t){var e=t.latlng;this.SetPosition(e.lat,e.lng)}.bind(this));break;case"selectRange":this.map.on("click",function(t){var e=t.latlng;this.SetRange(e.lat,e.lng,this.range)}.bind(this))}},SetPosition:function(t,e){t&&e&&(this.loc={lat:t,lng:e},this.status="座標: "+t.toFixed(5)+" "+e.toFixed(5),this.locMarker?this.locMarker.setLatLng(this.loc,{draggable:"selectLoc"==this.mode}).bindPopup(this.status).update():(this.locMarker=L.marker(this.loc,{draggable:"selectLoc"==this.mode}),this.locMarker.on("dragend",function(t){var e=this.locMarker.getLatLng();this.SetPosition(e.lat,e.lng)}.bind(this)),this.locMarker.addTo(this.map)),this.$emit("change"))},SetRange:function(t,e,a){t&&e&&(this.range=a,this.loc={lat:t,lng:e},this.status="座標: "+t.toFixed(5)+" "+e.toFixed(5),this.rangeMarker?(this.rangeMarker.setLatLng(this.loc),this.rangeMarker.setRadius(1e3*this.range)):(this.rangeMarker=L.circle(this.loc,{weight:1,color:"#ff0000",fillColor:"#ff3333",fillOpacity:.3,radius:1e3*this.range}),this.rangeMarker.addTo(this.map)),this.locMarker?this.locMarker.setLatLng(this.loc,{draggable:"selectRange"==this.mode}).bindPopup(this.status).update():(this.locMarker=L.marker(this.loc,{draggable:"selectRange"==this.mode}),this.locMarker.on("drag",function(t){var e=t.target.getLatLng();this.rangeMarker.setLatLng(e)}.bind(this)),this.locMarker.on("dragend",function(t){var e=this.locMarker.getLatLng();this.rangeMarker.setLatLng(e),this.loc={lat:e.lat,lng:e.lng},this.$emit("change")}.bind(this)),this.locMarker.addTo(this.map)),this.$emit("change"))},GetGPS:function(){this.status="無GPS-請點選位置",navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){switch(this.mode){case"selectLoc":this.SetPosition(t.coords.latitude,t.coords.longitude);break;case"selectRange":this.SetRange(t.coords.latitude,t.coords.longitude,this.range)}this.OnGPSReady&&this.OnGPSReady()}.bind(this),function(t){this.status="讀取GPS失敗-請點選位置"}.bind(this)):this.status="瀏覽器不支援GPS-請點選位置"},RemoveMarker:function(){this.locMarker&&(this.map.removeLayer(this.locMarker),this.locMarker=null),this.rangeMarker&&(this.map.removeLayer(this.rangeMarker),this.rangeMarker=null)}}},n=(a(38),a(0)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/vue/location-select.vue";e.a=o.exports},function(t,e,a){var i=a(1),s=a(41);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(43);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(45);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(47);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(49);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(51);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(53);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(55);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(57);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(59);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"topbar bg-grey-8 text-white"},[a("q-toolbar",{staticClass:"q-px-md",attrs:{square:""}},[t.useMenu?a("q-btn",{attrs:{flat:"",round:"",icon:"menu"},on:{click:function(e){return t.ToggleMenu()}}}):t._e(),t._v(" "),a("a",{attrs:{href:"/"}},[a("q-btn",{attrs:{flat:"","no-caps":""}},[a("q-avatar",{attrs:{size:"md",square:""}},[a("img",{attrs:{src:t.logo}})]),t._v(" "),a("div",{staticClass:"gt-xs q-px-md text-white text-h5 inline"},[t._v(t._s(t.title))])],1)],1),t._v(" "),a("q-space"),t._v(" "),t.user?a("q-item",{attrs:{clickable:"",tag:"a",href:"/account"}},[a("q-avatar",{attrs:{size:"lg"}},[a("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.user.icon}})]),t._v(" "),a("q-item-section",{staticClass:"q-px-sm"},[a("q-item-label",{staticClass:"text-h6"},[t._v(t._s(t.user.name))])],1)],1):a("q-item",{attrs:{clickable:"",tag:"a",href:"/login"}},[a("q-icon",{attrs:{size:"md",name:"account_box"}}),t._v(" "),a("q-item-section",[a("q-item-label",{staticClass:"text-h6"},[t._v("登入")])],1)],1)],1)],1)};i._withStripped=!0;var s={name:"topbar",props:{user:Object,useMenu:Boolean},data:function(){return{title:"",logo:"/static/image/logo.png"}},created:function(){$.get("/site-info",function(t){"ok"==t.status&&(this.title=t.data.title,this.logo=t.data.logo)}.bind(this))},methods:{ToggleMenu:function(){this.$emit("toggleMenu")}}},n=(a(28),a(0)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/vue/topbar.vue";e.a=o.exports},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"tag-select"},[a("q-select",{attrs:{filled:"",dense:"","bg-color":"grey-2","use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",options:t.tagArr},on:{filter:t.FilterTag,input:t.SelectTag},model:{value:t.selectTag,callback:function(e){t.selectTag=e},expression:"selectTag"}})],1)};i._withStripped=!0;var s={name:"tag-select",props:{dataset:Object},components:{},data:function(){return{tagArr:[],selectTag:""}},created:function(){},methods:{FilterTag:function(t,e,a){e(function(){this.tagArr=this.dataset.tagArr.filter(function(e){return e.indexOf(t)>-1}.bind(this))}.bind(this))},SelectTag:function(t){this.selectTag=t,this.$emit("change")}}},n=(a(52),a(0)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/vue/tag-select.vue";e.a=o.exports},function(t,e,a){"use strict";var i=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"image-upload"},[e("img",{directives:[{name:"show",rawName:"v-show",value:this.showPreview,expression:"showPreview"}],attrs:{src:this.imageData}}),this._v(" "),e("input",{ref:"uploadBt",attrs:{type:"file",hidden:""},on:{change:this.UpdateFile}})])};i._withStripped=!0;var s={name:"image-upload",props:{maxResW:{type:Number,default:1024},maxResH:{type:Number,default:1024},showPreview:Boolean,src:String},data:function(){return{file:null,imageData:null,url:"",additionData:{},OnSucc:null,OnFail:null,OnProgress:null,OnChange:null,maxW:1024,maxH:1024,uploading:!1}},created:function(){this.src&&(this.imageData=this.src),this.maxResW&&(this.maxW=this.maxResW),this.maxResH&&(this.maxH=this.maxResH)},methods:{SetMaxRes:function(t,e){this.maxW=t,this.maxH=e},SelectFile:function(){this.$refs.uploadBt.click()},UpdateFile:function(t){var e=t.target.files;if(FileReader&&e&&e.length){var a=new FileReader;a.onload=function(){var t=new Image;t.onload=function(){this.FitCanvasFromImage(t),this.OnChange&&this.OnChange()}.bind(this),t.src=a.result}.bind(this),this.file=e[0],a.readAsDataURL(e[0])}},FitCanvasFromImage:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var a=e.getContext("2d");a.save(),a.drawImage(t,0,0),a.restore();var i=this.maxW/t.width,s=this.maxH/t.height,n=Math.min(i,s),o=t.width*n,r=t.height*n,l=this.ResizeImage(e,o,r);this.imageData=l.toDataURL("image/jpeg",.9)},FitCanvasFromCanvas:function(t){var e=this.maxW/t.width,a=this.maxH/t.height,i=Math.min(e,a),s=t.width*i,n=t.height*i,o=this.ResizeImage(t,s,n);this.imageData=o.toDataURL("image/jpeg",.9)},CropImage:function(t,e,a,i,s){var n=document.createElement("canvas");n.width=i,n.height=s;var o=n.getContext("2d");return o.save(),o.drawImage(t,e,a,i,s,0,0,i,s),o.restore(),n},ResizeImage:function(t,e,a){for(var i=Math.max(.5*t.width,e),s=Math.max(.5*t.height,a),n=t;i>e||s>a;){(o=document.createElement("canvas")).width=i,o.height=s,o.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,i,s),n=o,i=Math.max(.5*n.width,e),s=Math.max(.5*n.height,a)}var o;return(o=document.createElement("canvas")).width=e,o.height=a,o.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,e,a),o},UploadImage:function(){if(!this.uploading){this.uploading=!0;var t=$("meta[name='csrf-token']").attr("content"),e=new FormData;for(var a in this.additionData)e.append(a,this.additionData[a]);e.append("uploadImage",this.imageData),$.ajax({url:this.url,headers:{"csrf-token":t},type:"POST",data:e,processData:!1,contentType:!1,xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&this.OnProgress&&t.upload.addEventListener("progress",this.OnProgress,!1),t}.bind(this),success:function(t){if(this.uploading=!1,"ok"!=t.status)switch(t.message){case"blacklist":return alert("黑名單使用者無此權限");default:return alert("上傳影像失敗")}if(this.OnSucc)return this.OnSucc(t)}.bind(this),error:function(t,e,a){if(this.uploading=!1,this.OnFail)return this.OnFail(a)}.bind(this)})}}}},n=(a(40),a(0)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/vue/image-upload.vue";e.a=o.exports},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"annotator-bbox"},[a("img",{ref:"srcImage",staticClass:"hidden",attrs:{src:t.image.url},on:{load:t.ChangeImage}}),t._v(" "),"view"==t.task?a("div",{staticClass:"column fit"},[a("div",{ref:"viewCanvas",staticClass:"col"})]):a("div",{staticClass:"column fit"},[a("div",{staticClass:"col q-ma-auto relative-position"},[a("div",{ref:"editCanvas",staticClass:"fit"}),t._v(" "),"annotate"==t.task?a("div",{staticClass:"tool-set"},[a("q-btn-toggle",{attrs:{glossy:"",size:"sm",options:t.toolOption,color:"grey-1","text-color":"grey-6"},on:{input:function(e){return t.ChangeTool()}},scopedSlots:t._u([{key:"bbox",fn:function(){return[a("q-icon",{attrs:{name:"aspect_ratio"}})]},proxy:!0},{key:"move",fn:function(){return[a("q-icon",{attrs:{name:"pan_tool"}})]},proxy:!0}],null,!1,1866943705),model:{value:t.tool,callback:function(e){t.tool=e},expression:"tool"}})],1):t._e()]),t._v(" "),"annotate"==t.task?a("q-banner",{staticClass:"bg-grey-6 text-white col-shrink",attrs:{"inline-actions":""},scopedSlots:t._u([{key:"action",fn:function(){return[a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"確定"},on:{click:function(e){return t.SetAnnotation()}}}),t._v(" "),a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"略過"},on:{click:function(e){return t.SkipTask()}}})]},proxy:!0}],null,!1,2135591169)},[a("div",{staticClass:"text-h6 inline-block"},[t._v("\n\t\t\t\t請框選出影像中的物件並給予標籤\n\t\t\t")])]):t._e(),t._v(" "),"verify"==t.task?a("q-banner",{staticClass:"bg-grey-6 text-white col-shrink",attrs:{"inline-actions":""},scopedSlots:t._u([{key:"action",fn:function(){return[a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"是"},on:{click:function(e){return t.SetVerification(!0)}}}),t._v(" "),a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"否"},on:{click:function(e){return t.SetVerification(!1)}}}),t._v(" "),a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"略過"},on:{click:function(e){return t.SkipTask()}}})]},proxy:!0}],null,!1,767176183)},[a("div",{staticClass:"text-h6 inline-block"},[t._v("\n\t\t\t\t請驗證此影像框選的物件及標籤是否正確?\n\t\t\t")])]):t._e()],1),t._v(" "),a("q-dialog",{attrs:{persistent:""},model:{value:t.openTagSelect,callback:function(e){t.openTagSelect=e},expression:"openTagSelect"}},[a("q-card",[a("q-card-section",[a("div",{staticClass:"text-h6 q-py-sm"},[t._v("請選擇標籤")]),t._v(" "),a("tag-select",{ref:"tagSelect",attrs:{dataset:t.dataset}})],1),t._v(" "),a("q-separator"),t._v(" "),a("q-card-actions",{attrs:{align:"around"}},[t.newRect?a("q-btn",{attrs:{flat:"",label:"新增"},on:{click:function(e){return t.AddAnnotation()}}}):a("q-btn",{attrs:{flat:"",label:"修改"},on:{click:function(e){return t.ConfirmTagSelect()}}}),t._v(" "),a("q-btn",{attrs:{flat:"",label:"取消"},on:{click:function(e){return t.CancelTagSelect()}}}),t._v(" "),t.target?a("q-btn",{attrs:{flat:"",label:"刪除"},on:{click:function(e){return t.RemoveAnnotation()}}}):t._e()],1)],1)],1),t._v(" "),a("q-dialog",{model:{value:t.openHelp,callback:function(e){t.openHelp=e},expression:"openHelp"}},[a("q-card",{staticClass:"full-width q-pa-sm"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("如何標註")]),t._v(" "),a("ul",{staticClass:"text-subtitle2"},[a("li",[t._v("框選出影像中所有符合標籤的物件並選擇對應的標籤，完成後按「確定」送出。")]),t._v(" "),a("li",[t._v("優良的標註應符合以下條件：\n\t\t\t\t\t\t"),a("ol",[a("li",[t._v("框選出所有符合標籤的物件並選擇正確的物件標籤")]),t._v(" "),a("li",[t._v("方框應完整涵蓋該物件可以看到的範圍(不包含被遮住的部分)，並且盡量逼近該物件的大小")]),t._v(" "),a("li",[t._v("一個方框只能框一個物件，若有多個物件請分不同方框框選")])])])]),t._v(" "),a("div",{staticClass:"text-h6"},[t._v("如何驗證")]),t._v(" "),a("ol",{staticClass:"text-subtitle2"},[a("li",[t._v("確認影像中框選出的物件標籤是否正確")]),t._v(" "),a("li",[t._v("確認方框是否完整涵蓋該物件可以看到的範圍(不包含被遮住的部分)，並且盡量逼近該物件的大小")]),t._v(" "),a("li",[t._v("確認一個方框只能框一個物件，若有多個物件需分成不同方框框選")]),t._v(" "),a("li",[t._v("確認是否已框選出所有符合標籤的物件")]),t._v(" "),a("li",[t._v("若以上條件皆符合即為優良的標註，按「是」送出。反之按「否」。")])]),t._v(" "),a("div",{staticClass:"text-h6"},[t._v("參考資料")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://vision.stanford.edu/pdf/bbox_submission.pdf",target:"_blank"}},[t._v("Su, H., Deng, J., & Fei-Fei, L. (2012). Crowdsourcing annotations for visual object detection. In AAAI human computation workshop.")])]),t._v(" "),a("li",[a("a",{attrs:{href:"https://chtseng.wordpress.com/2019/03/10/ai%e9%a0%98%e5%9f%9f%e7%9a%84%e8%97%8d%e9%a0%98%e5%b7%a5%e4%bd%9c-image-labeling/",target:"_blank"}},[t._v("AI領域的藍領工作- Image Labeling")])])])]),t._v(" "),a("q-card-actions",{staticClass:"justify-center"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"確定"}})],1)],1)],1)],1)};i._withStripped=!0;var s={name:"annotator-bbox",components:{"tag-select":a(18).a},props:{dataset:Object,image:Object,task:String},data:function(){return{openHelp:!1,openTagSelect:!1,tool:"move",toolOption:[{value:"bbox",slot:"bbox"},{value:"move",slot:"move"}],container:null,stage:null,imageLayer:null,bboxLayer:null,imageNode:null,annotationArr:[],gesture:"",lastTouch:null,newRect:null,target:null,labelColor:{}}},mounted:function(){this.GenLabelColor(),this.InitCanvas()},methods:{GetRelativeMousePos:function(t){var e=t.getAbsoluteTransform().copy();e.invert();var a=t.getStage().getPointerPosition();return e.point(a)},HSVtoRGB:function(t,e,a,i){var s,n,o,r,l,c,u,h;switch(1===arguments.length&&(e=t.s,a=t.v,t=t.h),c=a*(1-e),u=a*(1-(l=6*t-(r=Math.floor(6*t)))*e),h=a*(1-(1-l)*e),r%6){case 0:s=a,n=h,o=c;break;case 1:s=u,n=a,o=c;break;case 2:s=c,n=a,o=h;break;case 3:s=c,n=u,o=a;break;case 4:s=h,n=c,o=a;break;case 5:s=a,n=c,o=u}return"rgba("+(s=Math.round(255*s))+","+(n=Math.round(255*n))+","+(o=Math.round(255*o))+","+i+")"},GenLabelColor:function(){this.labelColor={};for(var t=this.dataset.tagArr.length,e=0;e<t;e++){var a=e%5*.2,i=1-parseInt(.2*e)%5*.2,s=1-parseInt(.2*e*.2)%5*.2,n=this.HSVtoRGB(a,i,s,1),o=this.dataset.tagArr[e];this.labelColor[o]=n}},BoundInImage:function(t){var e=this.imageNode.absolutePosition(),a=this.imageNode.size(),i=this.imageNode.getAbsoluteScale();return t.x<e.x&&(t.x=e.x),t.x>=e.x+a.width*i.x&&(t.x=e.x+a.width*i.x),t.y<e.y&&(t.y=e.y),t.y>=e.y+a.height*i.y&&(t.y=e.y+a.height*i.y),t},BoundStage:function(t){var e=this.stage.size(),a=this.imageNode.size(),i=this.stage.scale(),s=.5*(e.width-a.width)*i.x,n=.5*(e.height-a.height)*i.y,o=.5*(e.width+a.width)*i.x,r=.5*(e.height+a.height)*i.y;return a.width*i.x>e.width?t.x+s>0?t.x=-s:t.x+o<e.width&&(t.x=e.width-o):t.x+s<0?t.x=-s:t.x+o>e.width&&(t.x=e.width-o),a.height*i.y>e.height?t.y+n>0?t.y=-n:t.y+r<e.height&&(t.y=e.height-r):t.y+n<0?t.y=-n:t.y+r>e.height&&(t.y=e.height-r),t},InitCanvas:function(){this.container="view"==this.task?this.$refs.viewCanvas:this.$refs.editCanvas,this.stage=new Konva.Stage({container:this.container,width:this.container.clientWidth,height:this.container.clientHeight,draggable:!1,dragBoundFunc:this.BoundStage}),this.stage.content.style.margin="auto",this.tool="annotate"==this.task?"bbox":"move",this.ChangeTool(),this.stage.on("wheel",function(t){t.evt.preventDefault();var e=this.stage.scaleX(),a=t.evt.deltaY>0?.95*e:e/.95;a<1&&(a=1);var i=this.stage.getPointerPosition(),s=(i.x-this.stage.x())/e,n=(i.y-this.stage.y())/e;this.stage.scale({x:a,y:a});var o={x:-s*a+i.x,y:-n*a+i.y};o=this.BoundStage(o),this.stage.position(o),this.stage.batchDraw()}.bind(this)),this.stage.on("mousedown touchstart",function(t){if("touchstart"==t.type&&2==t.evt.touches.length)this.gesture="pinch",this.lastTouch=t;else if(this.gesture="drag","bbox"==this.tool){if(""!=t.target.name())return;var e=this.GetRelativeMousePos(this.stage);e=this.BoundInImage(e),this.lastTouch=this.stage.getPointerPosition(),this.newRect&&this.newRect.destroy(),this.newRect=new Konva.Rect({x:e.x,y:e.y,width:0,height:0,fill:"rgba(0,0,0,0)",stroke:"#ffffff"}),this.bboxLayer.add(this.newRect)}this.stage.batchDraw()}.bind(this)),this.stage.on("mousemove touchmove",function(t){if("pinch"==this.gesture){var e=this.lastTouch.evt.touches[0],a=this.lastTouch.evt.touches[1],i=t.evt.touches[0],s=t.evt.touches[1];if(this.lastTouch=t,!(e&&a&&i&&s))return;function n(t,e){var a=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(a*a+i*i)}var o=n(e,a),r=n(i,s),l=this.stage.scaleX(),c=r/o;c>1.1?c=1.1:c<.9&&(c=.9);var u=l*c;u<1&&(u=1);var h={x:.5*(i.clientX+s.clientX),y:.5*(i.clientY+s.clientY)},d={x:(h.x-this.stage.x())/l,y:(h.y-this.stage.y())/l};this.stage.scale({x:u,y:u});var f={x:-d.x*u+h.x,y:-d.y*u+h.y};f=this.BoundStage(f),this.stage.position(f)}else if("drag"==this.gesture)if("bbox"==this.tool){if(!this.newRect)return;var m=this.GetRelativeMousePos(this.stage);m=this.BoundInImage(m);var p=this.newRect.position();this.newRect.setAttrs({width:m.x-p.x,height:m.y-p.y})}else if("move"==this.tool){m=this.stage.getPointerPosition();if(!this.lastTouch)return void(this.lastTouch=m);var g=this.stage.position();f={x:g.x+m.x-this.lastTouch.x,y:g.y+m.y-this.lastTouch.y};this.lastTouch=m,f=this.BoundStage(f),this.stage.position(f)}this.stage.batchDraw()}.bind(this)),this.stage.on("mouseup touchend",function(t){if(this.lastTouch=null,"pinch"==this.gesture)this.gesture="";else if("drag"==this.gesture){if(this.gesture="","bbox"!=this.tool)return;if(!this.newRect)return;var e=this.newRect.size();if(Math.abs(e.width)<10||Math.abs(e.height)<10)return this.CancelTagSelect();this.openTagSelect=!0}}.bind(this)),this.imageLayer=new Konva.Layer,this.bboxLayer=new Konva.Layer,this.stage.add(this.imageLayer),this.stage.add(this.bboxLayer)},ChangeTool:function(){switch(this.tool){case"move":this.container.style.cursor="grab";break;case"bbox":this.container.style.cursor="default"}},ConfirmTagSelect:function(){if(this.target){var t=this.$refs.tagSelect.selectTag;if(!t||""==t)return alert("請選擇標籤");this.target.tag=t;var e=this.labelColor[t];this.target.node.find("Rect")[0].setAttr("stroke",e);var a=this.target.node.find("Label")[0];a.getTag().setAttr("fill",e),a.getText().text(t),this.target=null,this.openTagSelect=!1,this.stage.batchDraw()}},CancelTagSelect:function(){this.openTagSelect=!1,this.target=null,this.newRect&&(this.newRect.destroy(),this.newRect=null),this.stage.batchDraw()},AddAnnotation:function(){if(this.newRect){var t=this.$refs.tagSelect.selectTag;if(!t||""==t)return alert("請選擇標籤");var e=this.newRect.position(),a=this.newRect.size();a.width<0&&(e.x=e.x+a.width,a.width=-a.width),a.height<0&&(e.y=e.y+a.height,a.height=-a.height);var i=new Konva.Group;this.bboxLayer.add(i);var s=new Konva.Rect({x:e.x,y:e.y,width:a.width,height:a.height,fill:"rgba(0,0,0,0)",stroke:this.labelColor[t]});i.add(s);var n=new Konva.Label({x:e.x,y:e.y-20});n.add(new Konva.Tag({fill:this.labelColor[t]})),n.add(new Konva.Text({text:t,padding:5,fill:"#ffffff",name:"BBoxLabel"})),n.on("click tap",function(t){this.openTagSelect=!0,this.target=o,Vue.nextTick(function(){this.$refs.tagSelect.selectTag=o.tag}.bind(this))}.bind(this)),i.add(n);var o={tag:t,x:e.x,y:e.y,width:a.width,height:a.height,node:i,index:this.annotationArr.length};this.annotationArr.push(o);var r=function(t){var e=i.find(".LT")[0],a=i.find(".RT")[0],r=i.find(".RB")[0],l=i.find(".LB")[0];switch(t.getName()){case"LT":l.x(t.x()),a.y(t.y());break;case"RT":r.x(t.x()),e.y(t.y());break;case"RB":a.x(t.x()),l.y(t.y());break;case"LB":e.x(t.x()),r.y(t.y())}for(var c=[e,a,r,l],u=Number.MAX_VALUE,h=Number.MAX_VALUE,d=Number.MIN_VALUE,f=Number.MIN_VALUE,m=0;m<c.length;m++){var p=c[m].position(),g=c[m].size(),v=p.x+.5*g.width,b=p.y+.5*g.height;v<u&&(u=v),v>d&&(d=v),b<h&&(h=b),b>f&&(f=b)}var x=d-u,_=f-h;s.setAttrs({x:u,y:h,width:x,height:_}),o.x=u,o.y=h,o.width=x,o.height=_,n.setAttrs({x:u,y:h-20}),this.stage.batchDraw()}.bind(this),l=function(t,e,a,i){var s=new Konva.Rect({x:e-5,y:a-5,width:10,height:10,fill:"#ffffff",stroke:"#3333ff",name:i,draggable:!0,dragBoundFunc:function(t){return t.x+=5,t.y+=5,(t=this.BoundInImage(t)).x-=5,t.y-=5,t}.bind(this)});s.on("dragmove",function(){r(s)}.bind(this)),t.add(s)}.bind(this);l(i,e.x,e.y,"LT"),l(i,e.x+a.width,e.y,"RT"),l(i,e.x+a.width,e.y+a.height,"RB"),l(i,e.x,e.y+a.height,"LB"),this.openTagSelect=!1,this.newRect.destroy(),this.newRect=null,this.stage.batchDraw()}},RemoveAnnotation:function(){this.target&&(this.target.node.destroy(),this.annotationArr.splice(this.target.index,1),this.target=null,this.openTagSelect=!1,this.stage.batchDraw())},ChangeImage:function(){this.imageNode&&this.imageNode.destroy();for(var t=0;t<this.annotationArr.length;t++){this.annotationArr[t].node.destroy()}this.annotationArr=[];var e=this.$refs.srcImage,a=this.container.clientWidth,i=this.container.clientHeight,s=a/e.width,n=i/e.height,o=Math.min(s,n),r=e.width*o,l=e.height*o;this.imageNode=new Konva.Image({x:.5*(a-r),y:.5*(i-l),width:r,height:l,image:e}),this.imageLayer.add(this.imageNode),"view"!=this.task&&"verify"!=this.task||this.DrawAnnotation(),this.stage.batchDraw()},DrawAnnotation:function(){if(this.image.annotation){for(var t=this.imageNode.position(),e=this.imageNode.size(),a=this.$refs.srcImage,i=0;i<this.image.annotation.annotation.length;i++){var s=this.image.annotation.annotation[i],n=parseFloat(s.x),o=parseFloat(s.y),r=parseFloat(s.width),l=parseFloat(s.height),c=new Konva.Group;this.bboxLayer.add(c);var u={x:n,y:o},h={x:n+r,y:o+l};u.x=u.x*e.width/a.width+t.x,u.y=u.y*e.height/a.height+t.y,h.x=h.x*e.width/a.width+t.x,h.y=h.y*e.height/a.height+t.y;var d=new Konva.Rect({x:u.x,y:u.y,width:h.x-u.x,height:h.y-u.y,fill:"rgba(0,0,0,0)",stroke:this.labelColor[s.tag]});c.add(d);var f=new Konva.Label({x:u.x,y:u.y-18});f.add(new Konva.Tag({fill:this.labelColor[s.tag]})),f.add(new Konva.Text({text:s.tag,padding:3,fill:"#ffffff",name:"BBoxLabel"})),c.add(f);var m={tag:s.tag,x:d.x(),y:d.y(),width:d.width(),height:d.height(),node:c,index:this.annotationArr.length};this.annotationArr.push(m)}this.stage.batchDraw()}},SetAnnotation:function(){if(0==this.annotationArr.length)return alert("請至少新增一個標籤");this.$emit("setAnnotation")},SetVerification:function(t){this.$emit("setVerification",t)},GetAnnotation:function(){for(var t=[],e=this.imageNode.position(),a=this.imageNode.size(),i=this.$refs.srcImage,s=0;s<this.annotationArr.length;s++){var n=this.annotationArr[s],o={},r={x:n.x,y:n.y},l={x:n.x+n.width,y:n.y+n.height};r.x=(r.x-e.x)*i.width/a.width,r.y=(r.y-e.y)*i.height/a.height,l.x=(l.x-e.x)*i.width/a.width,l.y=(l.y-e.y)*i.height/a.height,o.x=r.x,o.y=r.y,o.width=l.x-r.x,o.height=l.y-r.y,o.tag=n.tag,t.push(o)}return t},SkipTask:function(){this.$emit("skipTask")}}},n=(a(56),a(0)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/vue/annotator-bbox.vue";e.a=o.exports},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"annotator-image"},["view"==t.task?a("div",{staticClass:"column fit"},[a("q-img",{staticClass:"col",attrs:{contain:"",src:t.image.url}},[t.image.annotation?a("div",{staticClass:"absolute-bottom text-subtitle1 text-center"},[t._v("\n\t\t\t\t"+t._s(t.image.annotation.annotation)+"\n\t\t\t")]):t._e()])],1):a("div",{staticClass:"column fit"},[a("q-img",{staticClass:"col q-my-md",attrs:{contain:"",src:t.image.url}}),t._v(" "),"annotate"==t.task?a("q-banner",{staticClass:"bg-grey-6 text-white col-shrink",attrs:{"inline-actions":""},scopedSlots:t._u([{key:"action",fn:function(){return[a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"確定"},on:{click:function(e){return t.SetAnnotation()}}}),t._v(" "),a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"略過"},on:{click:function(e){return t.SkipTask()}}})]},proxy:!0}],null,!1,2135591169)},[a("div",{staticClass:"row items-center"},[a("div",{staticClass:"text-h6 inline-block"},[t._v("\n\t\t\t\t\t請選擇符合此影像的標籤\n\t\t\t\t")]),t._v(" "),a("tag-select",{ref:"tagSelect",staticClass:"tag-select",attrs:{dataset:t.dataset}})],1)]):t._e(),t._v(" "),"verify"==t.task?a("q-banner",{staticClass:"bg-grey-6 text-white col-shrink",attrs:{"inline-actions":""},scopedSlots:t._u([{key:"action",fn:function(){return[a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"是"},on:{click:function(e){return t.SetVerification(!0)}}}),t._v(" "),a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"否"},on:{click:function(e){return t.SetVerification(!1)}}}),t._v(" "),a("q-btn",{staticClass:"q-ma-xs bg-primary",attrs:{label:"略過"},on:{click:function(e){return t.SkipTask()}}})]},proxy:!0}],null,!1,767176183)},[a("div",{staticClass:"text-h6 inline-block"},[t._v("\n\t\t\t\t請驗證此影像是否為 "+t._s(t.image.annotation.annotation)+"?\n\t\t\t")])]):t._e()],1),t._v(" "),a("q-dialog",{model:{value:t.openHelp,callback:function(e){t.openHelp=e},expression:"openHelp"}},[a("q-card",{staticClass:"full-width q-pa-sm"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("如何標註")]),t._v(" "),a("ul",{staticClass:"text-subtitle2"},[a("li",[t._v("選擇符合此影像的標籤並按「確定」。")])]),t._v(" "),a("div",{staticClass:"text-h6"},[t._v("如何驗證")]),t._v(" "),a("ul",{staticClass:"text-subtitle2"},[a("li",[t._v("若此影像符合選擇的標籤，按「是」。反之按「否」。")])])]),t._v(" "),a("q-card-actions",{staticClass:"justify-center"},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"確定"}})],1)],1)],1)],1)};i._withStripped=!0;var s={name:"annotator-image",components:{"tag-select":a(18).a},props:{dataset:Object,image:Object,task:String,status:String},data:function(){return{openHelp:!1}},mounted:function(){},methods:{SetAnnotation:function(){this.$emit("setAnnotation")},SetVerification:function(t){this.$emit("setVerification",t)},GetAnnotation:function(){return this.$refs.tagSelect.selectTag},SkipTask:function(){this.$emit("skipTask")}}},n=(a(54),a(0)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/vue/annotator-image.vue";e.a=o.exports},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"dataset-select full-width q-pa-sm"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("選擇資料集")]),t._v(" "),t.lastDataset?a("div",[a("div",{staticClass:"text-subtitle2"},[t._v("上次使用")]),t._v(" "),a("q-item",{attrs:{clickable:"",active:-1==t.selectIndex,"active-class":"bg-green-2"},on:{click:function(e){return t.SelectItem(-1)},dblclick:function(e){return t.ConfirmSelect()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{attrs:{square:"",rounded:""}},[a("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.lastDataset.picCover||"/static/image/logo-16-9.png"}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[t._v(t._s(t.lastDataset.name))])],1)],1)],1):t._e(),t._v(" "),a("q-scroll-area",{staticStyle:{height:"300px"}},[a("q-infinite-scroll",{ref:"datasetScroll",on:{load:t.LoadMoreDataset},scopedSlots:t._u([{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}])},[a("q-input",{attrs:{placeholder:"輸入篩選文字",outlined:"",dense:"",square:""},on:{change:function(e){return t.ReloadDataset()}},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),t._v(" "),a("q-list",{attrs:{bordered:"",separator:""}},t._l(t.datasetArr,(function(e,i){return a("q-item",{key:i,attrs:{clickable:"",active:t.selectIndex==i,"active-class":"bg-green-2"},on:{click:function(e){return t.SelectItem(i)},dblclick:function(e){return t.ConfirmSelect()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{attrs:{square:"",rounded:""}},[a("img",{staticStyle:{"object-fit":"cover"},attrs:{src:e.picCover||"/static/image/logo-16-9.png"}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[t._v(t._s(e.name))])],1)],1)})),1)],1)],1)],1),t._v(" "),a("q-card-actions",{staticClass:"justify-center"},[a("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){return t.ConfirmSelect()}}}),t._v(" "),a("q-btn",{attrs:{flat:"",label:"取消"},on:{click:function(e){return t.CancelSelect()}}})],1)],1)};i._withStripped=!0;var s={name:"dataset-select",props:{forUpload:Boolean,forAnnotation:Boolean},components:{},data:function(){return{searchKey:"",datasetArr:[],hasMore:!0,selectIndex:-1,lastDataset:{}}},created:function(){this.GetLastDataset()},methods:{GetLastDataset:function(){window.localStorage;this.lastDataset=JSON.parse(localStorage.getItem("lastDataset"))},SetLastDataset:function(t){window.localStorage;localStorage.setItem("lastDataset",JSON.stringify(t))},LoadMoreDataset:function(t,e){var a="/dataset/list-dataset";a+="?page="+(t-1),a+="&sort=updatedAt",a+="&orderType=desc",this.forUpload&&(a+="&enableUpload=1"),this.forAnnotation&&(a+="&enableAnnotation=1"),a+="&keyword="+this.searchKey,$.get(a,function(t){"ok"==t.status&&(this.hasMore=t.data.hasMore,this.hasMore||this.$refs.datasetScroll.stop(),this.datasetArr=this.datasetArr.concat(t.data.dataset),e())}.bind(this))},ReloadDataset:function(){this.datasetArr=[],this.$refs.datasetScroll.reset(),this.$refs.datasetScroll.resume(),this.selectIndex=-1},GetSelectDataset:function(){return-1==this.selectIndex&&this.lastDataset?this.lastDataset:this.selectIndex<0||this.selectIndex>=this.datasetArr.length?null:this.datasetArr[this.selectIndex]},SelectItem:function(t){this.selectIndex=t,this.$emit("change")},ConfirmSelect:function(){return-1==this.selectIndex&&this.lastDataset?this.$emit("confirm"):this.selectIndex<0||this.selectIndex>=this.datasetArr.length?alert("請選擇資料集"):(this.SetLastDataset(this.datasetArr[this.selectIndex]),void this.$emit("confirm"))},CancelSelect:function(){this.$emit("cancel")}}},n=(a(48),a(0)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/vue/dataset-select.vue";e.a=o.exports},function(t,e,a){var i=a(1),s=a(24);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){(e=a(2)(!1)).push([t.i,'html,body{height:100%;margin:0;padding:0;background-color:#edffef}*{box-sizing:border-box;font-family:"微軟正黑體", "Microsoft JhengHei"}\n',""]),t.exports=e},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"user-select full-width q-pa-sm"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("選擇使用者")]),t._v(" "),a("q-scroll-area",{staticStyle:{height:"300px"}},[a("q-infinite-scroll",{ref:"userScroll",on:{load:t.LoadMoreUser},scopedSlots:t._u([{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}])},[a("q-input",{attrs:{placeholder:"輸入篩選文字",outlined:"",dense:"",square:""},on:{change:function(e){return t.ReloadUser()}},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),t._v(" "),a("q-list",{attrs:{bordered:"",separator:""}},t._l(t.userArr,(function(e,i){return a("q-item",{key:i,attrs:{clickable:"",active:t.selectIndex==i,"active-class":"bg-green-2"},on:{click:function(e){return t.SelectItem(i)},dblclick:function(e){return t.ConfirmSelect()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",[a("img",{attrs:{src:e.icon}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[t._v(t._s(e.name))]),t._v(" "),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.contactEmail))])],1)],1)})),1)],1)],1)],1),t._v(" "),a("q-card-actions",{staticClass:"justify-center"},[a("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){return t.ConfirmSelect()}}}),t._v(" "),a("q-btn",{attrs:{flat:"",label:"取消"},on:{click:function(e){return t.CancelSelect()}}})],1)],1)};i._withStripped=!0;var s={name:"user-select",props:{},components:{},data:function(){return{searchKey:"",userArr:[],hasMore:!0,selectIndex:-1}},created:function(){},methods:{LoadMoreUser:function(t,e){var a="/user/list-user";a+="?page="+(t-1),a+="&keyword="+this.searchKey,$.get(a,function(t){"ok"==t.status&&(this.hasMore=t.data.hasMore,this.hasMore||this.$refs.userScroll.stop(),this.userArr=this.userArr.concat(t.data.user),e())}.bind(this))},ReloadUser:function(){this.userArr=[],this.$refs.userScroll.reset(),this.$refs.userScroll.resume(),this.selectIndex=-1},GetSelectUser:function(){return this.selectIndex<0||this.selectIndex>=this.userArr.length?null:this.userArr[this.selectIndex]},SelectItem:function(t){this.selectIndex=t,this.$emit("change")},ConfirmSelect:function(){if(this.selectIndex<0||this.selectIndex>=this.userArr.length)return alert("請選擇使用者");this.$emit("confirm")},CancelSelect:function(){this.$emit("cancel")}}},n=(a(42),a(0)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/vue/user-select.vue";e.a=o.exports},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.dataset?a("q-card",{staticClass:"image-info full-width q-pa-sm"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("選擇資料時間")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.dataTime,expression:"dataTime"}],staticClass:"q-pa-sm",attrs:{type:"datetime-local"},domProps:{value:t.dataTime},on:{change:function(e){return t.$emit("change")},input:function(e){e.target.composing||(t.dataTime=e.target.value)}}})]),t._v(" "),t.dataset.enableGPS?a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("選擇資料地點")]),t._v(" "),a("location-select",{ref:"locationSelect",attrs:{mode:"selectLoc"}}),t._v(" "),t.$refs.locationSelect?a("div",{staticClass:"text-center"},[t._v(t._s(t.$refs.locationSelect.status))]):t._e()],1):t._e(),t._v(" "),a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("資料備註說明(若無備註說明請直接按確定)")]),t._v(" "),a("q-input",{attrs:{filled:"",type:"textarea"},on:{input:function(e){return t.$emit("change")}},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1),t._v(" "),a("q-card-actions",{staticClass:"justify-center"},[a("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){return t.ConfirmSelect()}}}),t._v(" "),a("q-btn",{attrs:{flat:"",label:"取消"},on:{click:function(e){return t.CancelSelect()}}})],1)],1):t._e()};i._withStripped=!0;var s=a(6),n={name:"image-info",props:{dataset:Object,initDataTime:String,initLat:Number,initLng:Number,initRemark:String},components:{"location-select":s.a},data:function(){return{dataTime:null,remark:""}},mounted:function(){var t=spacetime().name;this.initDataTime?this.dataTime=spacetime(this.initDataTime).goto(t).unixFmt("yyyy-MM-ddTHH:mm"):this.dataTime=spacetime.now().unixFmt("yyyy-MM-ddTHH:mm"),this.initLat&&this.initLng?this.$refs.locationSelect.SetPosition(this.initLat,this.initLng):this.dataset.enableGPS&&this.$refs.locationSelect.GetGPS(),this.initRemark&&(this.remark=this.initRemark)},methods:{GetImageInfo:function(){var t={},e=spacetime.now();return t.dataTime=spacetime(this.dataTime,e.timezone().name).format("iso"),t.remark=this.remark,this.$refs.locationSelect&&(t.loc=this.$refs.locationSelect.loc),t},ConfirmSelect:function(){this.$emit("confirm")},CancelSelect:function(){this.$emit("cancel")}}},o=(a(50),a(0)),r=Object(o.a)(n,i,[],!1,null,null,null);r.options.__file="src/vue/image-info.vue";e.a=r.exports},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-list q-pa-sm"},[a("div",{staticClass:"row items-center"},[t.enableAdd?a("div",{staticClass:"col-shrink q-pr-lg"},[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"add",label:"新增名單"},on:{click:function(e){t.openUserSelect=!0}}})],1):t._e(),t._v(" "),t.enableSearch?a("div",{staticClass:"col-12 col-sm-6 col-md-3"},[a("q-input",{attrs:{label:"搜尋名單"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.ReloadUserList()}},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"search"},on:{click:function(e){return t.ReloadUserList()}}})]},proxy:!0}],null,!1,1309159698),model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1):t._e()]),t._v(" "),a("q-list",{staticClass:"q-my-md",attrs:{bordered:""}},t._l(t.userArr,(function(e,i){return a("q-item",{key:e._id},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",[a("img",{attrs:{src:e.icon}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[t._v(t._s(e.name))]),t._v(" "),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.contactEmail))])],1),t._v(" "),t.enableRemove?a("q-item-section",{attrs:{side:""}},[a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",icon:"close"},on:{click:function(e){return t.RemoveUser(i)}}})],1):t._e()],1)})),1),t._v(" "),t.list?t._e():a("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.hasMoreUser,expression:"hasMoreUser"}],staticClass:"full-width bg-grey-4 q-ma-sm",attrs:{label:"載入更多"},on:{click:function(e){return t.LoadMoreUserList()}}}),t._v(" "),a("q-dialog",{model:{value:t.openUserSelect,callback:function(e){t.openUserSelect=e},expression:"openUserSelect"}},[a("user-select",{ref:"userSelect",on:{confirm:function(e){return t.AddUser()},cancel:function(e){t.openUserSelect=!1}}})],1)],1)};i._withStripped=!0;var s=a(25),n={name:"user-list",props:{enableAdd:Boolean,enableSearch:Boolean,enableRemove:Boolean,userAuth:String,userStatus:String,list:Array},components:{"user-select":s.a},data:function(){return{searchKey:"",userArr:[],userPage:0,hasMoreUser:!0,openUserSelect:!1}},created:function(){this.list?this.userArr=this.list:this.LoadMoreUserList()},methods:{LoadMoreUserList:function(){var t="/user/list-user";t+="?page="+this.userPage,t+="&keyword="+this.searchKey,this.userAuth&&(t+="&authType="+this.userAuth),this.userStatus&&(t+="&status="+this.userStatus),$.get(t,function(t){"ok"==t.status&&(this.hasMoreUser=t.data.hasMore,this.userArr=this.userArr.concat(t.data.user),this.userPage++)}.bind(this))},ClearUserList:function(){this.userArr=[],this.userPage=0},ReloadUserList:function(){this.ClearUserList(),this.list?this.userArr=this.list.filter((function(t){return-1!=t.name.indexOf(this.searchKey)||-1!=t.contactEmail.indexOf(this.searchKey)})):this.LoadMoreUserList()},AddUser:function(){this.openUserSelect=!1;var t=this.$refs.userSelect.GetSelectUser();t&&this.$emit("add",t)},RemoveUser:function(t){this.$emit("remove",t)}}},o=(a(44),a(0)),r=Object(o.a)(n,i,[],!1,null,null,null);r.options.__file="src/vue/user-list.vue";e.a=r.exports},function(t,e,a){"use strict";var i=a(4);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".topbar{width:100%}.topbar a{text-decoration:none}\n",""]),t.exports=e},function(t,e,a){var i=a(1),s=a(75);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(77);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(79);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},function(t,e,a){var i=a(1),s=a(81);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},,,function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"dataset-editor"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("編輯資料集")])]),t._v(" "),a("q-card-section",[a("q-form",[a("q-item",[a("div",{staticClass:"cover-container bg-grey-7"},[a("image-upload",{ref:"uploader",attrs:{src:t.info.picCover||"/static/image/logo-16-9.png",showPreview:"",maxResW:parseInt(t.info.maxWidth),maxResH:parseInt(t.info.maxHeight)}}),t._v(" "),a("q-btn",{staticClass:"change-bt",attrs:{loading:t.uploadCover,flat:"",label:"變更封面"},on:{click:function(e){return t.ChangeCover()}}})],1)]),t._v(" "),a("div",{staticClass:"row"},[a("q-input",{ref:"name",staticClass:"col-12 q-pa-sm",attrs:{label:"資料集名稱",rules:[function(t){return!!t||"資料集名稱不能空白"}]},model:{value:t.info.name,callback:function(e){t.$set(t.info,"name",e)},expression:"info.name"}}),t._v(" "),a("q-input",{staticClass:"full-width q-px-sm",attrs:{label:"資料集簡介",filled:"",type:"textarea"},model:{value:t.info.desc,callback:function(e){t.$set(t.info,"desc",e)},expression:"info.desc"}}),t._v(" "),a("q-input",{ref:"maxWidth",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{type:"number",label:"最大寬度",rules:[function(t){return!!t||"最大寬度不能空白"},function(t){return t>=32||"最大寬度不能小於32"},function(t){return t<=1920||"最大寬度不能大於1920"}]},model:{value:t.info.maxWidth,callback:function(e){t.$set(t.info,"maxWidth",e)},expression:"info.maxWidth"}}),t._v(" "),a("q-input",{ref:"maxHeight",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{type:"number",label:"最大高度",rules:[function(t){return!!t||"最大高度不能空白"},function(t){return t>=32||"最大高度不能小於32"},function(t){return t<=1920||"最大高度不能大於1920"}]},model:{value:t.info.maxHeight,callback:function(e){t.$set(t.info,"maxHeight",e)},expression:"info.maxHeight"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"公開資料集"},model:{value:t.info.isPublic,callback:function(e){t.$set(t.info,"isPublic",e)},expression:"info.isPublic"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"開放上傳影像"},model:{value:t.info.enableUpload,callback:function(e){t.$set(t.info,"enableUpload",e)},expression:"info.enableUpload"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"開放下載資料集"},model:{value:t.info.enableDownload,callback:function(e){t.$set(t.info,"enableDownload",e)},expression:"info.enableDownload"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"儲存位置資訊"},model:{value:t.info.enableGPS,callback:function(e){t.$set(t.info,"enableGPS",e)},expression:"info.enableGPS"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"開放編輯標註"},model:{value:t.info.enableAnnotation,callback:function(e){t.$set(t.info,"enableAnnotation",e)},expression:"info.enableAnnotation"}}),t._v(" "),a("q-select",{ref:"annotationType",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{options:t.annotationTypeOption,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"標註方式",rules:[function(t){return!!t||"標註方式不能空白"}]},model:{value:t.info.annotationType,callback:function(e){t.$set(t.info,"annotationType",e)},expression:"info.annotationType"}}),t._v(" "),a("q-input",{staticClass:"col-12 q-pa-sm",attrs:{label:"新增標籤"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.AddTag()}},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"add"},on:{click:function(e){return t.AddTag()}}})]},proxy:!0}]),model:{value:t.tagName,callback:function(e){t.tagName=e},expression:"tagName"}}),t._v(" "),a("div",{staticClass:"full-width"},t._l(t.info.tagArr,(function(e,i){return a("q-chip",{key:e,attrs:{removable:""},on:{remove:function(e){return t.RemoveTag(i)}}},[t._v(t._s(e))])})),1),t._v(" "),t.info.isPublic?t._e():a("div",{staticClass:"full-width q-pa-md"},[a("div",{staticClass:"text-h6"},[t._v("私密成員")]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("不公開的資料集只有管理員跟私密成員能看到")]),t._v(" "),a("user-list",{ref:"memberList",attrs:{enableAdd:"",enableRemove:"",list:t.info.member},on:{add:t.AddMember,remove:t.RemoveMember}})],1),t._v(" "),a("div",{staticClass:"full-width q-pa-md"},[a("div",{staticClass:"text-h6"},[t._v("資料集版主")]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("版主擁有修改此資料集的完整權限")]),t._v(" "),a("user-list",{ref:"masterList",attrs:{enableAdd:"",enableRemove:"",list:t.info.master},on:{add:t.AddMaster,remove:t.RemoveMaster}})],1),t._v(" "),a("q-select",{ref:"annotationType",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{options:t.externalLinkOption,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"外部連結"},model:{value:t.info.externalLink,callback:function(e){t.$set(t.info,"externalLink",e)},expression:"info.externalLink"}})],1)],1)],1),t._v(" "),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"儲存",color:"primary"},on:{click:function(e){return t.UpdateDataset()}}}),t._v(" "),a("q-btn",{attrs:{flat:"",label:"取消",color:"primary"},on:{click:function(e){return t.$emit("cancel")}}})],1)],1)};i._withStripped=!0;var s=a(19),n=a(27),o={name:"dataset-editor",props:{info:Object},components:{"image-upload":s.a,"user-list":n.a},data:function(){return{annotationTypeOption:[{label:"框選標註",value:"bbox"},{label:"整張標註",value:"image"}],externalLinkOption:[{label:"無",value:""},{label:"山河事件簿",value:"riverlog"},{label:"紫豹在哪裡",value:"purbao"}],tagName:"",uploadCover:!1}},created:function(){},methods:{ChangeCover:function(){if(!this.uploadCover){var t=this.$refs.uploader;t.OnSucc=function(t){if("ok"!=t.status)return alert("更新圖片失敗");this.uploadCover=!1,this.$emit("updateCover")}.bind(this),t.OnFail=function(t){switch(console.log(t),t){case"Request Entity Too Large":return alert("影像資料過大")}}.bind(this),t.OnChange=function(){this.uploadCover=!0,t.UploadImage()}.bind(this),t.url="/dataset/change-cover",t.additionData={dataset:this.info._id},t.SelectFile()}},UpdateDataset:function(){if(this.$refs.name.validate(),this.$refs.name.hasError)return this.$q.notify({color:"negative",message:"資料集名稱無效"});if(this.$refs.maxWidth.validate(),this.$refs.maxWidth.hasError)return this.$q.notify({color:"negative",message:"最大寬度無效"});if(this.$refs.maxHeight.validate(),this.$refs.maxHeight.hasError)return this.$q.notify({color:"negative",message:"最大高度無效"});if(this.$refs.annotationType.validate(),this.$refs.annotationType.hasError)return this.$q.notify({color:"negative",message:"標註方式無效"});if(0==this.info.tagArr.length)return this.$q.notify({color:"negative",message:"請至少新增一個標籤"});var t=$("meta[name='csrf-token']").attr("content"),e={};e.dataset=this.info._id,e.info=this.info,e._csrf=t,$.post("/dataset/update-dataset",e,function(t){if("ok"!=t.status)return alert("修改失敗");this.$q.notify("修改成功"),this.$emit("confirm")}.bind(this))},AddTag:function(){this.info.tagArr||Vue.set(this.info,"tagArr",[]),this.info.tagArr.includes(this.tagName)?alert("此標籤已存在"):this.info.tagArr.push(this.tagName),this.tagName=""},RemoveTag:function(t){this.info.tagArr.splice(t,1)},AddMember:function(t){0==this.info.member.filter((function(e){return e._id==t._id})).length?this.info.member.unshift(t):this.$q.notify("此使用者已是私密成員")},RemoveMember:function(t){this.info.member.splice(t,1)},AddMaster:function(t){0==this.info.master.filter((function(e){return e._id==t._id})).length?this.info.master.unshift(t):this.$q.notify("此使用者已是私密成員")},RemoveMaster:function(t){this.info.master.splice(t,1)}}},r=(a(46),a(0)),l=Object(r.a)(o,i,[],!1,null,null,null);l.options.__file="src/vue/dataset-editor.vue";e.a=l.exports},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"annotator bg-grey-9"},[t.datasetSelect&&t.imageSelect&&t.taskSelect?a("div",{staticClass:"fit"},["image"==t.datasetSelect.annotationType?a("annotator-image",{ref:"annotatorImage",attrs:{dataset:t.datasetSelect,image:t.imageSelect,task:t.taskSelect},on:{setAnnotation:t.UploadAnnotation,setVerification:t.UploadVerification,skipTask:t.SkipTask}}):t._e(),t._v(" "),"bbox"==t.datasetSelect.annotationType?a("annotator-bbox",{ref:"annotatorBBox",attrs:{dataset:t.datasetSelect,image:t.imageSelect,task:t.taskSelect},on:{setAnnotation:t.UploadAnnotation,setVerification:t.UploadVerification,skipTask:t.SkipTask}}):t._e()],1):a("div",{staticClass:"fit row justify-center items-center"},[a("div",{staticClass:"text-h5 text-white"},[t._v(t._s(t.status))])]),t._v(" "),a("q-dialog",{model:{value:t.openDatasetSelect,callback:function(e){t.openDatasetSelect=e},expression:"openDatasetSelect"}},[a("dataset-select",{ref:"datasetSelect",attrs:{forAnnotation:""},on:{confirm:function(e){return t.ChangeDataset()},cancel:function(e){t.openDatasetSelect=!1}}})],1),t._v(" "),a("q-page-sticky",{attrs:{position:"top-left",offset:[18,18]}},[a("div",{staticClass:"column q-gutter-sm"},[a("q-btn",{staticClass:"bg-primary text-white",attrs:{flat:"",round:"",size:"md",icon:"help",disable:null==t.imageSelect},on:{click:function(e){return t.OpenHelp()}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("如何標註")])],1),t._v(" "),a("q-btn",{staticClass:"bg-primary text-white",attrs:{flat:"",round:"",size:"md",icon:"view_quilt",disable:null!=t.dataset},on:{click:function(e){t.openDatasetSelect=!0}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("選擇資料集")])],1)],1)])],1)};i._withStripped=!0;var s=a(22),n=a(21),o=a(20),r={name:"annotator",components:{"dataset-select":s.a,"annotator-image":n.a,"annotator-bbox":o.a},props:{user:Object,dataset:Object,image:Object,autoTask:Boolean},data:function(){return{datasetSelect:null,imageSelect:null,taskSelect:"",openDatasetSelect:!1,imageArr:[],status:"",verify:null}},mounted:function(){this.user||(window.location.href="/login?intentUrl="+encodeURIComponent(window.location.pathname+window.location.search)),this.datasetSelect=this.dataset,this.imageSelect=this.image,this.dataset?this.GenerateTask():(this.status="請選擇資料集",this.openDatasetSelect=!0)},methods:{ChangeDataset:function(){this.openDatasetSelect=!1,this.datasetSelect=this.$refs.datasetSelect.GetSelectDataset();var t="/dataset/list-image-for-annotation";t+="?dataset="+this.datasetSelect._id,$.get(t,function(t){if("ok"==t.status){for(var e=0;e<t.data.length;e++){var a=t.data[e];a.url="/static/upload/dataset/"+this.datasetSelect._id+"/image/"+a._id+".jpg"}this.imageArr=t.data,this.GenerateTask()}}.bind(this))},GenerateTask:function(){if(this.imageSelect=null,this.datasetSelect){if(this.image){if(this.image.annotation)if(this.image.verification.filter(function(t){return t.user==this.user._id}.bind(this)).length>0)return void(this.status="您已驗證過此影像，感謝您的協助");this.imageSelect=this.image}else{if(0==this.imageArr.length)return void(this.status="此資料集影像皆已標註完成");for(var t=[],e=0;e<this.imageArr.length;e++){var a=this.imageArr[e];if(a.annotation)0==a.verification.filter(function(t){return t.user==this.user._id}.bind(this)).length&&t.push(a);else t.push(a)}if(0==t.length)return void(this.status="您已驗證過此資料集所有資料，感謝您的協助");var i=function(){if(0==t.length)return null;var e=Math.floor(Math.random()*t.length);return t[e]}.bind(this);this.imageSelect=i()}var s=function(){this.imageSelect.annotation?this.imageSelect.verifyNum<this.verify.sample?this.taskSelect="verify":this.imageSelect.agreeNum<this.imageSelect.verifyNum*this.verify.reject?this.taskSelect="annotate":this.taskSelect="verify":this.taskSelect="annotate"}.bind(this);this.verify?s():$.get("/dataset/verify-condition",function(t){if("ok"!=t.status)return alert("讀取驗證條件失敗");this.verify=t.data,s()}.bind(this))}else this.status="請選擇資料集"},GetAnnotator:function(){if(!this.datasetSelect)return null;var t=null;switch(this.datasetSelect.annotationType){case"image":t=this.$refs.annotatorImage;break;case"bbox":t=this.$refs.annotatorBBox}return t},UploadAnnotation:function(){var t=this.GetAnnotator();if(t){var e=$("meta[name='csrf-token']").attr("content"),a={};a.dataset=t.dataset._id,a.image=t.image._id,a.annotation=t.GetAnnotation(),a._csrf=e,$.post("/dataset/set-annotation",a,function(t){if("ok"!=t.status)switch(t.message){case"blacklist":return alert("黑名單使用者無此權限");default:return alert("標註失敗")}this.imageSelect.annotation={user:this.user._id,annotation:a.annotation},this.$q.notify("標註成功"),this.autoTask?this.GenerateTask():this.$emit("done")}.bind(this))}},UploadVerification:function(t){var e=this.GetAnnotator();if(e){var a=$("meta[name='csrf-token']").attr("content"),i={};i.dataset=e.dataset._id,i.image=e.image._id,i.agree=t?"1":"0",i._csrf=a,$.post("/dataset/add-verification",i,function(t){if("ok"!=t.status)switch(t.message){case"verification duplicate":this.$q.notify("您之前已驗證過這個標註");break;case"blacklist":alert("黑名單使用者無此權限");break;default:alert("驗證失敗")}else this.$q.notify("驗證成功");this.imageSelect.verification.push({user:this.user._id,agree:i.agree}),this.autoTask?this.GenerateTask():this.$emit("done")}.bind(this))}},OpenHelp:function(){var t=this.GetAnnotator();t&&(t.openHelp=!0)},SkipTask:function(){this.autoTask?this.GenerateTask():this.$emit("skip")}}},l=(a(58),a(0)),c=Object(l.a)(r,i,[],!1,null,null,null);c.options.__file="src/vue/annotator.vue";e.a=c.exports},function(t,e,a){"use strict";var i=a(5);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".location-select{width:100%}.location-select .map{width:100%;height:300px}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(7);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".image-upload{width:100%;height:100%}.image-upload img{width:100%;height:100%;object-fit:cover}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(8);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".user-select{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(9);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".user-list{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(10);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".dataset-editor{width:100%}.dataset-editor .cover-container{width:320px;height:240px;position:relative}.dataset-editor .cover-container .change-bt{position:absolute;bottom:0px;left:0px;width:100%;background-color:rgba(0,0,0,0.5);color:#ffffff}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(11);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".dataset-select{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(12);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".image-info{width:100%;height:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(13);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".tag-select{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(14);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".annotator-image{width:100%;height:100%}.annotator-image .image{margin:auto;max-width:800px;max-height:100%}.annotator-image .tag-select{width:150px;display:inline-block;padding:0px 5px}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(15);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".annotator-bbox{width:100%;height:100%;position:relative}.annotator-bbox .tool-set{position:absolute;display:inline-block;bottom:10px;left:10px}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(16);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".annotator{width:100%;height:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"camera-capture bg-grey-8"},[a("div",{directives:[{name:"show",rawName:"v-show",value:t.stepArr[t.step]&&"capture"==t.stepArr[t.step].id,expression:"stepArr[step] && stepArr[step].id == 'capture' "}],staticClass:"full-width"},[a("camera-capture",{ref:"cam"}),t._v(" "),a("q-page-sticky",{attrs:{position:"bottom",offset:[18,18]}},[a("q-btn",{staticClass:"bg-white text-grey-8",attrs:{round:"",push:"",disable:"ok"!=t.camStatus,size:"lg",icon:"camera_alt"},on:{click:function(e){return t.CaptureCameraImage()}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("拍照上傳")])],1)],1),t._v(" "),a("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[a("div",{staticClass:"column q-gutter-sm"},[a("q-btn",{staticClass:"bg-primary text-white",attrs:{flat:"",round:"",size:"md",icon:"flip_camera_ios"},on:{click:function(e){return t.ChangeCamera()}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("切換相機")])],1),t._v(" "),a("q-btn",{staticClass:"bg-primary text-white",attrs:{flat:"",round:"",size:"md",icon:"folder"},on:{click:function(e){return t.SelectFile()}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("檔案上傳")])],1)],1)])],1),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.stepArr[t.step]&&"crop"==t.stepArr[t.step].id,expression:"stepArr[step] && stepArr[step].id == 'crop' "}],staticClass:"full-width"},[a("image-edit",{ref:"imageEdit",on:{confirm:function(e){return t.NextStep()},cancel:function(e){return t.PrevStep()}}})],1),t._v(" "),a("q-dialog",{model:{value:t.stepArr[t.step]&&"dataset"==t.stepArr[t.step].id,callback:function(e){t.$set(t.stepArr[t.step]&&t.stepArr[t.step],"id == 'dataset'",e)},expression:"stepArr[step] && stepArr[step].id == 'dataset'"}},[a("dataset-select",{ref:"datasetSelect",attrs:{forUpload:""},on:{change:function(e){return t.DatasetChange()},confirm:function(e){return t.NextStep()},cancel:function(e){return t.PrevStep()}}})],1),t._v(" "),a("q-dialog",{model:{value:t.stepArr[t.step]&&"info"==t.stepArr[t.step].id,callback:function(e){t.$set(t.stepArr[t.step]&&t.stepArr[t.step],"id == 'info'",e)},expression:"stepArr[step] && stepArr[step].id == 'info'"}},[a("image-info",{ref:"imageInfo",attrs:{dataset:t.datasetSelect},on:{confirm:function(e){t.UpdateImageInfo(),t.NextStep()},cancel:function(e){return t.PrevStep()}}})],1),t._v(" "),a("image-upload",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"uploader"}),t._v(" "),t.stepArr[t.step]?a("q-page-sticky",{attrs:{position:"bottom-left",offset:[9,9]}},[a("q-badge",{attrs:{color:"secondary q-pa-sm"}},[t._v("\n\t\t\t"+t._s(t.stepArr[t.step].name+" ("+(t.step+1)+"/"+t.stepArr.length+")")+"\n\t\t")])],1):t._e()],1)};i._withStripped=!0;var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"camera-capture bg-grey-9"},[a("video",{ref:"video",attrs:{autoplay:"",playsinline:"",muted:""},domProps:{muted:!0,srcObject:t.camStream}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"ok"!=t.camStatus,expression:"camStatus !='ok' "}],staticClass:"fixed-center text-white text-h5"},[t._v(t._s(t.camStatus))]),t._v(" "),a("q-dialog",{model:{value:t.openCameraSelect,callback:function(e){t.openCameraSelect=e},expression:"openCameraSelect"}},[a("q-card",{staticClass:"full-width"},[a("div",{staticClass:"text-h6 q-pa-md"},[t._v("選擇相機")]),t._v(" "),t.lastCamera?a("div",{staticClass:"q-px-md"},[a("div",{staticClass:"text-subtitle2"},[t._v("上次使用")]),t._v(" "),a("q-item",{attrs:{clickable:""},on:{click:function(e){return t.SelectCamera(t.lastCamera)}}},[t._v(t._s(t.lastCamera.name))])],1):t._e(),t._v(" "),a("q-list",{attrs:{bordered:"",separator:""}},t._l(t.cameraList,(function(e){return a("q-item",{key:e.id,attrs:{clickable:""},on:{click:function(a){return t.SelectCamera(e)}}},[t._v(t._s(e.name))])})),1)],1)],1)],1)};s._withStripped=!0;var n={name:"camera-capture",props:{},data:function(){return{selectCamerea:null,cameraList:[],camStatus:"無相機",camStream:null,openCameraSelect:!1,OnCamSelect:null,OnCamStart:null,OnCamCapture:null,imageData:null}},created:function(){this.GetLastCamera()},beforeDestroy:function(){this.StopCamera()},methods:{GetLastCamera:function(){window.localStorage;this.lastCamera=JSON.parse(localStorage.getItem("lastCamera"))},SetLastCamera:function(t){window.localStorage;localStorage.setItem("lastCamera",JSON.stringify(t))},OpenCameraSelect:function(){navigator.mediaDevices?navigator.mediaDevices.enumerateDevices().then(function(t){this.cameraList=[];for(var e=0;e<t.length;e++){var a=t[e],i=a.label;""==i&&(i="相機"+(this.cameraList.length+1)),"videoinput"===a.kind&&this.cameraList.push({id:a.deviceId,name:i})}this.cameraList.length>0&&(this.selectCamera=this.cameraList[0].id),this.openCameraSelect=!0}.bind(this)):this.camStatus="無法讀取裝置列表，請開啟權限或使用右下角的檔案上傳功能"},SelectCamera(t){this.SetLastCamera(t),this.selectCamera=t.id,this.StartCamera(),this.OnCamSelect&&this.OnCamSelect()},StartCamera:function(){this.camStatus="無相機";var t={video:{}};this.selectCamera?t.video.deviceId={exact:this.selectCamera}:t.video.facingMode="environment",navigator.getUserMedia?navigator.getUserMedia(t,function(t){this.camStream=t,this.camStatus="ok",this.OnCamStart&&this.OnCamStart()}.bind(this),function(t){this.camStatus="讀取相機失敗"}.bind(this)):this.camStatus="瀏覽器不支援相機",this.openCameraSelect=!1},StopCamera:function(){this.camStream&&(this.camStream.getTracks()[0].stop(),this.camStream=null)},CaptureImage:function(){var t=this.$refs.video,e=document.createElement("canvas");e.width=t.videoWidth,e.height=t.videoHeight;var a=e.getContext("2d");a.save(),a.drawImage(t,0,0),a.restore(),this.imageData=e.toDataURL("image/jpeg",.9),this.OnCamCapture&&this.OnCamCapture()}}},o=(a(76),a(0)),r=Object(o.a)(n,s,[],!1,null,null,null);r.options.__file="src/vue/camera-capture.vue";var l=r.exports,c=a(19),u=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"image-edit bg-grey-9"},[a("img",{ref:"image",attrs:{src:t.imageData}}),t._v(" "),a("q-page-sticky",{attrs:{position:"top",offset:[9,9]}},[a("q-btn",{attrs:{dense:"",color:"primary",icon:"rotate_left"},on:{click:function(e){return t.cropper.rotate(-90)}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("逆時針旋轉90°")])],1),t._v(" "),a("q-btn",{attrs:{dense:"",color:"primary",icon:"rotate_right"},on:{click:function(e){return t.cropper.rotate(90)}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("順時針旋轉90°")])],1),t._v(" "),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:"move"==t.mode,expression:"mode=='move' "}],attrs:{dense:"",color:"primary",icon:"crop"},on:{click:function(e){return t.ChangeMode("crop")}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("框選裁切")])],1),t._v(" "),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:"crop"==t.mode,expression:"mode=='crop' "}],attrs:{dense:"",color:"primary",icon:"gamepad"},on:{click:function(e){return t.ChangeMode("move")}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("移動影像")])],1),t._v(" "),a("q-btn",{attrs:{dense:"",color:"primary",icon:"clear"},on:{click:function(e){return t.ClearEdit()}}},[a("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("重設影像")])],1)],1),t._v(" "),a("q-page-sticky",{attrs:{position:"bottom",offset:[9,9]}},[a("q-btn",{attrs:{color:"primary",label:"確定"},on:{click:function(e){return t.ConfirmEdit()}}}),t._v(" "),a("q-btn",{attrs:{color:"primary",label:"取消"},on:{click:function(e){return t.CancelEdit()}}})],1)],1)};u._withStripped=!0;var h={name:"image-edit",props:{maxResW:{type:Number,default:1024},maxResH:{type:Number,default:1024}},data:function(){return{imageData:null,cropper:null,mode:"move"}},mounted:function(){},methods:{SetImage:function(t){this.cropper&&this.cropper.destroy();var e=this.$refs.image;e.onload=function(){this.cropper=new Cropper(e,{viewMode:2,dragMode:this.mode,autoCrop:!1})}.bind(this),this.imageData=t},ChangeMode:function(t){this.mode=t,this.cropper.setDragMode(t)},ClearEdit:function(){confirm("確定清除所有編輯動作?")&&(this.cropper.clear(),this.cropper.reset())},GetCanvasData:function(){return this.cropper.getCroppedCanvas()},ConfirmEdit:function(){this.$emit("confirm")},CancelEdit:function(){this.$emit("cancel")}}},d=(a(78),Object(o.a)(h,u,[],!1,null,null,null));d.options.__file="src/vue/image-edit.vue";var f=d.exports,m=a(22),p=a(26),g={name:"uploader",components:{"camera-capture":l,"image-upload":c.a,"image-edit":f,"dataset-select":m.a,"image-info":p.a},props:{user:Object,dataset:Object},data:function(){return{camStatus:"",stepArr:[],step:0,datasetSelect:null,imageInfo:null}},mounted:function(){this.user||(window.location.href="/login?intentUrl="+encodeURIComponent(window.location.pathname+window.location.search)),this.stepArr=[],this.stepArr.push({id:"capture",name:"拍照選檔"}),this.stepArr.push({id:"crop",name:"旋轉裁切"}),this.dataset?this.datasetSelect=this.dataset:this.stepArr.push({id:"dataset",name:"選擇資料集"}),this.stepArr.push({id:"info",name:"影像資訊"}),this.ChangeCamera()},methods:{ChangeCamera:function(){var t=this.$refs.cam;t.OnCamStart=function(){this.camStatus=t.camStatus}.bind(this),t.OpenCameraSelect()},CaptureCameraImage:function(){var t=this.$refs.cam;t.OnCamCapture=function(){this.$refs.imageEdit.SetImage(t.imageData),this.NextStep()}.bind(this),t.CaptureImage()},SelectFile:function(){var t=this.$refs.uploader;t.OnChange=function(){this.$refs.imageEdit.SetImage(t.imageData),this.NextStep()}.bind(this),t.SelectFile()},NextStep:function(){this.step++,this.step>=this.stepArr.length&&this.UploadImageToDataset()},PrevStep:function(){this.step--,this.step<0&&(this.step=0)},DatasetChange:function(){this.dataset||(this.datasetSelect=this.$refs.datasetSelect.GetSelectDataset(),console.log(this.datasetSelect),this.$refs.uploader.SetMaxRes(this.datasetSelect.maxWidth,this.datasetSelect.maxHeight))},UpdateImageInfo:function(){this.imageInfo=this.$refs.imageInfo.GetImageInfo()},UploadImageToDataset:function(){var t,e,a,i=this.dataset||this.datasetSelect;this.imageInfo&&(t=this.imageInfo.loc,e=this.imageInfo.remark,a=this.imageInfo.dataTime);var s=this.$refs.uploader;s.OnSucc=function(t){if("ok"!=t.status)switch(t.message){case"blacklist":return alert("黑名單使用者無此權限");default:return alert("上傳圖片失敗")}this.step=0,this.$q.notify("已將影像上傳至"+i.name),this.$emit("uploaded")}.bind(this),s.OnFail=function(t){switch(console.log(t),t){case"Request Entity Too Large":return alert("影像資料過大")}}.bind(this),s.url="/dataset/upload-image";var n={};n.dataset=i._id,t&&(n.lat=t.lat,n.lng=t.lng),e&&""!=e&&(n.remark=e),a&&(n.dataTime=a),s.additionData=n;var o=this.$refs.imageEdit.GetCanvasData();s.FitCanvasFromCanvas(o),s.UploadImage()}}},v=(a(80),Object(o.a)(g,i,[],!1,null,null,null));v.options.__file="src/vue/uploader.vue";e.a=v.exports},,function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dataset-list"},["edit"==t.mode?a("div",{staticClass:"row q-px-md"},[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"add",label:"新增資料集"},on:{click:function(e){return t.AddDataset()}}})],1):t._e(),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-sm-6 col-md-3 q-pa-md"},[a("q-input",{attrs:{dense:"",label:"搜尋資料集"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.ReloadDataset()}},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"search"},on:{click:function(e){return t.ReloadDataset()}}})]},proxy:!0}]),model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),t._v(" "),a("div",{staticClass:"col-12 col-sm-6 col-md-3 q-pa-md"},[a("q-select",{attrs:{dense:"",options:t.sortOption,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"排序"},on:{input:function(e){return t.ReloadDataset()}},model:{value:t.sortKey,callback:function(e){t.sortKey=e},expression:"sortKey"}})],1),t._v(" "),a("div",{staticClass:"col-6 col-sm-4 col-md-2 q-pa-md"},[a("q-select",{attrs:{dense:"",options:t.orderTypeOption,"option-value":"value","option-label":"label","emit-value":"","map-options":""},on:{input:function(e){return t.ReloadDataset()}},model:{value:t.orderType,callback:function(e){t.orderType=e},expression:"orderType"}})],1)]),t._v(" "),a("div",{staticClass:"row q-col-gutter-md q-mb-md"},t._l(t.datasetArr,(function(e){return a("div",{staticClass:"col-12 col-sm-6 col-md-3"},[a("q-card",{staticClass:"bg-grey-7 text-white"},[a("q-img",{staticClass:"cursor-pointer",attrs:{src:e.picCover||"/static/image/logo-16-9.png",ratio:16/9},on:{click:function(a){return t.GoToDataset(e)}}},[e.isPublic?t._e():a("div",{staticClass:"absolute-top"},[t._v("\n\t\t\t\t\t\t不公開\n\t\t\t\t\t")])]),t._v(" "),a("q-separator",{attrs:{dark:""}}),t._v(" "),a("q-card-section",{staticClass:"cursor-pointer",on:{click:function(a){return t.GoToDataset(e)}}},[a("div",{staticClass:"text-h6"},[t._v(t._s(e.name))]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("影像數: "+t._s(e.picNum))]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("標註數: "+t._s(e.annotationNum))])]),t._v(" "),a("q-separator",{attrs:{dark:""}}),t._v(" "),"edit"==t.mode?a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",icon:"edit",label:"修改"},on:{click:function(a){return t.ModifyDataset(e)}}}),t._v(" "),a("q-btn",{attrs:{flat:"",icon:"delete",label:"刪除"},on:{click:function(a){return t.DeleteDataset(e)}}})],1):t._e()],1)],1)})),0),t._v(" "),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.hasMoreDataset,expression:"hasMoreDataset"}],staticClass:"full-width bg-grey-4 q-ma-sm",attrs:{label:"載入更多"},on:{click:function(e){return t.LoadMoreDataset()}}}),t._v(" "),a("q-dialog",{model:{value:t.openDatasetEditor,callback:function(e){t.openDatasetEditor=e},expression:"openDatasetEditor"}},[a("dataset-editor",{attrs:{info:t.editInfo},on:{confirm:function(e){return t.ReloadDataset(!0)},cancel:function(e){t.openDatasetEditor=!1},updateCover:function(e){return t.ReloadDataset(!1)}}})],1)],1)};i._withStripped=!0;var s=a(36),n={name:"dataset-list",props:{mode:String},components:{"dataset-editor":s.a},data:function(){return{searchKey:"",sortKey:"createdAt",sortOption:[{label:"建立時間",value:"createdAt"},{label:"更新時間",value:"updatedAt"},{label:"圖片數",value:"picNum"},{label:"標註數",value:"annotationNum"}],orderType:"desc",orderTypeOption:[{label:"遞減",value:"desc"},{label:"遞增",value:"asc"}],datasetArr:[],datasetPage:0,hasMoreDataset:!0,editInfo:{},openDatasetEditor:!1,favoriteID:[]}},created:function(){this.LoadMoreDataset()},methods:{LoadMoreDataset:function(){var t="/dataset/list-dataset";t+="?page="+this.datasetPage,t+="&sort="+this.sortKey,t+="&orderType="+this.orderType,t+="&keyword="+this.searchKey,"favorite"==this.mode&&(t+="&favorite=1"),$.get(t,function(t){"ok"==t.status&&(this.hasMoreDataset=t.data.hasMore,this.datasetArr=this.datasetArr.concat(t.data.dataset),this.datasetPage++)}.bind(this))},ClearDataset:function(){this.datasetArr=[],this.datasetPage=0},ReloadDataset:function(t){this.ClearDataset(),this.LoadMoreDataset(),t&&(this.openDatasetEditor=!1)},AddDataset:function(){var t=$("meta[name='csrf-token']").attr("content"),e={};e._csrf=t,$.post("/dataset/create-dataset",e,function(t){if("ok"!=t.status)return alert("新增失敗");this.ReloadDataset(),this.openDatasetEditor=!0,this.editInfo=t.data}.bind(this))},ModifyDataset:function(t){this.openDatasetEditor=!0,this.editInfo=Object.assign({},t)},DeleteDataset:function(t){if(confirm("刪除資料集將一併刪除所有影像與標註資料，並且無法復原。確定刪除資料集 "+t.name+"?")){var e=$("meta[name='csrf-token']").attr("content"),a={};a.id=t._id,a._csrf=e,$.post("/dataset/delete-dataset",a,function(t){if("ok"!=t.status)return alert("刪除失敗");this.ReloadDataset()}.bind(this))}},GoToDataset:function(t){window.location.href="/dataset?id="+t._id}}},o=(a(74),a(0)),r=Object(o.a)(n,i,[],!1,null,null,null);r.options.__file="src/vue/dataset-list.vue";e.a=r.exports},function(t,e,a){var i=a(1),s=a(88);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},o=(i(t.i,s,n),s.locals?s.locals:{});t.exports=o},,,,,,,,,,,function(t,e,a){"use strict";var i=a(30);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".dataset-list{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(31);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".camera-capture{width:100%;height:100%;position:relative;display:flex;justify-content:center}.camera-capture video{width:auto;height:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(32);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".image-edit{width:100%;height:100%;position:relative;display:flex;justify-content:center}.image-edit img{width:100%;height:100%;object-fit:contain}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(33);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".camera-capture{width:100%;height:100%}\n",""]),t.exports=e},,,,,function(t,e,a){t.exports=a(116)},function(t,e,a){"use strict";var i=a(63);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".main-app{width:100%;height:100%}\n",""]),t.exports=e},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{staticClass:"main-app bg-grey-1 shadow-2",attrs:{view:"lHh lpr lFf",container:""}},[a("q-header",[a("topbar",{attrs:{user:t.user}})],1),t._v(" "),a("q-page-container",[a("q-page",{staticClass:"bg-grey-1"},[a("q-tab-panels",{staticClass:"absolute fit",attrs:{animated:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[a("q-tab-panel",{attrs:{name:"dataset"}},[a("dataset-list",{attrs:{mode:"view"}})],1),t._v(" "),a("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"upload"}},[a("uploader",{attrs:{user:t.user}})],1),t._v(" "),a("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"annotation"}},[a("annotator",{attrs:{autoTask:"",user:t.user}})],1)],1)],1)],1),t._v(" "),a("q-footer",[a("q-tabs",{staticClass:"bg-grey-8 text-white",attrs:{"inline-label":"",align:"justify","active-bg-color":"grey-7"},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[a("q-tab",{attrs:{name:"dataset",icon:"folder",label:"資料集"}}),t._v(" "),a("q-tab",{attrs:{name:"upload",icon:"add_photo_alternate",label:"拍照上傳"}}),t._v(" "),a("q-tab",{attrs:{name:"annotation",icon:"aspect_ratio",label:"照片標註"}})],1)],1)],1)};i._withStripped=!0;var s=a(3),n=(a(23),a(17)),o=a(62),r=a(60),l=a(37),c={name:"main-app",components:{topbar:n.a,"dataset-list":o.a,uploader:r.a,annotator:l.a},data:function(){return{tab:"dataset",user:null}},created:function(){var t=s.a.GetUrlParameter();t.message&&alert(decodeURIComponent(t.message)),$.get("/user/info",function(t){"ok"==t.status&&(this.user=t.data)}.bind(this))},methods:{}},u=(a(87),a(0)),h=Object(u.a)(c,i,[],!1,null,null,null);h.options.__file="src/vue/main-app.vue";var d=h.exports;new Vue({el:"#mainApp",components:{"main-app":d}})}]);