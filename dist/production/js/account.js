!function(t){var e={};function a(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=t,a.c=e,a.d=function(t,e,i){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)a.d(i,s,function(e){return t[e]}.bind(null,s));return i},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/dist/production",a(a.s=105)}([function(t,e,a){"use strict";function i(t,e,a,i,s,n,r,o){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=a,c._compiled=!0),i&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),r?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},c._ssrRegister=l):s&&(l=o?function(){s.call(this,this.$root.$options.shadowRoot)}:s),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(t,e){return l.call(e),u(t,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:c}}a.d(e,"a",(function(){return i}))},function(t,e,a){"use strict";var i,s=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},n=function(){var t={};return function(e){if(void 0===t[e]){var a=document.querySelector(e);if(window.HTMLIFrameElement&&a instanceof window.HTMLIFrameElement)try{a=a.contentDocument.head}catch(t){a=null}t[e]=a}return t[e]}}(),r={};function o(t,e,a){for(var i=0;i<e.length;i++){var s={css:e[i][1],media:e[i][2],sourceMap:e[i][3]};r[t][i]?r[t][i](s):r[t].push(p(s,a))}}function l(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var s=a.nc;s&&(i.nonce=s)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var r=n(t.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}return e}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function d(t,e,a,i){var s=a?"":i.css;if(t.styleSheet)t.styleSheet.cssText=u(e,s);else{var n=document.createTextNode(s),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(n,r[e]):t.appendChild(n)}}function f(t,e,a){var i=a.css,s=a.media,n=a.sourceMap;if(s?t.setAttribute("media",s):t.removeAttribute("media"),n&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var m=null,h=0;function p(t,e){var a,i,s;if(e.singleton){var n=h++;a=m||(m=l(e)),i=d.bind(null,a,n,!1),s=d.bind(null,a,n,!0)}else a=l(e),i=f.bind(null,a,e),s=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(a)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else s()}}t.exports=function(t,e,a){return(a=a||{}).singleton||"boolean"==typeof a.singleton||(a.singleton=s()),t=a.base?t+a.base:t,e=e||[],r[t]||(r[t]=[]),o(t,e,a),function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){r[t]||(r[t]=[]),o(t,e,a);for(var i=e.length;i<r[t].length;i++)r[t][i]();r[t].length=e.length,0===r[t].length&&delete r[t]}}}},function(t,e,a){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var a=function(t,e){var a=t[1]||"",i=t[3];if(!i)return a;if(e&&"function"==typeof btoa){var s=(r=i,o=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(l," */")),n=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[a].concat(n).concat([s]).join("\n")}var r,o,l;return[a].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(a,"}"):a})).join("")},e.i=function(t,a){"string"==typeof t&&(t=[[null,t,""]]);for(var i=0;i<t.length;i++){var s=[].concat(t[i]);a&&(s[2]?s[2]="".concat(a," and ").concat(s[2]):s[2]=a),e.push(s)}},e}},function(t,e,a){"use strict";var i={GetUrlParameter:function(){for(var t=window.location.search.substring(1).split("&"),e={},a=0;a<t.length;a++){var i=t[a].split("=");e[i[0]]=i[1]}return e},GetUrlHash:function(){for(var t=window.location.hash.substr(1).split("&"),e={},a=0;a<t.length;a++){var i=t[a].split("=");e[i[0]]=i[1]}return e},ValidateEmail:function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},PadLeft:function(t,e,a){var i=e-String(t).length+1;return i>0?new Array(i).join(a||"0")+t:t}};e.a=i},function(t,e,a){var i=a(1),s=a(31);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(42);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},,,function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"dataset-select full-width q-pa-sm"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("選擇資料集")]),t._v(" "),t.lastDataset?a("div",[a("div",{staticClass:"text-subtitle2"},[t._v("上次使用")]),t._v(" "),a("q-item",{attrs:{clickable:"",active:-1==t.selectIndex,"active-class":"bg-green-2"},on:{click:function(e){return t.SelectItem(-1)},dblclick:function(e){return t.ConfirmSelect()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{attrs:{square:"",rounded:""}},[a("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.lastDataset.picCover||"/static/image/logo-16-9.png"}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[t._v(t._s(t.lastDataset.name))])],1)],1)],1):t._e(),t._v(" "),a("q-scroll-area",{staticStyle:{height:"300px"}},[a("q-infinite-scroll",{ref:"datasetScroll",on:{load:t.LoadMoreDataset},scopedSlots:t._u([{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}])},[a("q-input",{attrs:{placeholder:"輸入篩選文字",outlined:"",dense:"",square:""},on:{change:function(e){return t.ReloadDataset()}},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),t._v(" "),a("q-list",{attrs:{bordered:"",separator:""}},t._l(t.datasetArr,(function(e,i){return a("q-item",{key:i,attrs:{clickable:"",active:t.selectIndex==i,"active-class":"bg-green-2"},on:{click:function(e){return t.SelectItem(i)},dblclick:function(e){return t.ConfirmSelect()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",{attrs:{square:"",rounded:""}},[a("img",{staticStyle:{"object-fit":"cover"},attrs:{src:e.picCover||"/static/image/logo-16-9.png"}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[t._v(t._s(e.name))])],1)],1)})),1)],1)],1)],1),t._v(" "),a("q-card-actions",{staticClass:"justify-center"},[a("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){return t.ConfirmSelect()}}}),t._v(" "),a("q-btn",{attrs:{flat:"",label:"取消"},on:{click:function(e){return t.CancelSelect()}}})],1)],1)};i._withStripped=!0;var s={name:"dataset-select",props:{forUpload:Boolean,forAnnotation:Boolean},components:{},data:function(){return{searchKey:"",datasetArr:[],hasMore:!0,selectIndex:-1,lastDataset:{}}},created:function(){this.GetLastDataset()},methods:{GetLastDataset:function(){window.localStorage;this.lastDataset=JSON.parse(localStorage.getItem("lastDataset"))},SetLastDataset:function(t){window.localStorage;localStorage.setItem("lastDataset",JSON.stringify(t))},LoadMoreDataset:function(t,e){var a="/dataset/list-dataset";a+="?page="+(t-1),a+="&sort=updatedAt",a+="&orderType=desc",this.forUpload&&(a+="&enableUpload=1"),this.forAnnotation&&(a+="&enableAnnotation=1"),a+="&keyword="+this.searchKey,$.get(a,function(t){"ok"==t.status&&(this.hasMore=t.data.hasMore,this.hasMore||this.$refs.datasetScroll.stop(),this.datasetArr=this.datasetArr.concat(t.data.dataset),e())}.bind(this))},ReloadDataset:function(){this.datasetArr=[],this.$refs.datasetScroll.reset(),this.$refs.datasetScroll.resume(),this.selectIndex=-1},GetSelectDataset:function(){return-1==this.selectIndex&&this.lastDataset?this.lastDataset:this.selectIndex<0||this.selectIndex>=this.datasetArr.length?null:this.datasetArr[this.selectIndex]},SelectItem:function(t){this.selectIndex=t,this.$emit("change")},ConfirmSelect:function(){return-1==this.selectIndex&&this.lastDataset?this.$emit("confirm"):this.selectIndex<0||this.selectIndex>=this.datasetArr.length?alert("請選擇資料集"):(this.SetLastDataset(this.datasetArr[this.selectIndex]),void this.$emit("confirm"))},CancelSelect:function(){this.$emit("cancel")}}},n=(a(41),a(0)),r=Object(n.a)(s,i,[],!1,null,null,null);r.options.__file="src/vue/dataset-select.vue";e.a=r.exports},function(t,e,a){var i=a(1),s=a(47);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(49);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(51);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(53);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(55);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},,,,,,,,function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"topbar bg-grey-8 text-white"},[a("q-toolbar",{staticClass:"q-px-md",attrs:{square:""}},[t.useMenu?a("q-btn",{attrs:{flat:"",round:"",icon:"menu"},on:{click:function(e){return t.ToggleMenu()}}}):t._e(),t._v(" "),a("a",{attrs:{href:"/"}},[a("q-btn",{attrs:{flat:"","no-caps":""}},[a("q-avatar",{attrs:{size:"md",square:""}},[a("img",{attrs:{src:t.logo}})]),t._v(" "),a("div",{staticClass:"gt-xs q-px-md text-white text-h5 inline"},[t._v(t._s(t.title))])],1)],1),t._v(" "),a("q-space"),t._v(" "),t.user?a("q-item",{attrs:{clickable:"",tag:"a",href:"/account"}},[a("q-avatar",{attrs:{size:"lg"}},[a("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.user.icon}})]),t._v(" "),a("q-item-section",{staticClass:"q-px-sm"},[a("q-item-label",{staticClass:"text-h6"},[t._v(t._s(t.user.name))])],1)],1):a("q-item",{attrs:{clickable:"",tag:"a",href:"/login"}},[a("q-icon",{attrs:{size:"md",name:"account_box"}}),t._v(" "),a("q-item-section",[a("q-item-label",{staticClass:"text-h6"},[t._v("登入")])],1)],1)],1)],1)};i._withStripped=!0;var s={name:"topbar",props:{user:Object,useMenu:Boolean},data:function(){return{title:"",logo:"/static/image/logo.png"}},created:function(){$.get("/site-info",function(t){"ok"==t.status&&(this.title=t.data.title,this.logo=t.data.logo)}.bind(this))},methods:{ToggleMenu:function(){this.$emit("toggleMenu")}}},n=(a(30),a(0)),r=Object(n.a)(s,i,[],!1,null,null,null);r.options.__file="src/vue/topbar.vue";e.a=r.exports},function(t,e,a){"use strict";var i=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"image-upload"},[e("img",{directives:[{name:"show",rawName:"v-show",value:this.showPreview,expression:"showPreview"}],attrs:{src:this.imageData}}),this._v(" "),e("input",{ref:"uploadBt",attrs:{type:"file",hidden:""},on:{change:this.UpdateFile}})])};i._withStripped=!0;var s={name:"image-upload",props:{maxResW:{type:Number,default:1024},maxResH:{type:Number,default:1024},showPreview:Boolean,src:String},data:function(){return{file:null,imageData:null,url:"",additionData:{},OnSucc:null,OnFail:null,OnProgress:null,OnChange:null,maxW:1024,maxH:1024,uploading:!1,exif:{}}},created:function(){this.src&&(this.imageData=this.src),this.maxResW&&(this.maxW=this.maxResW),this.maxResH&&(this.maxH=this.maxResH)},methods:{SetMaxRes:function(t,e){this.maxW=t,this.maxH=e},SelectFile:function(){this.$refs.uploadBt.click()},UpdateFile:function(t){var e=t.target.files;if(FileReader&&e&&e.length){var a=new FileReader;a.onload=function(){var t=function(t){for(var e=atob(t),a=e.length,i=new Uint8Array(a),s=0;s<a;s++)i[s]=e.charCodeAt(s);return i.buffer}(a.result.split(",")[1]),e=ExifReader.load(t),i=parseFloat(e.GPSLatitude.description),s=parseFloat(e.GPSLongitude.description);if(i&&s&&(this.exif.lat=i,this.exif.lng=s),e.DateTime){var n=e.DateTime.description.split(" "),r=n[0].replace(/:/g,"-");this.exif.time=r+" "+n[1]}var o=function(t){var e=new Image;e.onload=function(){this.FitCanvasFromImage(e),this.OnChange&&this.OnChange()}.bind(this),e.src=t}.bind(this);".heic"==this.file.name.substr(this.file.name.length-5).toLowerCase()?heic2any({blob:this.file,toType:"image/jpeg"}).then((function(t){var e=URL.createObjectURL(t);o(e)})):o(a.result)}.bind(this),this.file=e[0],a.readAsDataURL(e[0])}},FitCanvasFromImage:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var a=e.getContext("2d");a.save(),a.drawImage(t,0,0),a.restore();var i=this.maxW/t.width,s=this.maxH/t.height,n=Math.min(i,s),r=t.width*n,o=t.height*n,l=this.ResizeImage(e,r,o);this.imageData=l.toDataURL("image/jpeg",.9)},FitCanvasFromCanvas:function(t){var e=this.maxW/t.width,a=this.maxH/t.height,i=Math.min(e,a),s=t.width*i,n=t.height*i,r=this.ResizeImage(t,s,n);this.imageData=r.toDataURL("image/jpeg",.9)},CropImage:function(t,e,a,i,s){var n=document.createElement("canvas");n.width=i,n.height=s;var r=n.getContext("2d");return r.save(),r.drawImage(t,e,a,i,s,0,0,i,s),r.restore(),n},ResizeImage:function(t,e,a){for(var i=Math.max(.5*t.width,e),s=Math.max(.5*t.height,a),n=t;i>e||s>a;){(r=document.createElement("canvas")).width=i,r.height=s,r.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,i,s),n=r,i=Math.max(.5*n.width,e),s=Math.max(.5*n.height,a)}var r;return(r=document.createElement("canvas")).width=e,r.height=a,r.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,e,a),r},UploadImage:function(){if(!this.uploading){this.uploading=!0;var t=$("meta[name='csrf-token']").attr("content"),e=new FormData;for(var a in this.additionData)e.append(a,this.additionData[a]);e.append("uploadImage",this.imageData),$.ajax({url:this.url,headers:{"csrf-token":t},type:"POST",data:e,processData:!1,contentType:!1,xhr:function(){var t=$.ajaxSettings.xhr();return t.upload&&this.OnProgress&&t.upload.addEventListener("progress",this.OnProgress,!1),t}.bind(this),success:function(t){if(this.uploading=!1,"ok"!=t.status)switch(t.message){case"blacklist":return alert("黑名單使用者無此權限");default:return alert("上傳影像失敗")}if(this.OnSucc)return this.OnSucc(t)}.bind(this),error:function(t,e,a){if(this.uploading=!1,this.OnFail)return this.OnFail(a)}.bind(this)})}}}},n=(a(46),a(0)),r=Object(n.a)(s,i,[],!1,null,null,null);r.options.__file="src/vue/image-upload.vue";e.a=r.exports},,,function(t,e,a){var i=a(1),s=a(26);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){(e=a(2)(!1)).push([t.i,'html,body{height:100%;margin:0;padding:0;background-color:#edffef}*{box-sizing:border-box;font-family:"微軟正黑體", "Microsoft JhengHei"}\n',""]),t.exports=e},,function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"user-select full-width q-pa-sm"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("選擇使用者")]),t._v(" "),a("q-scroll-area",{staticStyle:{height:"300px"}},[a("q-infinite-scroll",{ref:"userScroll",on:{load:t.LoadMoreUser},scopedSlots:t._u([{key:"loading",fn:function(){return[a("div",{staticClass:"row justify-center q-my-md"},[a("q-spinner-dots",{attrs:{color:"primary",size:"40px"}})],1)]},proxy:!0}])},[a("q-input",{attrs:{placeholder:"輸入篩選文字",outlined:"",dense:"",square:""},on:{change:function(e){return t.ReloadUser()}},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),t._v(" "),a("q-list",{attrs:{bordered:"",separator:""}},t._l(t.userArr,(function(e,i){return a("q-item",{key:i,attrs:{clickable:"",active:t.selectIndex==i,"active-class":"bg-green-2"},on:{click:function(e){return t.SelectItem(i)},dblclick:function(e){return t.ConfirmSelect()}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",[a("img",{attrs:{src:e.icon}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[t._v(t._s(e.name))]),t._v(" "),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.contactEmail))])],1)],1)})),1)],1)],1)],1),t._v(" "),a("q-card-actions",{staticClass:"justify-center"},[a("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){return t.ConfirmSelect()}}}),t._v(" "),a("q-btn",{attrs:{flat:"",label:"取消"},on:{click:function(e){return t.CancelSelect()}}})],1)],1)};i._withStripped=!0;var s={name:"user-select",props:{},components:{},data:function(){return{searchKey:"",userArr:[],hasMore:!0,selectIndex:-1}},created:function(){},methods:{LoadMoreUser:function(t,e){var a="/user/list-user";a+="?page="+(t-1),a+="&keyword="+this.searchKey,$.get(a,function(t){"ok"==t.status&&(this.hasMore=t.data.hasMore,this.hasMore||this.$refs.userScroll.stop(),this.userArr=this.userArr.concat(t.data.user),e())}.bind(this))},ReloadUser:function(){this.userArr=[],this.$refs.userScroll.reset(),this.$refs.userScroll.resume(),this.selectIndex=-1},GetSelectUser:function(){return this.selectIndex<0||this.selectIndex>=this.userArr.length?null:this.userArr[this.selectIndex]},SelectItem:function(t){this.selectIndex=t,this.$emit("change")},ConfirmSelect:function(){if(this.selectIndex<0||this.selectIndex>=this.userArr.length)return alert("請選擇使用者");this.$emit("confirm")},CancelSelect:function(){this.$emit("cancel")}}},n=(a(48),a(0)),r=Object(n.a)(s,i,[],!1,null,null,null);r.options.__file="src/vue/user-select.vue";e.a=r.exports},function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-list q-pa-sm"},[a("div",{staticClass:"row items-center"},[t.enableAdd?a("div",{staticClass:"col-shrink q-pr-lg"},[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"add",label:"新增名單"},on:{click:function(e){t.openUserSelect=!0}}})],1):t._e(),t._v(" "),t.enableSearch?a("div",{staticClass:"col-12 col-sm-6 col-md-3"},[a("q-input",{attrs:{label:"搜尋名單"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.ReloadUserList()}},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"search"},on:{click:function(e){return t.ReloadUserList()}}})]},proxy:!0}],null,!1,1309159698),model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1):t._e()]),t._v(" "),a("q-list",{staticClass:"q-my-md",attrs:{bordered:""}},t._l(t.userArr,(function(e,i){return a("q-item",{key:e._id},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",[a("img",{attrs:{src:e.icon}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[t._v(t._s(e.name))]),t._v(" "),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.contactEmail))])],1),t._v(" "),t.enableRemove?a("q-item-section",{attrs:{side:""}},[a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",icon:"close"},on:{click:function(e){return t.RemoveUser(i)}}})],1):t._e()],1)})),1),t._v(" "),t.list?t._e():a("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.hasMoreUser,expression:"hasMoreUser"}],staticClass:"full-width bg-grey-4 q-ma-sm",attrs:{label:"載入更多"},on:{click:function(e){return t.LoadMoreUserList()}}}),t._v(" "),a("q-dialog",{model:{value:t.openUserSelect,callback:function(e){t.openUserSelect=e},expression:"openUserSelect"}},[a("user-select",{ref:"userSelect",on:{confirm:function(e){return t.AddUser()},cancel:function(e){t.openUserSelect=!1}}})],1)],1)};i._withStripped=!0;var s=a(28),n={name:"user-list",props:{enableAdd:Boolean,enableSearch:Boolean,enableRemove:Boolean,userAuth:String,userStatus:String,list:Array},components:{"user-select":s.a},data:function(){return{searchKey:"",userArr:[],userPage:0,hasMoreUser:!0,openUserSelect:!1}},created:function(){this.list?this.userArr=this.list:this.LoadMoreUserList()},methods:{LoadMoreUserList:function(){var t="/user/list-user";t+="?page="+this.userPage,t+="&keyword="+this.searchKey,this.userAuth&&(t+="&authType="+this.userAuth),this.userStatus&&(t+="&status="+this.userStatus),$.get(t,function(t){"ok"==t.status&&(this.hasMoreUser=t.data.hasMore,this.userArr=this.userArr.concat(t.data.user),this.userPage++)}.bind(this))},ClearUserList:function(){this.userArr=[],this.userPage=0},ReloadUserList:function(){this.ClearUserList(),this.list?this.userArr=this.list.filter((function(t){return-1!=t.name.indexOf(this.searchKey)||-1!=t.contactEmail.indexOf(this.searchKey)})):this.LoadMoreUserList()},AddUser:function(){this.openUserSelect=!1;var t=this.$refs.userSelect.GetSelectUser();t&&this.$emit("add",t)},RemoveUser:function(t){this.$emit("remove",t)}}},r=(a(50),a(0)),o=Object(r.a)(n,i,[],!1,null,null,null);o.options.__file="src/vue/user-list.vue";e.a=o.exports},function(t,e,a){"use strict";var i=a(4);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".topbar{width:100%}.topbar a{text-decoration:none}\n",""]),t.exports=e},function(t,e,a){var i=a(1),s=a(86);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},,,,,,,function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-card",{staticClass:"dataset-editor"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("編輯資料集")])]),t._v(" "),a("q-card-section",[a("q-form",[a("q-item",[a("div",{staticClass:"cover-container bg-grey-7"},[a("image-upload",{ref:"uploader",attrs:{src:t.info.picCover||"/static/image/logo-16-9.png",showPreview:"",maxResW:parseInt(t.info.maxWidth),maxResH:parseInt(t.info.maxHeight)}}),t._v(" "),a("q-btn",{staticClass:"change-bt",attrs:{loading:t.uploadCover,flat:"",label:"變更封面"},on:{click:function(e){return t.ChangeCover()}}})],1)]),t._v(" "),a("div",{staticClass:"row"},[a("q-input",{ref:"name",staticClass:"col-12 q-pa-sm",attrs:{label:"資料集名稱",rules:[function(t){return!!t||"資料集名稱不能空白"}]},model:{value:t.info.name,callback:function(e){t.$set(t.info,"name",e)},expression:"info.name"}}),t._v(" "),a("q-input",{staticClass:"full-width q-px-sm",attrs:{label:"資料集簡介",filled:"",type:"textarea"},model:{value:t.info.desc,callback:function(e){t.$set(t.info,"desc",e)},expression:"info.desc"}}),t._v(" "),a("q-input",{ref:"maxWidth",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{type:"number",label:"最大寬度",rules:[function(t){return!!t||"最大寬度不能空白"},function(t){return t>=32||"最大寬度不能小於32"},function(t){return t<=1920||"最大寬度不能大於1920"}]},model:{value:t.info.maxWidth,callback:function(e){t.$set(t.info,"maxWidth",e)},expression:"info.maxWidth"}}),t._v(" "),a("q-input",{ref:"maxHeight",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{type:"number",label:"最大高度",rules:[function(t){return!!t||"最大高度不能空白"},function(t){return t>=32||"最大高度不能小於32"},function(t){return t<=1920||"最大高度不能大於1920"}]},model:{value:t.info.maxHeight,callback:function(e){t.$set(t.info,"maxHeight",e)},expression:"info.maxHeight"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"公開資料集"},model:{value:t.info.isPublic,callback:function(e){t.$set(t.info,"isPublic",e)},expression:"info.isPublic"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"開放上傳影像"},model:{value:t.info.enableUpload,callback:function(e){t.$set(t.info,"enableUpload",e)},expression:"info.enableUpload"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"開放下載資料集"},model:{value:t.info.enableDownload,callback:function(e){t.$set(t.info,"enableDownload",e)},expression:"info.enableDownload"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"儲存位置資訊"},model:{value:t.info.enableGPS,callback:function(e){t.$set(t.info,"enableGPS",e)},expression:"info.enableGPS"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"開放編輯標註"},model:{value:t.info.enableAnnotation,callback:function(e){t.$set(t.info,"enableAnnotation",e)},expression:"info.enableAnnotation"}}),t._v(" "),a("q-select",{ref:"annotationType",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{options:t.annotationTypeOption,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"標註方式",rules:[function(t){return!!t||"標註方式不能空白"}]},model:{value:t.info.annotationType,callback:function(e){t.$set(t.info,"annotationType",e)},expression:"info.annotationType"}}),t._v(" "),a("q-input",{staticClass:"col-12 q-pa-sm",attrs:{label:"新增標籤"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.AddTag()}},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"add"},on:{click:function(e){return t.AddTag()}}})]},proxy:!0}]),model:{value:t.tagName,callback:function(e){t.tagName=e},expression:"tagName"}}),t._v(" "),a("div",{staticClass:"full-width"},t._l(t.info.tagArr,(function(e,i){return a("q-chip",{key:e,attrs:{removable:""},on:{remove:function(e){return t.RemoveTag(i)}}},[t._v(t._s(e))])})),1),t._v(" "),a("div",{staticClass:"full-width q-pa-md"},[a("div",{staticClass:"text-h6"},[t._v("表單欄位")]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("使用者上傳影像時將被要求填寫此表單")]),t._v(" "),a("form-editor",{ref:"formEditor",attrs:{data:t.info.form},on:{update:function(e){return t.UpdateForm()}}})],1),t._v(" "),t.info.isPublic?t._e():a("div",{staticClass:"full-width q-pa-md"},[a("div",{staticClass:"text-h6"},[t._v("私密成員")]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("不公開的資料集只有管理員跟私密成員能看到")]),t._v(" "),a("user-list",{ref:"memberList",attrs:{enableAdd:"",enableRemove:"",list:t.info.member},on:{add:t.AddMember,remove:t.RemoveMember}})],1),t._v(" "),a("div",{staticClass:"full-width q-pa-md"},[a("div",{staticClass:"text-h6"},[t._v("資料集版主")]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("版主擁有修改此資料集的完整權限")]),t._v(" "),a("user-list",{ref:"masterList",attrs:{enableAdd:"",enableRemove:"",list:t.info.master},on:{add:t.AddMaster,remove:t.RemoveMaster}})],1),t._v(" "),a("q-select",{ref:"annotationType",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{options:t.externalLinkOption,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"外部連結"},model:{value:t.info.externalLink,callback:function(e){t.$set(t.info,"externalLink",e)},expression:"info.externalLink"}})],1)],1)],1),t._v(" "),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"儲存",color:"primary"},on:{click:function(e){return t.UpdateDataset()}}}),t._v(" "),a("q-btn",{attrs:{flat:"",label:"取消",color:"primary"},on:{click:function(e){return t.$emit("cancel")}}})],1)],1)};i._withStripped=!0;var s=a(22),n=a(29),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form-editor q-pa-sm"},[a("div",{staticClass:"row items-center"},[a("div",{staticClass:"col-shrink q-pr-lg"},[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"add",label:"新增欄位"},on:{click:function(e){return t.OpenAddItem()}}})],1)]),t._v(" "),a("q-list",{staticClass:"q-my-md",attrs:{bordered:""}},t._l(t.editData.itemArr,(function(e,i){return a("q-item",{key:e.id},[a("q-item-section",[a("div",["true"==e.canNotEmpty?a("span",{staticClass:"text-red"},[t._v("*")]):t._e(),t._v("\n\t\t\t\t\t"+t._s(e.quest)+"\n\t\t\t\t")])]),t._v(" "),a("q-item-section",{attrs:{side:""}},[a("div",{staticClass:"row"},[a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",dense:"",icon:"arrow_circle_up"},on:{click:function(e){return t.MoveItemUp(i)}}}),t._v(" "),a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",dense:"",icon:"arrow_circle_down"},on:{click:function(e){return t.MoveItemDown(i)}}}),t._v(" "),a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",dense:"",icon:"edit"},on:{click:function(e){return t.EditItem(i)}}}),t._v(" "),a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",dense:"",icon:"close"},on:{click:function(e){return t.RemoveItem(i)}}})],1)])],1)})),1),t._v(" "),a("q-dialog",{model:{value:t.openEditItem,callback:function(e){t.openEditItem=e},expression:"openEditItem"}},[a("q-card",{staticClass:"full-width"},[a("q-card-section",[t.editItem.id?a("div",{staticClass:"text-h6"},[t._v("新增欄位")]):a("div",{staticClass:"text-h6"},[t._v("編輯欄位")]),t._v(" "),a("div",{staticClass:"row"},[a("q-select",{ref:"type",staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{dense:"",options:t.typeOption,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"填答類型",disable:null!=t.editItem.id,rules:[function(t){return!!t||"填答類型不能空白"}]},model:{value:t.editItem.type,callback:function(e){t.$set(t.editItem,"type",e)},expression:"editItem.type"}}),t._v(" "),a("q-toggle",{staticClass:"col-12 col-sm-6 q-pa-sm",attrs:{label:"必填欄位","true-value":"true","false-value":"false"},model:{value:t.editItem.canNotEmpty,callback:function(e){t.$set(t.editItem,"canNotEmpty",e)},expression:"editItem.canNotEmpty"}}),t._v(" "),a("q-input",{ref:"quest",staticClass:"col-12 q-pa-sm",attrs:{label:"欄位名稱",rules:[function(t){return!!t||"欄位名稱不能空白"}]},model:{value:t.editItem.quest,callback:function(e){t.$set(t.editItem,"quest",e)},expression:"editItem.quest"}}),t._v(" "),"radio"==t.editItem.type||"checkbox"==t.editItem.type?a("div",[a("q-input",{staticClass:"col-12 q-pa-sm",attrs:{label:"新增選項"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.AddItemOption()}},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{attrs:{round:"",dense:"",flat:"",icon:"add"},on:{click:function(e){return t.AddItemOption()}}})]},proxy:!0}],null,!1,876527129),model:{value:t.optionName,callback:function(e){t.optionName=e},expression:"optionName"}}),t._v(" "),a("div",{staticClass:"full-width"},t._l(t.editItem.option,(function(e,i){return a("q-chip",{key:e,attrs:{removable:""},on:{remove:function(e){return t.RemoveItemOption(i)}}},[t._v(t._s(e))])})),1)],1):t._e(),t._v(" "),"checkbox"==t.editItem.type?a("div",{staticClass:"col-12 row"},[a("q-input",{staticClass:"col q-ma-sm",attrs:{type:"number",label:"最少選幾項",min:0,max:t.editItem.option.length},model:{value:t.editItem.attr.minCheck,callback:function(e){t.$set(t.editItem.attr,"minCheck",t._n(e))},expression:"editItem.attr.minCheck"}}),t._v(" "),a("q-input",{staticClass:"col q-ma-sm",attrs:{type:"number",label:"最多選幾項",min:0,max:t.editItem.option.length},model:{value:t.editItem.attr.maxCheck,callback:function(e){t.$set(t.editItem.attr,"maxCheck",t._n(e))},expression:"editItem.attr.maxCheck"}})],1):t._e(),t._v(" "),"number"==t.editItem.type?a("div",{staticClass:"col-12 row"},[a("q-input",{staticClass:"col q-ma-sm",attrs:{type:"number",label:"最小數值"},model:{value:t.editItem.attr.minValue,callback:function(e){t.$set(t.editItem.attr,"minValue",t._n(e))},expression:"editItem.attr.minValue"}}),t._v(" "),a("q-input",{staticClass:"col q-ma-sm",attrs:{type:"number",label:"最大數值"},model:{value:t.editItem.attr.maxValue,callback:function(e){t.$set(t.editItem.attr,"maxValue",t._n(e))},expression:"editItem.attr.maxValue"}})],1):t._e()],1)]),t._v(" "),a("q-card-actions",{staticClass:"justify-center"},[a("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){return t.ConfirmEdit()}}}),t._v(" "),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消"}})],1)],1)],1)],1)};r._withStripped=!0;var o={name:"form-editor",props:{data:Object},components:{},data:function(){return{openEditItem:!1,editData:{},editItem:{},editIndex:-1,typeOption:[{label:"文字",value:"text"},{label:"單選",value:"radio"},{label:"多選",value:"checkbox"},{label:"數字",value:"number"}],optionName:""}},created:function(){this.editData=Object.assign({},this.data)},methods:{OpenAddItem:function(){this.openEditItem=!0,this.editItem={type:"text",canNotEmpty:"false",option:[],attr:{}}},AddItemOption:function(){this.editItem.option||Vue.set(this.editItem,"option",[]),this.editItem.option.includes(this.optionName)?alert("此選項已存在"):this.editItem.option.push(this.optionName),this.optionName=""},RemoveItemOption:function(t){this.editItem.option.splice(t,1)},MoveItemUp:function(t){if(!(t<=0)){var e=this.editData.itemArr[t-1];this.editData.itemArr[t-1]=this.editData.itemArr[t],this.editData.itemArr[t]=e,this.$forceUpdate(),this.$emit("update")}},MoveItemDown:function(t){if(!(t>=this.editData.itemArr.length-1)){var e=this.editData.itemArr[t+1];this.editData.itemArr[t+1]=this.editData.itemArr[t],this.editData.itemArr[t]=e,this.$forceUpdate(),this.$emit("update")}},EditItem:function(t){this.editIndex=t,this.editItem=Object.assign({},this.editData.itemArr[t]),this.editItem.attr||(this.editItem.attr={}),this.openEditItem=!0},RemoveItem:function(t){this.editData.itemArr.splice(t,1),this.$emit("update")},GenerateID:function(){return Math.random().toString(36).substring(2,15)},ConfirmEdit:function(){return this.$refs.type.validate(),this.$refs.type.hasError?this.$q.notify({color:"negative",message:"填答類型不能空白"}):(this.$refs.quest.validate(),this.$refs.quest.hasError?this.$q.notify({color:"negative",message:"欄位名稱不能空白"}):"radio"!=this.editItem.type&&"checkbox"!=this.editItem.type||0!=this.editItem.option.length?this.editItem.attr.minCheck&&(this.editItem.attr.minCheck<1||this.editItem.attr.minCheck>this.editItem.option.length)?this.$q.notify({color:"negative",message:"最少選幾項超出選項範圍"}):this.editItem.attr.maxCheck&&(this.editItem.attr.maxCheck<1||this.editItem.attr.maxCheck>this.editItem.option.length)?this.$q.notify({color:"negative",message:"最多選幾項超出選項範圍"}):this.editItem.attr.minCheck&&this.editItem.attr.maxCheck&&this.editItem.attr.minCheck>this.editItem.attr.maxCheck?this.$q.notify({color:"negative",message:"最少選幾項不能大於最多選幾項"}):this.editItem.attr.minValue&&this.editItem.attr.maxValue&&this.editItem.attr.minValue>this.editItem.attr.maxValue?this.$q.notify({color:"negative",message:"最小數值不能大於最大數值"}):(this.openEditItem=!1,this.editData.itemArr||(this.editData.itemArr=[]),this.editItem.id?(this.editData.itemArr[this.editIndex]=Object.assign({},this.editItem),this.editIndex=-1):(this.editItem.id=this.GenerateID(),this.editData.itemArr.push(this.editItem)),void this.$emit("update")):this.$q.notify({color:"negative",message:"請新增選項"}))}}},l=(a(52),a(0)),c=Object(l.a)(o,r,[],!1,null,null,null);c.options.__file="src/vue/form-editor.vue";var u=c.exports,d={name:"dataset-editor",props:{info:Object},components:{"image-upload":s.a,"user-list":n.a,"form-editor":u},data:function(){return{annotationTypeOption:[{label:"框選標註",value:"bbox"},{label:"整張標註",value:"image"}],externalLinkOption:[{label:"無",value:""},{label:"山河事件簿",value:"riverlog"},{label:"紫豹在哪裡",value:"purbao"}],tagName:"",uploadCover:!1}},created:function(){},methods:{ChangeCover:function(){if(!this.uploadCover){var t=this.$refs.uploader;t.OnSucc=function(t){if("ok"!=t.status)return alert("更新圖片失敗");this.uploadCover=!1,this.$emit("updateCover")}.bind(this),t.OnFail=function(t){switch(console.log(t),t){case"Request Entity Too Large":return alert("影像資料過大")}}.bind(this),t.OnChange=function(){this.uploadCover=!0,t.UploadImage()}.bind(this),t.url="/dataset/change-cover",t.additionData={dataset:this.info._id},t.SelectFile()}},UpdateDataset:function(){if(this.$refs.name.validate(),this.$refs.name.hasError)return this.$q.notify({color:"negative",message:"資料集名稱無效"});if(this.$refs.maxWidth.validate(),this.$refs.maxWidth.hasError)return this.$q.notify({color:"negative",message:"最大寬度無效"});if(this.$refs.maxHeight.validate(),this.$refs.maxHeight.hasError)return this.$q.notify({color:"negative",message:"最大高度無效"});if(this.$refs.annotationType.validate(),this.$refs.annotationType.hasError)return this.$q.notify({color:"negative",message:"標註方式無效"});if(0==this.info.tagArr.length)return this.$q.notify({color:"negative",message:"請至少新增一個標籤"});var t=$("meta[name='csrf-token']").attr("content"),e={};e.dataset=this.info._id,e.info=this.info,e._csrf=t,$.post("/dataset/update-dataset",e,function(t){if("ok"!=t.status)return alert("修改失敗");this.$q.notify("修改成功"),this.$emit("confirm")}.bind(this))},AddTag:function(){this.info.tagArr||Vue.set(this.info,"tagArr",[]),this.info.tagArr.includes(this.tagName)?alert("此標籤已存在"):this.info.tagArr.push(this.tagName),this.tagName=""},RemoveTag:function(t){this.info.tagArr.splice(t,1)},AddMember:function(t){0==this.info.member.filter((function(e){return e._id==t._id})).length?this.info.member.unshift(t):this.$q.notify("此使用者已是私密成員")},RemoveMember:function(t){this.info.member.splice(t,1)},AddMaster:function(t){0==this.info.master.filter((function(e){return e._id==t._id})).length?this.info.master.unshift(t):this.$q.notify("此使用者已是私密成員")},RemoveMaster:function(t){this.info.master.splice(t,1)},UpdateForm:function(){var t=this.$refs.formEditor.editData;this.info.form=Object.assign({},t)}}},f=(a(54),Object(l.a)(d,i,[],!1,null,null,null));f.options.__file="src/vue/dataset-editor.vue";e.a=f.exports},,function(t,e,a){"use strict";var i=a(5);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".dataset-select{width:100%}\n",""]),t.exports=e},,,,function(t,e,a){"use strict";var i=a(9);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".image-upload{width:100%;height:100%}.image-upload img{width:100%;height:100%;object-fit:cover}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(10);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".user-select{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(11);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".user-list{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(12);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".form-editor{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(13);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".dataset-editor{width:100%}.dataset-editor .cover-container{width:320px;height:240px;position:relative}.dataset-editor .cover-container .change-bt{position:absolute;bottom:0px;left:0px;width:100%;background-color:rgba(0,0,0,0.5);color:#ffffff}\n",""]),t.exports=e},,,,,,,,,,,,,,,,,function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dataset-list"},["edit"==t.mode?a("div",{staticClass:"row q-px-md"},[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"add",label:"新增資料集"},on:{click:function(e){return t.AddDataset()}}})],1):t._e(),t._v(" "),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12 col-sm-6 col-md-3 q-pa-md"},[a("q-input",{attrs:{dense:"",label:"搜尋資料集"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.ReloadDataset()}},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"search"},on:{click:function(e){return t.ReloadDataset()}}})]},proxy:!0}]),model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1),t._v(" "),a("div",{staticClass:"col-12 col-sm-6 col-md-3 q-pa-md"},[a("q-select",{attrs:{dense:"",options:t.sortOption,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"排序"},on:{input:function(e){return t.ReloadDataset()}},model:{value:t.sortKey,callback:function(e){t.sortKey=e},expression:"sortKey"}})],1),t._v(" "),a("div",{staticClass:"col-6 col-sm-4 col-md-2 q-pa-md"},[a("q-select",{attrs:{dense:"",options:t.orderTypeOption,"option-value":"value","option-label":"label","emit-value":"","map-options":""},on:{input:function(e){return t.ReloadDataset()}},model:{value:t.orderType,callback:function(e){t.orderType=e},expression:"orderType"}})],1)]),t._v(" "),a("div",{staticClass:"row q-col-gutter-md q-mb-md"},t._l(t.datasetArr,(function(e){return a("div",{staticClass:"col-12 col-sm-6 col-md-3"},[a("q-card",{staticClass:"bg-grey-7 text-white"},[a("q-img",{staticClass:"cursor-pointer",attrs:{src:e.picCover||"/static/image/logo-16-9.png",ratio:16/9},on:{click:function(a){return t.GoToDataset(e)}}},[e.isPublic?t._e():a("div",{staticClass:"absolute-top"},[t._v("\n\t\t\t\t\t\t不公開\n\t\t\t\t\t")])]),t._v(" "),a("q-separator",{attrs:{dark:""}}),t._v(" "),a("q-card-section",{staticClass:"cursor-pointer",on:{click:function(a){return t.GoToDataset(e)}}},[a("div",{staticClass:"text-h6"},[t._v(t._s(e.name))]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("影像數: "+t._s(e.picNum))]),t._v(" "),a("div",{staticClass:"text-subtitle2"},[t._v("標註數: "+t._s(e.annotationNum))])]),t._v(" "),a("q-separator",{attrs:{dark:""}}),t._v(" "),"edit"==t.mode?a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",icon:"edit",label:"修改"},on:{click:function(a){return t.ModifyDataset(e)}}}),t._v(" "),a("q-btn",{attrs:{flat:"",icon:"delete",label:"刪除"},on:{click:function(a){return t.DeleteDataset(e)}}})],1):t._e()],1)],1)})),0),t._v(" "),a("q-btn",{directives:[{name:"show",rawName:"v-show",value:t.hasMoreDataset,expression:"hasMoreDataset"}],staticClass:"full-width bg-grey-4 q-ma-sm",attrs:{label:"載入更多"},on:{click:function(e){return t.LoadMoreDataset()}}}),t._v(" "),a("q-dialog",{model:{value:t.openDatasetEditor,callback:function(e){t.openDatasetEditor=e},expression:"openDatasetEditor"}},[a("dataset-editor",{attrs:{info:t.editInfo},on:{confirm:function(e){return t.ReloadDataset(!0)},cancel:function(e){t.openDatasetEditor=!1},updateCover:function(e){return t.ReloadDataset(!1)}}})],1)],1)};i._withStripped=!0;var s=a(39),n={name:"dataset-list",props:{mode:String},components:{"dataset-editor":s.a},data:function(){return{searchKey:"",sortKey:"createdAt",sortOption:[{label:"建立時間",value:"createdAt"},{label:"更新時間",value:"updatedAt"},{label:"圖片數",value:"picNum"},{label:"標註數",value:"annotationNum"}],orderType:"desc",orderTypeOption:[{label:"遞減",value:"desc"},{label:"遞增",value:"asc"}],datasetArr:[],datasetPage:0,hasMoreDataset:!0,editInfo:{},openDatasetEditor:!1,favoriteID:[]}},created:function(){this.LoadMoreDataset()},methods:{LoadMoreDataset:function(){var t="/dataset/list-dataset";t+="?page="+this.datasetPage,t+="&sort="+this.sortKey,t+="&orderType="+this.orderType,t+="&keyword="+this.searchKey,"favorite"==this.mode&&(t+="&favorite=1"),$.get(t,function(t){"ok"==t.status&&(this.hasMoreDataset=t.data.hasMore,this.datasetArr=this.datasetArr.concat(t.data.dataset),this.datasetPage++)}.bind(this))},ClearDataset:function(){this.datasetArr=[],this.datasetPage=0},ReloadDataset:function(t){this.ClearDataset(),this.LoadMoreDataset(),t&&(this.openDatasetEditor=!1)},AddDataset:function(){var t=$("meta[name='csrf-token']").attr("content"),e={};e._csrf=t,$.post("/dataset/create-dataset",e,function(t){if("ok"!=t.status)return alert("新增失敗");this.ReloadDataset(),this.openDatasetEditor=!0,this.editInfo=t.data}.bind(this))},ModifyDataset:function(t){this.openDatasetEditor=!0,this.editInfo=Object.assign({},t)},DeleteDataset:function(t){if(confirm("刪除資料集將一併刪除所有影像與標註資料，並且無法復原。確定刪除資料集 "+t.name+"?")){var e=$("meta[name='csrf-token']").attr("content"),a={};a.id=t._id,a._csrf=e,$.post("/dataset/delete-dataset",a,function(t){if("ok"!=t.status)return alert("刪除失敗");this.ReloadDataset()}.bind(this))}},GoToDataset:function(t){window.location.href="/dataset?id="+t._id}}},r=(a(85),a(0)),o=Object(r.a)(n,i,[],!1,null,null,null);o.options.__file="src/vue/dataset-list.vue";e.a=o.exports},,,function(t,e,a){var i=a(1),s=a(107);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(109);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(111);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(113);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},function(t,e,a){var i=a(1),s=a(115);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var n={insert:"head",singleton:!1},r=(i(t.i,s,n),s.locals?s.locals:{});t.exports=r},,,,,,function(t,e,a){"use strict";var i=a(32);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".dataset-list{width:100%}\n",""]),t.exports=e},,,,,,,,,,,,,,,,,,,function(t,e,a){t.exports=a(129)},function(t,e,a){"use strict";var i=a(75);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".user-setting{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(76);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".dataset-select-list{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(77);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".api-key-list{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(78);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".site-admin{width:100%}\n",""]),t.exports=e},function(t,e,a){"use strict";var i=a(79);a.n(i).a},function(t,e,a){(e=a(2)(!1)).push([t.i,".account{width:100%;height:100%}.account .indent{text-indent:2em}.account .first-letter:first-letter{font-size:1.3em;color:#ff3333}\n",""]),t.exports=e},,,,,,,,,,,,,,function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-layout",{staticClass:"account shadow-2 bg-grey-1",attrs:{view:"hHh Lpr lFf",container:""}},[a("q-header",[a("topbar",{attrs:{useMenu:"",user:t.user},on:{toggleMenu:function(e){t.openLeftPanel=!t.openLeftPanel}}})],1),t._v(" "),a("q-drawer",{attrs:{width:200,bordered:"","content-class":"bg-grey-2"},model:{value:t.openLeftPanel,callback:function(e){t.openLeftPanel=e},expression:"openLeftPanel"}},[a("q-scroll-area",{staticClass:"fit"},[a("q-list",[a("q-item",{attrs:{clickable:"",active:"setting"===t.tab,"active-class":"bg-grey-7 text-white"},on:{click:function(e){return t.ChangeTab("setting")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"settings_applications"}})],1),t._v(" "),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("帳號設定")])],1)],1),t._v(" "),a("q-item",{attrs:{clickable:"",active:"favorite"===t.tab,"active-class":"bg-grey-7 text-white"},on:{click:function(e){return t.ChangeTab("favorite")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"star_border"}})],1),t._v(" "),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("收藏清單")])],1)],1),t._v(" "),"admin"==t.user.authType?a("q-item",{attrs:{clickable:"",active:"data-admin"===t.tab,"active-class":"bg-grey-7 text-white"},on:{click:function(e){return t.ChangeTab("data-admin")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"view_quilt"}})],1),t._v(" "),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("資料集管理")])],1)],1):t._e(),t._v(" "),"admin"==t.user.authType?a("q-item",{attrs:{clickable:"",active:"site-admin"===t.tab,"active-class":"bg-grey-7 text-white"},on:{click:function(e){return t.ChangeTab("site-admin")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"supervisor_account"}})],1),t._v(" "),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("站務管理")])],1)],1):t._e(),t._v(" "),a("q-item",{attrs:{clickable:"",active:"about"===t.tab,"active-class":"bg-grey-7 text-white"},on:{click:function(e){return t.ChangeTab("about")}}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"info"}})],1),t._v(" "),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("關於本站")])],1)],1),t._v(" "),a("q-item",{attrs:{clickable:"",tag:"a",href:"/auth/logout"}},[a("q-item-section",{attrs:{avatar:""}},[a("q-icon",{attrs:{name:"keyboard_return"}})],1),t._v(" "),a("q-item-section",[a("q-item-label",{staticClass:"text-subtitle1"},[t._v("登出")])],1)],1)],1)],1)],1),t._v(" "),a("q-page-container",[a("q-tab-panels",{staticClass:"transparent",attrs:{animated:"","transition-prev":"slide-right","transition-next":"slide-left"},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[a("q-tab-panel",{attrs:{name:"setting"}},[a("user-setting",{attrs:{user:t.user}})],1),t._v(" "),a("q-tab-panel",{attrs:{name:"favorite"}},[a("dataset-list",{attrs:{mode:"favorite"}})],1),t._v(" "),a("q-tab-panel",{attrs:{name:"data-admin"}},[a("dataset-list",{attrs:{mode:"edit"}})],1),t._v(" "),a("q-tab-panel",{attrs:{name:"site-admin"}},[a("site-admin",{attrs:{user:t.user}})],1),t._v(" "),a("q-tab-panel",{attrs:{name:"about"}},[a("q-card",{staticClass:"full-width bg-green-1",attrs:{flat:""}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("關於群眾標註")]),t._v(" "),a("div",{staticClass:"text-subtitle1 q-pt-md indent first-letter"},[t._v("\n\t\t\t\t\t\t\t群眾標註是給公民科學社群分享影像資訊與知識的工具，產出的資料集可以提供機器學習(AI訓練)，也可以提供社群學習(新手訓練)。\n\t\t\t\t\t\t\t凡舉生態調查、資源盤點、汙染回報、動植物辨識、病蟲害辨識、垃圾分類等，跟影像辨識相關的議題都可以利用此工具協助收集、分析資料。\n\t\t\t\t\t\t")]),t._v(" "),a("div",{staticClass:"text-subtitle1 q-py-md indent"},[t._v("\n\t\t\t\t\t\t\t本專案為開放原始碼，也提供API讓無人載具上傳影像資料，您可請參考下方的「開放原始碼」取得進一步資訊。若您對本站有任何建議或合作需求，歡迎來信討論 aga3134@gmail.com\n\t\t\t\t\t\t")]),t._v(" "),a("div",{staticClass:"q-pa-md"},[a("q-chip",{attrs:{clickable:"",icon:"code"},on:{click:function(e){return t.GoToUrl("https://github.com/aga3134/CommuTag","_blank")}}},[t._v("開放原始碼")]),t._v(" "),a("q-chip",{attrs:{clickable:"",icon:"computer"},on:{click:function(e){return t.GoToUrl("https://agawork.tw/","_blank")}}},[t._v("其他專案")])],1)])],1)],1)],1)],1),t._v(" "),a("q-footer",[a("q-btn",{staticClass:"full-width bg-grey-8",attrs:{icon:"home",label:"回首頁"},on:{click:function(e){return t.GoHome()}}})],1)],1)};i._withStripped=!0;var s=a(3),n=(a(25),a(21)),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-setting"},[a("q-card",{staticClass:"q-ma-md transparent",attrs:{flat:""}},[a("div",{staticClass:"row q-pa-md justify-center"},[a("q-avatar",{attrs:{size:"200px"}},[a("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.user.photo}})]),t._v(" "),a("div",{staticClass:"row items-end"},[a("q-markup-table",{staticClass:"transparent text-grey-9",attrs:{flat:"",separator:"vertical"}},[a("tr",[a("td",{staticClass:"text-right text-subtitle1"},[t._v("姓名")]),t._v(" "),a("td",{staticClass:"text-left text-subtitle1"},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.user.name)+"\n\t\t\t\t\t\t\t")])]),t._v(" "),a("tr",[a("td",{staticClass:"text-right text-subtitle1"},[t._v("聯絡信箱")]),t._v(" "),a("td",{staticClass:"text-left text-subtitle1"},[t._v(t._s(t.user.contactEmail))])]),t._v(" "),a("tr",[a("td",{staticClass:"text-right text-subtitle1"},[t._v("權限")]),t._v(" "),a("td",{staticClass:"text-left text-subtitle1"},[t._v(t._s(t.userAuth))])]),t._v(" "),a("tr",[a("td",{staticClass:"text-right text-subtitle1"},[t._v("狀態")]),t._v(" "),a("td",{staticClass:"text-left text-subtitle1"},[t._v(t._s(t.userStatus))])])])],1)],1),t._v(" "),a("q-card-actions",{attrs:{align:"center"}},[a("q-btn",{staticClass:"bg-grey-8 text-white q-px-sm",attrs:{flat:"",icon:"add_photo_alternate",label:"變更圖片",loading:t.uploadPhoto},on:{click:function(e){return t.ChangePhoto()}}}),t._v(" "),a("q-btn",{staticClass:"bg-grey-8 text-white q-px-sm",attrs:{flat:"",icon:"edit",label:"修改資料"},on:{click:function(e){return t.EditUserInfo()}}})],1),t._v(" "),a("image-upload",{ref:"uploader",attrs:{maxResW:640,maxResH:640}})],1),t._v(" "),a("q-dialog",{model:{value:t.openInputPanel,callback:function(e){t.openInputPanel=e},expression:"openInputPanel"}},[a("q-card",{staticClass:"full-width"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("修改資料")]),t._v(" "),a("q-form",[a("q-input",{staticClass:"q-my-sm",attrs:{label:"姓名"},model:{value:t.editInfo.name,callback:function(e){t.$set(t.editInfo,"name",e)},expression:"editInfo.name"}}),t._v(" "),a("q-input",{staticClass:"q-my-sm",attrs:{label:"聯絡信箱"},model:{value:t.editInfo.contactEmail,callback:function(e){t.$set(t.editInfo,"contactEmail",e)},expression:"editInfo.contactEmail"}})],1)],1),t._v(" "),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"儲存",color:"primary"},on:{click:function(e){return t.SubmitUserInfo()}}}),t._v(" "),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}})],1)],1)],1)],1)};r._withStripped=!0;var o=a(22),l={name:"user-setting",props:{user:Object},components:{"image-upload":o.a},data:function(){return{editInfo:{},uploadPhoto:!1,openInputPanel:!1}},created:function(){},methods:{EditUserInfo:function(){this.openInputPanel=!0,this.editInfo.name=this.user.name,this.editInfo.contactEmail=this.user.contactEmail},ChangePhoto:function(){if(!this.uploadPhoto){var t=this.$refs.uploader;t.OnSucc=function(t){if("ok"!=t.status)return alert("更新圖片失敗");this.uploadPhoto=!1,window.location.reload()}.bind(this),t.OnFail=function(t){switch(console.log(t),t){case"Request Entity Too Large":return alert("影像資料過大")}}.bind(this),t.OnChange=function(){this.uploadPhoto=!0,t.UploadImage()}.bind(this),t.url="/user/upload-image",t.SelectFile()}},SubmitUserInfo:function(){if(!this.editInfo.name)return alert("請輸入您的姓名");var t=$("meta[name='csrf-token']").attr("content");$.post("/user/edit",{data:this.editInfo,_csrf:t},function(t){alert("ok"==t.status?"修改成功":"修改失敗"),window.location.reload()}.bind(this))}},computed:{userAuth:function(){switch(this.user.authType){case"admin":return"管理員";case"user":return"一般"}},userStatus:function(){switch(this.user.status){case"blacklist":return"黑名單";case"valid":return"正常"}}}},c=(a(106),a(0)),u=Object(c.a)(l,r,[],!1,null,null,null);u.options.__file="src/vue/account-user-setting.vue";var d=u.exports,f=a(72),m=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"site-admin"},[a("div",{staticClass:"text-h6"},[t._v("管理員名單")]),t._v(" "),a("user-list",{ref:"adminList",attrs:{enableAdd:"",enableSearch:"",enableRemove:"",userAuth:"admin"},on:{add:t.AddAdmin,remove:t.RemoveAdmin}}),t._v(" "),a("div",{staticClass:"text-h6"},[t._v("黑名單")]),t._v(" "),a("div",{staticClass:"text-subtitle2 text-grey-7"},[t._v("被列為黑名單者無法上傳、標註、驗證影像")]),t._v(" "),a("user-list",{ref:"blackList",attrs:{enableAdd:"",enableSearch:"",enableRemove:"",userStatus:"blacklist"},on:{add:t.AddBlacklist,remove:t.RemoveBlacklist}}),t._v(" "),a("div",{staticClass:"text-h6"},[t._v("API金鑰")]),t._v(" "),a("div",{staticClass:"text-subtitle2 text-grey-7"},[t._v("金鑰用於讓程式自動化上傳、標註影像")]),t._v(" "),a("api-key-list")],1)};m._withStripped=!0;var h=a(29),p=a(28),v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"api-key-list q-pa-md"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-shrink"},[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"add",label:"新增金鑰"},on:{click:function(e){return t.AddNewKey()}}})],1)]),t._v(" "),a("q-list",{staticClass:"q-my-md",attrs:{bordered:""}},t._l(t.keyArr,(function(e,i){return a("q-item",{key:e._id},[a("q-item-section",[a("q-item-label",[t._v(t._s(e.key))]),t._v(" "),a("q-item-label",{attrs:{caption:"",lines:"1"}},[t._v(t._s(e.desc))])],1),t._v(" "),a("q-item-section",{attrs:{side:""}},[a("div",{staticClass:"row"},[a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",dense:"",icon:"edit"},on:{click:function(e){return t.EditKey(i)}}}),t._v(" "),a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",dense:"",icon:"close"},on:{click:function(e){return t.DeleteKey(i)}}})],1)])],1)})),1),t._v(" "),a("q-dialog",{model:{value:t.openEditKey,callback:function(e){t.openEditKey=e},expression:"openEditKey"}},[a("q-card",{staticClass:"full-width"},[a("q-card-section",[t.editKey._id?a("div",{staticClass:"text-h6"},[t._v("編輯金鑰")]):a("div",{staticClass:"text-h6"},[t._v("新增金鑰")])]),t._v(" "),a("q-card-section",[a("q-input",{staticClass:"q-ma-sm",attrs:{label:"金鑰",disable:t.editKey._id},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{flat:"",label:"亂數產生"},on:{click:function(e){return t.GenRandomKey()}}})]},proxy:!0}]),model:{value:t.editKey.key,callback:function(e){t.$set(t.editKey,"key",e)},expression:"editKey.key"}}),t._v(" "),a("q-select",{staticClass:"q-ma-sm",attrs:{dense:"",options:t.scopeOption,"option-value":"value","option-label":"label","emit-value":"","map-options":"",label:"適用範圍"},model:{value:t.editKey.scope,callback:function(e){t.$set(t.editKey,"scope",e)},expression:"editKey.scope"}}),t._v(" "),"target"==t.editKey.scope?a("dataset-select-list",{attrs:{list:t.editKey.dataset,enableAdd:"",enableRemove:""},on:{add:t.AddDatasetToKey,remove:t.RemoveDatasetFromKey}}):t._e(),t._v(" "),a("div",{staticClass:"text-subtitle1"},[t._v("金鑰說明")]),t._v(" "),a("q-input",{attrs:{filled:""},model:{value:t.editKey.desc,callback:function(e){t.$set(t.editKey,"desc",e)},expression:"editKey.desc"}})],1),t._v(" "),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{attrs:{flat:"",label:"儲存",color:"primary"},on:{click:function(e){return t.AddKey()}}}),t._v(" "),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"取消",color:"primary"}})],1)],1)],1)],1)};v._withStripped=!0;var b=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"dataset-select-list q-pa-sm"},[a("div",{staticClass:"row items-center"},[t.enableAdd?a("div",{staticClass:"col-shrink q-pr-lg"},[a("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{icon:"add",label:"加入資料集"},on:{click:function(e){t.openDatasetSelect=!0}}})],1):t._e()]),t._v(" "),a("q-list",{staticClass:"q-my-md",attrs:{bordered:""}},t._l(t.datasetArr,(function(e,i){return a("q-item",{key:e._id},[a("q-item-section",{attrs:{avatar:""}},[a("q-avatar",[a("img",{attrs:{src:e.picCover||"/static/image/logo.png"}})])],1),t._v(" "),a("q-item-section",[a("q-item-label",[a("a",{staticStyle:{"text-decoration":"none"},attrs:{href:"/dataset?id="+e._id,target:"_blank"}},[t._v(t._s(e.name))])])],1),t._v(" "),t.enableRemove?a("q-item-section",{attrs:{side:""}},[a("q-btn",{staticClass:"text-gray-8",attrs:{flat:"",icon:"close"},on:{click:function(e){return t.RemoveDataset(i)}}})],1):t._e()],1)})),1),t._v(" "),a("q-dialog",{model:{value:t.openDatasetSelect,callback:function(e){t.openDatasetSelect=e},expression:"openDatasetSelect"}},[a("dataset-select",{ref:"datasetSelect",on:{confirm:function(e){return t.AddDataset()},cancel:function(e){t.openDatasetSelect=!1}}})],1)],1)};b._withStripped=!0;var g=a(8),_={name:"dataset-select-list",props:{enableAdd:Boolean,enableRemove:Boolean,list:Array},components:{"dataset-select":g.a},data:function(){return{datasetArr:[],openDatasetSelect:!1}},created:function(){this.LoadDatasetList()},methods:{LoadDatasetList:function(){if(this.list&&0!=this.list.length){var t=this.list.join();$.get("/dataset/list-dataset-by-id?id="+t,function(t){if("ok"!=t.status)return alert("讀取資料集列表失敗");this.datasetArr=t.data}.bind(this))}else this.datasetArr=[]},AddDataset:function(){this.openDatasetSelect=!1;var t=this.$refs.datasetSelect.GetSelectDataset();t&&(0==this.datasetArr.filter(function(e){return t._id==e._id}.bind(this)).length&&(this.datasetArr.push(t),this.$emit("add",t)))},RemoveDataset:function(t){t<0||t>=this.datasetArr.length||(this.datasetArr.splice(t,1),this.$emit("remove",t))}}},y=(a(108),Object(c.a)(_,b,[],!1,null,null,null));y.options.__file="src/vue/dataset-select-list.vue";var x={name:"api-key-list",props:{},components:{"dataset-select-list":y.exports},data:function(){return{keyArr:[],openEditKey:!1,editKey:{key:"",desc:"",scope:"all",dataset:[]},scopeOption:[{label:"全部資料集",value:"all"},{label:"特定資料集",value:"target"}]}},created:function(){this.LoadKey()},methods:{LoadKey:function(){$.get("/api/list-key",function(t){"ok"==t.status&&(this.keyArr=t.data)}.bind(this))},GenRandomKey:function(){this.editKey.key=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},AddNewKey:function(){this.editKey={key:"",desc:"",scope:"all",dataset:[]},this.openEditKey=!0},AddKey:function(){if(!this.editKey.key||""==this.editKey.key)return alert("請輸入金鑰");this.openEditKey=!1;var t=$("meta[name='csrf-token']").attr("content"),e={};e.key=this.editKey.key,e.desc=this.editKey.desc,e.scope=this.editKey.scope,e.dataset=this.editKey.dataset,e._csrf=t,$.post("/api/add-key",e,function(t){if("ok"!=t.status)return alert("修改金鑰失敗");this.$q.notify("修改金鑰成功"),this.LoadKey()}.bind(this))},DeleteKey:function(t){if(!(t<0||t>=this.keyArr.length)){var e=this.keyArr[t];if(confirm("確定刪除金鑰 "+e.key+" ?")){var a=$("meta[name='csrf-token']").attr("content"),i={};i.id=e._id,i._csrf=a,$.post("/api/delete-key",i,function(t){if("ok"!=t.status)return alert("刪除金鑰失敗");this.$q.notify("刪除金鑰成功"),this.LoadKey()}.bind(this))}}},EditKey:function(t){t<0||t>=this.keyArr.length||(this.editKey=this.keyArr[t],this.openEditKey=!0)},AddDatasetToKey:function(t){this.editKey.dataset.push(t._id)},RemoveDatasetFromKey:function(t){t<0||t>=this.keyArr.length||this.editKey.dataset.splice(t,1)}}},q=(a(110),Object(c.a)(x,v,[],!1,null,null,null));q.options.__file="src/vue/api-key-list.vue";var k=q.exports,C={name:"site-admin",components:{"user-list":h.a,"user-select":p.a,"api-key-list":k},props:{user:Object},data:function(){return{}},created:function(){},methods:{UpdateAuth:function(t){var e=$("meta[name='csrf-token']").attr("content"),a={};a.id=t.id,a.authType=t.authType,a.status=t.status,a._csrf=e,$.post("/user/update-auth",a,t.callback)},AddAdmin:function(t){if(confirm("確定將 "+t.name+" 加入管理員名單?")){var e={};e.id=t._id,e.authType="admin",e.callback=function(e){if("ok"!=e.status)return alert("更新權限失敗");this.$q.notify("已將"+t.name+"加入管理員名單"),this.$refs.adminList.ReloadUserList()}.bind(this),this.UpdateAuth(e)}},RemoveAdmin:function(t){var e=this.$refs.adminList.userArr[t];if(e&&confirm("確定將 "+e.name+" 從管理員名單刪除?")){var a={};a.id=e._id,a.authType="user",a.callback=function(t){if("ok"!=t.status)return alert("更新權限失敗");this.$q.notify("已將"+e.name+"從管理員名單刪除"),this.$refs.adminList.ReloadUserList()}.bind(this),this.UpdateAuth(a)}},AddBlacklist:function(t){if(confirm("確定將 "+t.name+" 加入黑名單?")){var e={};e.id=t._id,e.status="blacklist",e.callback=function(e){if("ok"!=e.status)return alert("黑名單設定失敗");this.$q.notify("已將"+t.name+"加入黑名單"),this.$refs.blackList.ReloadUserList()}.bind(this),this.UpdateAuth(e)}},RemoveBlacklist:function(t){var e=this.$refs.blackList.userArr[t];if(e&&confirm("確定將 "+e.name+" 從黑名單刪除?")){var a={};a.id=e._id,a.status="valid",a.callback=function(t){if("ok"!=t.status)return alert("黑名單設定失敗");this.$q.notify("已將"+e.name+"從黑名單刪除"),this.$refs.blackList.ReloadUserList()}.bind(this),this.UpdateAuth(a)}}}},w=(a(112),Object(c.a)(C,m,[],!1,null,null,null));w.options.__file="src/vue/account-site-admin.vue";var I=w.exports,A={name:"account",components:{topbar:n.a,"user-setting":d,"dataset-list":f.a,"site-admin":I},data:function(){return{tab:"setting",user:{},openLeftPanel:$(window).width()>=1024}},created:function(){var t=s.a.GetUrlHash();t.tab&&(this.tab=t.tab),$.get("/user/info",function(t){"ok"==t.status&&(this.user=t.data)}.bind(this))},methods:{ChangeTab:function(t){this.tab=t,window.location.hash="#tab="+t},GoToUrl:function(t,e){window.open(t,e)},GoHome:function(){window.location.href="/"}}},S=(a(114),Object(c.a)(A,i,[],!1,null,null,null));S.options.__file="src/vue/account.vue";var D=S.exports;new Vue({el:"#accountApp",components:{account:D}})}]);