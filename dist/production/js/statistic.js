!function(t){var e={};function i(a){if(e[a])return e[a].exports;var r=e[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,a){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(a,r,function(e){return t[e]}.bind(null,r));return a},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/production",i(i.s=119)}({0:function(t,e,i){"use strict";function a(t,e,i,a,r,n,s,l){var o,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),a&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),s?(o=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=o):r&&(o=l?function(){r.call(this,this.$root.$options.shadowRoot)}:r),o)if(c.functional){c._injectStyles=o;var u=c.render;c.render=function(t,e){return o.call(e),u(t,e)}}else{var f=c.beforeCreate;c.beforeCreate=f?[].concat(f,o):[o]}return{exports:t,options:c}}i.d(e,"a",(function(){return a}))},1:function(t,e,i){"use strict";var a,r=function(){return void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a},n=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),s={};function l(t,e,i){for(var a=0;a<e.length;a++){var r={css:e[a][1],media:e[a][2],sourceMap:e[a][3]};s[t][a]?s[t][a](r):s[t].push(m(r,i))}}function o(t){var e=document.createElement("style"),a=t.attributes||{};if(void 0===a.nonce){var r=i.nc;r&&(a.nonce=r)}if(Object.keys(a).forEach((function(t){e.setAttribute(t,a[t])})),"function"==typeof t.insert)t.insert(e);else{var s=n(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function f(t,e,i,a){var r=i?"":a.css;if(t.styleSheet)t.styleSheet.cssText=u(e,r);else{var n=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(n,s[e]):t.appendChild(n)}}function d(t,e,i){var a=i.css,r=i.media,n=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),n&&btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleSheet)t.styleSheet.cssText=a;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(a))}}var h=null,p=0;function m(t,e){var i,a,r;if(e.singleton){var n=p++;i=h||(h=o(e)),a=f.bind(null,i,n,!1),r=f.bind(null,i,n,!0)}else i=o(e),a=d.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return a(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;a(t=e)}else r()}}t.exports=function(t,e,i){return(i=i||{}).singleton||"boolean"==typeof i.singleton||(i.singleton=r()),t=i.base?t+i.base:t,e=e||[],s[t]||(s[t]=[]),l(t,e,i),function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){s[t]||(s[t]=[]),l(t,e,i);for(var a=e.length;a<s[t].length;a++)s[t][a]();s[t].length=e.length,0===s[t].length&&delete s[t]}}}},119:function(t,e,i){t.exports=i(130)},120:function(t,e,i){"use strict";var a=i(81);i.n(a).a},121:function(t,e,i){(e=i(2)(!1)).push([t.i,".statistic-graph{width:100%;height:100%}.statistic-graph .graph-container{width:100%;height:350px;position:relative}.statistic-graph .graph-container .graph{width:100%;height:100%}.statistic-graph .graph-container .option-panel{width:100%;height:100%;position:absolute;top:0px;left:0px;padding:20px;background-color:rgba(255,255,255,0.9);overflow:auto}\n",""]),t.exports=e},122:function(t,e,i){"use strict";var a=i(82);i.n(a).a},123:function(t,e,i){(e=i(2)(!1)).push([t.i,".statistic-map{width:100%;height:100%;position:relative}.statistic-map .map{width:100%;height:100%}.statistic-map .popup-image{display:block;width:150px;object-fit:contain;border-radius:3px}.statistic-map .popup-info{margin:5px 0px}.statistic-map .popup-info .tag{font-size:1.1em;padding:5px 0px}.statistic-map .popup-info .remark{white-space:pre-line;word-wrap:break-word}.statistic-map .popup-bt{display:inline-block;margin:5px;padding:5px 10px;background-color:#555555;color:#ffffff;border-radius:3px;cursor:pointer}\n",""]),t.exports=e},124:function(t,e,i){"use strict";var a=i(83);i.n(a).a},125:function(t,e,i){(e=i(2)(!1)).push([t.i,".dataset-statistic{width:100%;height:100%}\n",""]),t.exports=e},130:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-layout",{staticClass:"dataset-statistic bg-grey-1 shadow-2",attrs:{view:"lHh lpr lFf",container:""}},[i("q-header",[i("topbar",{attrs:{user:t.user}})],1),t._v(" "),i("q-page-container",[i("q-page",{staticClass:"bg-grey-1"},[i("q-tab-panels",{staticClass:"absolute fit",attrs:{animated:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"graph"}},[i("statistic-graph",{ref:"statisticGraph"})],1),t._v(" "),i("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"map"}},[i("statistic-map",{ref:"statisticMap"})],1)],1)],1)],1),t._v(" "),i("q-footer",[i("q-tabs",{staticClass:"bg-grey-8 text-white",attrs:{"inline-label":"",align:"justify","active-bg-color":"grey-7"},on:{input:function(e){return t.InitTabContent()}},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("q-tab",{attrs:{name:"graph",icon:"bar_chart",label:"統計圖"}}),t._v(" "),t.info&&t.info.enableGPS?i("q-tab",{attrs:{name:"map",icon:"place",label:"地圖"}}):t._e(),t._v(" "),i("q-tab",{attrs:{name:"home",icon:"folder",label:"回資料集"},on:{click:function(e){return t.GoToDataset()}}})],1)],1)],1)};a._withStripped=!0;var r=i(3),n=(i(25),i(21)),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.dataset&&t.imageArr?i("div",{staticClass:"statistic-graph"},[i("div",{staticClass:"row items-center q-col-gutter-md q-pa-md"},[i("div",{staticClass:"col-12 col-sm-6 column"},[i("div",{staticClass:"text-h6"},[t._v("標註標籤比例")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"tagRatio",staticClass:"graph"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.tagFilter.open,expression:"tagFilter.open"}],staticClass:"option-panel"},[i("image-info-filter",{ref:"tagFilter",attrs:{initFilter:t.tagFilter.filter,disableTag:""},on:{update:function(e){return t.UpdateTagFilterResult()}}}),t._v(" "),i("div",{staticClass:"row justify-center"},[i("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{label:"確定"},on:{click:function(e){t.tagFilter.open=!1}}})],1)],1)]),t._v(" "),i("q-btn",{staticClass:"bg-grey-6 text-white q-my-sm",attrs:{dense:"",label:"篩選"},on:{click:function(e){return t.OpenTagFilter()}}})],1),t._v(" "),i("div",{staticClass:"col-12 col-sm-6 column"},[i("div",{staticClass:"text-h6"},[t._v("資料時間分佈")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"timeline",staticClass:"graph"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.timelineFilter.open,expression:"timelineFilter.open"}],staticClass:"option-panel"},[i("div",{staticClass:"text-subtitle2"},[t._v("\n\t\t\t\t\t\t顯示類型\n\t\t\t\t\t\t"),i("q-select",{attrs:{dense:"",options:t.typeOption,"option-value":"value","option-label":"label","emit-value":"","map-options":""},on:{input:function(e){return t.UpdateGraphTimeline()}},model:{value:t.timelineFilter.type,callback:function(e){t.$set(t.timelineFilter,"type",e)},expression:"timelineFilter.type"}})],1),t._v(" "),i("image-info-filter",{ref:"timelineFilter",attrs:{initFilter:t.timelineFilter.filter,disableTag:""},on:{update:function(e){return t.UpdateTimelineFilterResult()}}}),t._v(" "),i("div",{staticClass:"row justify-center"},[i("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{label:"確定"},on:{click:function(e){t.timelineFilter.open=!1}}})],1)],1)]),t._v(" "),i("q-btn",{staticClass:"bg-grey-6 text-white q-my-sm",attrs:{dense:"",label:"篩選"},on:{click:function(e){return t.OpenTimelineFilter()}}})],1),t._v(" "),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"text-h6"},[t._v("驗證認同率分佈")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"agreeRate",staticClass:"graph"})])]),t._v(" "),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"text-h6"},[t._v("上傳排行榜")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"uploadRank",staticClass:"graph"})])]),t._v(" "),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"text-h6"},[t._v("標註排行榜")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"annotateRank",staticClass:"graph"})])]),t._v(" "),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"text-h6"},[t._v("驗證排行榜")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"verifyRank",staticClass:"graph"})])])])]):t._e()};s._withStripped=!0;var l=i(45),o={name:"statistic-graph",props:{},components:{"image-info-filter":l.a},data:function(){return{dataset:null,imageArr:[],tagFilter:{arr:[],open:!1,filter:null},timelineFilter:{type:"time",arr:[],open:!1,filter:null},typeOption:[{label:"時間分佈",value:"time"},{label:"小時變化",value:"hour"},{label:"月份變化",value:"month"}]}},mounted:function(){},methods:{SetGraphData:function(t,e){this.dataset=t,this.imageArr=e,this.tagFilter.arr=e,this.timelineFilter.arr=e,Vue.nextTick(function(){this.UpdateGraph()}.bind(this))},OpenTagFilter:function(){this.tagFilter.open=!0,Vue.nextTick(function(){this.$refs.tagFilter.SetData(this.dataset,this.imageArr)}.bind(this))},OpenTimelineFilter:function(){this.timelineFilter.open=!0,Vue.nextTick(function(){this.$refs.timelineFilter.SetData(this.dataset,this.imageArr)}.bind(this))},UpdateTagFilterResult:function(){var t=this.$refs.tagFilter;this.tagFilter.filter=t.filter,this.tagFilter.arr=t.filterArr,this.UpdateGraphTag()},UpdateTimelineFilterResult:function(){var t=this.$refs.timelineFilter;this.timelineFilter.filter=Object.assign({type:this.timelineFilter.type},t.filter),this.timelineFilter.arr=t.filterArr,this.UpdateGraphTimeline()},UpdateGraph:function(){this.UpdateGraphTag(),this.UpdateGraphTimeline(),this.UpdateGraphUploadRank(),this.UpdateGraphAgreeRate(),this.UpdateGraphAnnotateRank(),this.UpdateGraphVerifyRank()},UpdateGraphTag:function(){var t=this.tagFilter.arr,e={};switch(this.dataset.annotationType){case"image":for(var i=0;i<t.length;i++){var a=[];if((s=t[i]).annotation)for(var r=0;r<s.annotation.annotation.length;r++){"true"==(n=s.annotation.annotation[r]).value&&a.push(n.name)}else a=["未標註"];for(r=0;r<a.length;r++){var n=a[r];e[n]?e[n].value++:e[n]={name:n,value:1}}}break;case"bbox":for(i=0;i<t.length;i++){var s,l=[];l=(s=t[i]).annotation?s.annotation.annotation:[{tag:"未標註"}];for(r=0;r<l.length;r++){n=l[r].tag;e[n]?e[n].value++:e[n]={name:n,value:1}}}}if(0==(a=Object.keys(e).sort((function(t,i){return e[t].value-e[i].value}))).length)return Plotly.purge(this.$refs.tagRatio);var o={values:a.map((function(t){return e[t].value})),labels:a,type:"pie"};Plotly.newPlot(this.$refs.tagRatio,[o],{paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:40,r:40,b:40,t:40}},{displayModeBar:!1})},UpdateGraphTimeline:function(){var t=this.timelineFilter,e=this.timelineFilter.arr,i=spacetime().name,a={},n="",s={fixedrange:!0};switch(t.type){case"time":n="yyyy-MM-dd",s.tickformat="%Y-%m-%d";break;case"hour":n="HH",s.title="小時變化",s.tickformat=".0f";break;case"month":n="MM",s.title="月份變化",s.tickformat=".0f"}switch(this.dataset.annotationType){case"image":for(var l=0;l<e.length;l++){var o=[];if((f=e[l]).annotation)for(var c=0;c<f.annotation.annotation.length;c++){"true"==(v=f.annotation.annotation[c]).value&&o.push(v.name)}else o=["未標註"];var u=(g=spacetime(f.dataTime).goto(i)).unixFmt(n);for(c=0;c<o.length;c++){a[v=o[c]]||(a[v]={}),a[v][u]?a[v][u].value++:a[v][u]={key:u,value:1}}}break;case"bbox":for(l=0;l<e.length;l++){var f,d=[];d=(f=e[l]).annotation?f.annotation.annotation:[{tag:"未標註"}];for(u=(g=spacetime(f.dataTime).goto(i)).unixFmt(n),c=0;c<d.length;c++){a[v=d[c].tag]||(a[v]={}),a[v][u]?a[v][u].value++:a[v][u]={key:u,value:1}}}}var h,p,m=spacetime.now();for(l=0;l<e.length;l++){var g=spacetime(e[l].dataTime,m.timezone().name);h&&!h.isAfter(g)||(h=g.clone().last("day")),p&&!p.isBefore(g)||(p=g.clone().next("day"))}for(var v in a)switch(t.type){case"time":for(var b=h;b.isBefore(p);){var _=b.unixFmt(n);a[v][_]||(a[v][_]={key:_,value:0}),b=b.add(1,"day")}break;case"hour":for(l=0;l<24;l++){_=r.a.PadLeft(l,2);a[v][_]||(a[v][_]={key:_,value:0})}break;case"month":for(l=1;l<=12;l++){_=r.a.PadLeft(l,2);a[v][_]||(a[v][_]={key:_,value:0})}}if(0==(o=Object.keys(a)).length)return Plotly.purge(this.$refs.timeline);var x=[];for(l=0;l<o.length;l++){var y=a[o[l]],k=Object.keys(y).sort((function(t,e){return t<e?-1:t>e?1:0})),w={x:k,y:k.map((function(t){return y[t].value})),name:o[l],type:"scatter"};x.push(w)}var C={hovermode:"closest",xaxis:s,yaxis:{fixedrange:!0,title:"標籤數"},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:60,r:40,b:60,t:40}};Plotly.newPlot(this.$refs.timeline,x,C,{displayModeBar:!1})},UpdateGraphAgreeRate:function(){for(var t=[],e=0;e<=1;e+=.1)t.push({x:e,y:0});for(e=0;e<this.imageArr.length;e++){var i=this.imageArr[e];if(i.verification.length>0){for(var a=0,r=0;r<i.verification.length;r++)"1"==i.verification[r].agree&&(a+=1);a/=i.verification.length,t[parseInt(10*a)].y++}}var n={type:"bar",x:t.map((function(t){return t.x})),y:t.map((function(t){return t.y}))};Plotly.newPlot(this.$refs.agreeRate,[n],{xaxis:{tickformat:"%",fixedrange:!0,title:"認同率"},yaxis:{fixedrange:!0,title:"影像數"},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:80,r:40,b:80,t:40}},{displayModeBar:!1})},UpdateGraphUploadRank:function(){for(var t={},e=0;e<this.imageArr.length;e++){var i=this.imageArr[e];i.uploader&&"user"==i.uploadFrom&&(t[i.uploader]?t[i.uploader].value++:t[i.uploader]={value:1})}var a=Object.keys(t).sort((function(e,i){return t[e].value-t[i].value})).slice(0,10);$.get("/user/list-name?id="+a.join(","),function(e){if("ok"==e.status){for(var i=0;i<e.data.length;i++){var r=e.data[i];t[r._id].name=r.name}var n={type:"bar",x:a.map((function(e){return t[e].value})),y:a.map((function(e){return t[e].name})),orientation:"h"};Plotly.newPlot(this.$refs.uploadRank,[n],{xaxis:{fixedrange:!0,title:"影像數"},yaxis:{fixedrange:!0,title:""},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:80,r:40,b:80,t:40}},{displayModeBar:!1})}}.bind(this))},UpdateGraphAnnotateRank:function(){for(var t={},e=0;e<this.imageArr.length;e++){var i=this.imageArr[e];if(i.annotation){var a=i.annotation.user;t[a]?t[a].value++:t[a]={value:1}}}var r=Object.keys(t).sort((function(e,i){return t[e].value-t[i].value})).slice(0,10);$.get("/user/list-name?id="+r.join(","),function(e){if("ok"==e.status){for(var i=0;i<e.data.length;i++){var a=e.data[i];t[a._id].name=a.name}var n={type:"bar",x:r.map((function(e){return t[e].value})),y:r.map((function(e){return t[e].name})),orientation:"h"};Plotly.newPlot(this.$refs.annotateRank,[n],{xaxis:{fixedrange:!0,title:"影像數"},yaxis:{fixedrange:!0,title:""},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:80,r:40,b:80,t:40}},{displayModeBar:!1})}}.bind(this))},UpdateGraphVerifyRank:function(){for(var t={},e=0;e<this.imageArr.length;e++){var i=this.imageArr[e];if(i.verification.length>0)for(var a=0;a<i.verification.length;a++){var r=i.verification[a].user;t[r]?t[r].value++:t[r]={value:1}}}var n=Object.keys(t).sort((function(e,i){return t[e].value-t[i].value})).slice(0,10);$.get("/user/list-name?id="+n.join(","),function(e){if("ok"==e.status){for(var i=0;i<e.data.length;i++){var a=e.data[i];t[a._id].name=a.name}var r={type:"bar",x:n.map((function(e){return t[e].value})),y:n.map((function(e){return t[e].name})),orientation:"h"};Plotly.newPlot(this.$refs.verifyRank,[r],{xaxis:{fixedrange:!0,title:"影像數"},yaxis:{fixedrange:!0,title:""},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:80,r:40,b:80,t:40}},{displayModeBar:!1})}}.bind(this))}}},c=(i(120),i(0)),u=Object(c.a)(o,s,[],!1,null,null,null);u.options.__file="src/vue/statistic-graph.vue";var f=u.exports,d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"statistic-map"},[i("div",{ref:"map",staticClass:"map"}),t._v(" "),i("q-page-sticky",{staticClass:"z-top",attrs:{position:"bottom-left",offset:[18,18]}},[i("q-btn",{staticClass:"bg-primary text-white",attrs:{flat:"",round:"",size:"md",icon:"insert_chart",disable:null==t.dataset||0==t.imageArr.length},on:{click:function(e){return t.OpenFilterPanel()}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("資料篩選")])],1)],1),t._v(" "),i("q-dialog",{model:{value:t.openFilterPanel,callback:function(e){t.openFilterPanel=e},expression:"openFilterPanel"}},[i("q-card",{staticClass:"full-width q-px-md"},[i("q-card-section",{staticClass:"column"},[i("image-info-filter",{ref:"imageInfoFilter",attrs:{initFilter:t.curFilter},on:{update:function(e){return t.UpdateFilterResult()}}})],1),t._v(" "),i("q-card-actions",{attrs:{align:"center"}},[i("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){t.openFilterPanel=!1}}})],1)],1)],1)],1)};d._withStripped=!0;var h={name:"statistic-map",props:{},components:{"image-info-filter":l.a},data:function(){return{map:null,openFilterPanel:!1,markerGroup:null,dataset:null,imageArr:[],filterArr:[],curFilter:null,rangeMarker:null}},created:function(){Vue.nextTick(function(){this.InitMap()}.bind(this))},methods:{InitMap:function(){this.map=L.map(this.$refs.map).setView([23.682094,120.7764642],7),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="https://www.openstreetmap.org/">OSM</a>',maxZoom:18}).addTo(this.map),this.markerGroup=L.markerClusterGroup(),this.map.addLayer(this.markerGroup)},SetGraphData:function(t,e){this.dataset=t,this.imageArr=e,this.filterArr=e,Vue.nextTick(function(){this.UpdateMap()}.bind(this))},OpenFilterPanel:function(){this.openFilterPanel=!0,Vue.nextTick(function(){this.$refs.imageInfoFilter.SetData(this.dataset,this.imageArr)}.bind(this))},UpdateFilterResult:function(){var t=this.$refs.imageInfoFilter;this.curFilter=t.filter,this.filterArr=t.filterArr,this.UpdateMap()},UpdateMap:function(){this.ClearMarker();for(var t=this.filterArr,e=0;e<t.length;e++){var i=t[e];if(i.lat&&i.lng){var a="<div class='tag'>";if(i.annotation)switch(this.dataset.annotationType){case"image":for(var r=i.annotation.annotation,n=0;n<r.length;n++){"true"==(o=r[n]).value&&(a+="#"+o.name+" ")}break;case"bbox":var s=i.annotation.annotation,l={};for(n=0;n<s.length;n++){var o=s[n].tag;l[o]?l[o]++:l[o]=1}a+=Object.keys(l).map((function(t){return t+":"+l[t]})).join("<br>")}else a+="未標註";a+="</div>",i.remark&&(a+="<div class='remark'>"+i.remark+"</div>");var c="";c+="<a href='/image?dataset="+this.dataset._id+"&image="+i._id+"' target='_blank'>",c+="<img src='"+i.url+"' class='popup-image' />",c+="</a>",c+="<div class='popup-info'>"+a+"</div>",c+="<div class='popup-bt' onclick=\"window.open('"+(d="/image?dataset="+this.dataset._id+"&image="+i._id)+"','_blank');\">前往影像</div>";var u=spacetime().name,f=spacetime(i.dataTime).goto(u);switch(f=f.subtract(f.minute()%10,"minute"),this.dataset.externalLink){case"riverlog":var d="https://riverlog.lass-net.org/";d+="#year="+f.year(),d+="&date="+f.unixFmt("MM-dd"),d+="&time="+f.unixFmt("HH:mm"),d+="&lat="+i.lat,d+="&lng="+i.lng,c+="<div class='popup-bt' onclick=\"window.open('"+(d+="&zoom=12")+"','_blank');\">前往山河事件簿</div>";break;case"purbao":d="https://purbao.lass-net.org/";d+="?year="+f.year(),d+="&date="+f.unixFmt("M/d"),d+="&lat="+i.lat,d+="&lng="+i.lng,c+="<div class='popup-bt'  onclick=\"window.open('"+(d+="&zoom=12")+"','_blank');\">前往紫豹在哪裡</div>"}var h=L.marker({lat:i.lat,lng:i.lng}).bindPopup(c);this.markerGroup.addLayer(h)}}if(this.curFilter){var p=this.curFilter.loc;p.enable&&p.lat&&p.lng&&p.range&&(this.rangeMarker=L.circle(p,{weight:1,fillOpacity:0,color:"#ff0000",dashArray:"10, 10",radius:1e3*p.range}),this.rangeMarker.addTo(this.map))}},ClearMarker:function(){this.markerGroup.clearLayers(),this.rangeMarker&&(this.map.removeLayer(this.rangeMarker),this.rangeMarker=null)}}},p=(i(122),Object(c.a)(h,d,[],!1,null,null,null));p.options.__file="src/vue/statistic-map.vue";var m=p.exports,g={name:"dataset-statistic",components:{topbar:n.a,"statistic-graph":f,"statistic-map":m},data:function(){return{tab:"graph",user:null,datasetID:null,info:null,imageArr:[]}},created:function(){var t=r.a.GetUrlParameter();this.datasetID=t.id;var e=r.a.GetUrlHash();e.tab&&(this.tab=e.tab),$.get("/user/info",function(t){"ok"==t.status&&(this.user=t.data)}.bind(this)),$.get("/dataset/view-dataset?id="+t.id,function(i){if("ok"!=i.status)return window.location.href="/?message="+encodeURIComponent("無法取得資料集資訊");this.info=i.data,this.info.enableGPS&&!e.tab&&(this.tab="map"),$.get("/dataset/list-image?all=1&dataset="+t.id,function(e){if("ok"!=e.status)return window.location.href="/?message="+encodeURIComponent("無法取得影像資訊");this.imageArr=e.data;for(var i=0;i<this.imageArr.length;i++){var a=this.imageArr[i];a.url="/static/upload/dataset/"+t.id+"/image/"+a._id+".jpg"}this.InitTabContent()}.bind(this))}.bind(this))},methods:{GoToDataset:function(){window.location.href="/dataset?id="+this.datasetID},InitTabContent:function(){Vue.nextTick(function(){switch(window.location.hash="#tab="+this.tab,this.tab){case"graph":this.$refs.statisticGraph.SetGraphData(this.info,this.imageArr);break;case"map":this.$refs.statisticMap.SetGraphData(this.info,this.imageArr)}}.bind(this))}}},v=(i(124),Object(c.a)(g,a,[],!1,null,null,null));v.options.__file="src/vue/dataset-statistic.vue";var b=v.exports;new Vue({el:"#statisticApp",components:{"dataset-statistic":b}})},2:function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",a=t[3];if(!a)return i;if(e&&"function"==typeof btoa){var r=(s=a,l=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),o="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(l),"/*# ".concat(o," */")),n=a.sources.map((function(t){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(t," */")}));return[i].concat(n).concat([r]).join("\n")}var s,l,o;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(i,"}"):i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var a=0;a<t.length;a++){var r=[].concat(t[a]);i&&(r[2]?r[2]="".concat(i," and ").concat(r[2]):r[2]=i),e.push(r)}},e}},21:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"topbar bg-grey-8 text-white"},[i("q-toolbar",{staticClass:"q-px-md",attrs:{square:""}},[t.useMenu?i("q-btn",{attrs:{flat:"",round:"",icon:"menu"},on:{click:function(e){return t.ToggleMenu()}}}):t._e(),t._v(" "),i("a",{attrs:{href:"/"}},[i("q-btn",{attrs:{flat:"","no-caps":""}},[i("q-avatar",{attrs:{size:"md",square:""}},[i("img",{attrs:{src:t.logo}})]),t._v(" "),i("div",{staticClass:"gt-xs q-px-md text-white text-h5 inline"},[t._v(t._s(t.title))])],1)],1),t._v(" "),i("q-space"),t._v(" "),t.user?i("q-item",{attrs:{clickable:"",tag:"a",href:"/account"}},[i("q-avatar",{attrs:{size:"lg"}},[i("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.user.icon}})]),t._v(" "),i("q-item-section",{staticClass:"q-px-sm"},[i("q-item-label",{staticClass:"text-h6"},[t._v(t._s(t.user.name))])],1)],1):i("q-item",{attrs:{clickable:"",tag:"a",href:"/login"}},[i("q-icon",{attrs:{size:"md",name:"account_box"}}),t._v(" "),i("q-item-section",[i("q-item-label",{staticClass:"text-h6"},[t._v("登入")])],1)],1)],1)],1)};a._withStripped=!0;var r={name:"topbar",props:{user:Object,useMenu:Boolean},data:function(){return{title:"",logo:"/static/image/logo.png"}},created:function(){$.get("/site-info",function(t){"ok"==t.status&&(this.title=t.data.title,this.logo=t.data.logo)}.bind(this))},methods:{ToggleMenu:function(){this.$emit("toggleMenu")}}},n=(i(30),i(0)),s=Object(n.a)(r,a,[],!1,null,null,null);s.options.__file="src/vue/topbar.vue";e.a=s.exports},25:function(t,e,i){var a=i(1),r=i(26);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},s=(a(t.i,r,n),r.locals?r.locals:{});t.exports=s},26:function(t,e,i){(e=i(2)(!1)).push([t.i,'html,body{height:100%;margin:0;padding:0;background-color:#edffef}*{box-sizing:border-box;font-family:"微軟正黑體", "Microsoft JhengHei"}\n',""]),t.exports=e},3:function(t,e,i){"use strict";var a={GetUrlParameter:function(){for(var t=window.location.search.substring(1).split("&"),e={},i=0;i<t.length;i++){var a=t[i].split("=");e[a[0]]=a[1]}return e},GetUrlHash:function(){for(var t=window.location.hash.substr(1).split("&"),e={},i=0;i<t.length;i++){var a=t[i].split("=");e[a[0]]=a[1]}return e},ValidateEmail:function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},PadLeft:function(t,e,i){var a=e-String(t).length+1;return a>0?new Array(a).join(i||"0")+t:t}};e.a=a},30:function(t,e,i){"use strict";var a=i(4);i.n(a).a},31:function(t,e,i){(e=i(2)(!1)).push([t.i,".topbar{width:100%}.topbar a{text-decoration:none}\n",""]),t.exports=e},38:function(t,e,i){var a=i(1),r=i(98);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},s=(a(t.i,r,n),r.locals?r.locals:{});t.exports=s},4:function(t,e,i){var a=i(1),r=i(31);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},s=(a(t.i,r,n),r.locals?r.locals:{});t.exports=s},43:function(t,e,i){"use strict";var a=i(6);i.n(a).a},44:function(t,e,i){(e=i(2)(!1)).push([t.i,".location-select{width:100%}.location-select .map{width:100%;height:300px}\n",""]),t.exports=e},45:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"image-info-filter q-pa-sm"},[t.disableTag?t._e():i("div",[i("div",{staticClass:"text-h6"},[t._v("標籤篩選")]),t._v(" "),i("div",{staticClass:"row items-center"},[i("q-checkbox",{staticClass:"text-bold",attrs:{label:"全選"},on:{input:function(e){return t.ToggleTagSelectAll()}},model:{value:t.filter.selectAll,callback:function(e){t.$set(t.filter,"selectAll",e)},expression:"filter.selectAll"}}),t._v(" "),t._l(t.filter.tag,(function(e){return i("q-checkbox",{key:e.name,attrs:{label:e.name},on:{input:function(e){return t.UpdateFilterResult()}},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"tag.value"}})}))],2),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1),t._v(" "),t.disableTime?t._e():i("div",[i("div",{staticClass:"text-h6 q-mb-lg"},[t._v("時間篩選")]),t._v(" "),i("div",{staticClass:"q-px-md"},[i("q-range",{attrs:{min:t.filter.timeLimit.rangeMin,max:t.filter.timeLimit.rangeMax,step:1,"left-label-value":t.minTimeLabel,"right-label-value":t.maxTimeLabel,"left-label-color":"grey-8","right-label-color":"grey-8","label-always":""},on:{change:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.time,callback:function(e){t.$set(t.filter,"time",e)},expression:"filter.time"}})],1),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1),t._v(" "),t.disableLocation?t._e():i("div",[i("div",{staticClass:"row items-center"},[i("div",{staticClass:"text-h6"},[t._v("地點篩選")]),t._v(" "),i("q-btn",{staticClass:"bg-grey-8 text-white q-ma-sm",attrs:{label:"選擇範圍"},on:{click:function(e){return t.OpenRangeSelect()}}})],1),t._v(" "),i("div",{staticClass:"row text-subtitle2 q-gutter-xs"},[i("div",[t._v(t._s(t.filter.loc.enable?"已啟用":"未啟用"))]),t._v(" "),t.filter.loc.enable&&t.filter.loc.lat&&t.filter.loc.lng?i("div",[t._v("中心點: ("+t._s(t.filter.loc.lat.toFixed(5)+" "+t.filter.loc.lng.toFixed(5))+")")]):t._e(),t._v(" "),t.filter.loc.enable&&t.filter.loc.range?i("div",[t._v("範圍:"+t._s(t.filter.loc.range+"公里"))]):t._e()]),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1),t._v(" "),!t.disableForm&&t.dataset&&t.dataset.form?i("div",[i("div",{staticClass:"text-h6"},[t._v("表單篩選")]),t._v(" "),t.dataset.form?i("div",t._l(t.dataset.form.itemArr,(function(e,a){return i("div",[i("div",{staticClass:"text-subtitle2"},[i("q-checkbox",{key:e.quest,attrs:{label:a+1+"."+e.quest},on:{input:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].use,callback:function(i){t.$set(t.filter.form[e.id],"use",i)},expression:"filter.form[item.id].use"}})],1),t._v(" "),t.filter.form[e.id].use?i("div",{staticClass:"q-mx-md"},["text"==e.type?i("div",[i("q-input",{ref:e.id,refInFor:!0,attrs:{dense:"",placeholder:"請輸入篩選文字"},on:{blur:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].value,callback:function(i){t.$set(t.filter.form[e.id],"value",i)},expression:"filter.form[item.id].value"}})],1):t._e(),t._v(" "),"radio"==e.type?i("div",t._l(e.option,(function(a,r){return i("q-radio",{key:a,attrs:{label:a,val:a},on:{input:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].value,callback:function(i){t.$set(t.filter.form[e.id],"value",i)},expression:"filter.form[item.id].value"}})})),1):t._e(),t._v(" "),"checkbox"==e.type?i("div",t._l(e.option,(function(a,r){return i("q-checkbox",{key:a,attrs:{label:a,val:a},on:{input:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].value,callback:function(i){t.$set(t.filter.form[e.id],"value",i)},expression:"filter.form[item.id].value"}})})),1):t._e(),t._v(" "),"number"==e.type?i("div",[i("div",{staticClass:"q-mt-lg q-mx-md"},[i("q-range",{attrs:{min:t.filter.form[e.id].minValue,max:t.filter.form[e.id].maxValue,step:1,"label-always":""},on:{change:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].value,callback:function(i){t.$set(t.filter.form[e.id],"value",i)},expression:"filter.form[item.id].value"}})],1)]):t._e()]):t._e()])})),0):t._e(),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1):t._e(),t._v(" "),t.disableRemark?t._e():i("div",[i("div",{staticClass:"text-h6"},[t._v("備註篩選")]),t._v(" "),i("q-input",{staticClass:"q-ma-sm",attrs:{dense:""},on:{blur:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.remark,callback:function(e){t.$set(t.filter,"remark",e)},expression:"filter.remark"}}),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1),t._v(" "),t.imageArr&&t.filterArr?i("div",{staticClass:"row justify-center q-gutter-sm text-red"},[i("div",[t._v("原始資料 "+t._s(t.imageArr.length)+" 筆")]),t._v(" "),i("div",[t._v("篩選後 "+t._s(t.filterArr.length)+" 筆")])]):t._e(),t._v(" "),i("q-dialog",{model:{value:t.openRangeSelect,callback:function(e){t.openRangeSelect=e},expression:"openRangeSelect"}},[i("q-card",{staticClass:"full-width q-pa-sm"},[i("div",{staticClass:"text-h6"},[t._v("選擇範圍")]),t._v(" "),i("q-toggle",{attrs:{"left-label":"",label:"啟用範圍篩選"},on:{input:function(e){return t.UpdateRangeSelectMap()}},model:{value:t.filter.loc.enable,callback:function(e){t.$set(t.filter.loc,"enable",e)},expression:"filter.loc.enable"}}),t._v(" "),i("div",{staticClass:"text-subtitle2"},[t._v("\n\t\t\t\t半徑(公里)\n\t\t\t\t"),i("q-slider",{attrs:{label:"",min:10,max:400},on:{change:function(e){return t.UpdateRangeSelectMap()}},model:{value:t.filter.loc.range,callback:function(e){t.$set(t.filter.loc,"range",e)},expression:"filter.loc.range"}})],1),t._v(" "),i("location-select",{ref:"locationSelect",attrs:{mode:"selectRange"},on:{change:function(e){return t.UpdateLoc()}}}),t._v(" "),t.$refs.locationSelect?i("div",{staticClass:"text-center"},[t._v(t._s(t.$refs.locationSelect.status))]):t._e(),t._v(" "),i("q-card-actions",{attrs:{align:"center"}},[i("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){t.openRangeSelect=!1,t.UpdateFilterResult()}}})],1)],1)],1)],1)};a._withStripped=!0;var r=i(7),n={name:"image-info-filter",props:{disableTag:Boolean,disableTime:Boolean,disableLocation:Boolean,disableRemark:Boolean,disableForm:Boolean,initFilter:Object},components:{"location-select":r.a},data:function(){return{dataset:null,imageArr:null,filter:{selectAll:!0,tag:[],time:{min:null,max:null},loc:{enable:!1,lat:null,lng:null,range:50},remark:"",timeLimit:{min:null,max:null,rangeMin:0,rangeMax:0},form:{}},openRangeSelect:!1,rangeTarget:null,filterArr:[]}},mounted:function(){this.initFilter&&(this.filter=Object.assign({},this.initFilter)),Vue.nextTick(function(){this.UpdateRangeSelectMap()}.bind(this))},methods:{SetData:function(t,e){this.dataset=t,this.imageArr=e,this.initFilter||(this.InitTimeSelect(),this.InitTagSelect(),this.InitFormSelect()),Vue.nextTick(function(){this.UpdateFilterResult()}.bind(this))},InitTimeSelect:function(){if(!this.disableTime){for(var t=spacetime.now(),e=0;e<this.imageArr.length;e++){var i=spacetime(this.imageArr[e].dataTime).goto(t.timezone().name);this.filter.timeLimit.min&&!this.filter.timeLimit.min.isAfter(i)||(this.filter.timeLimit.min=i.clone().last("day")),this.filter.timeLimit.max&&!this.filter.timeLimit.max.isBefore(i)||(this.filter.timeLimit.max=i.clone().next("day"))}this.filter.timeLimit.min&&this.filter.timeLimit.max&&(this.filter.timeLimit.rangeMin=0,this.filter.timeLimit.rangeMax=this.filter.timeLimit.min.diff(this.filter.timeLimit.max,"day")+1,this.filter.time.min=this.filter.timeLimit.rangeMin,this.filter.time.max=this.filter.timeLimit.rangeMax)}},InitTagSelect:function(){if(!this.disableTag&&this.dataset){this.filter.tag=[],this.filter.tag.push({name:"未標註",value:!0});for(var t=0;t<this.dataset.tagArr.length;t++){var e=this.dataset.tagArr[t];this.filter.tag.push({name:e,value:!0})}}},InitFormSelect:function(){if(this.dataset.form){for(var t={},e=0;e<this.dataset.form.itemArr.length;e++){var i=this.dataset.form.itemArr[e],a={id:i.id,use:!1};if("checkbox"==i.type&&(a.value=[]),"number"==i.type){for(var r=Number.MAX_VALUE,n=Number.MIN_VALUE,s=0;s<this.imageArr.length;s++)if(this.imageArr[s].formReply){var l=this.imageArr[s].formReply[i.id];if(l){var o=parseFloat(l.value);o>n&&(n=o),o<r&&(r=o)}}a.minValue=r,a.maxValue=n}t[i.id]=a}this.filter.form=t}},ToggleTagSelectAll:function(){if(!this.disableTag){for(var t=0;t<this.filter.tag.length;t++){this.filter.tag[t].value=this.filter.selectAll}this.UpdateFilterResult()}},OpenRangeSelect:function(){this.openRangeSelect=!0,Vue.nextTick(function(){this.$refs.locationSelect.range=this.filter.loc.range,this.UpdateRangeSelectMap()}.bind(this))},UpdateRangeSelectMap:function(){if(!this.disableLocation){var t=this.$refs.locationSelect;t&&(t.range=this.filter.loc.range,this.filter.loc.enable?(this.filter.loc.lat&&this.filter.loc.lng||t.GetGPS(),t.SetRange(this.filter.loc.lat,this.filter.loc.lng,this.filter.loc.range)):t.RemoveMarker(),this.UpdateFilterResult())}},UpdateLoc(){if(!this.disableLocation){this.filter.loc.enable=!0;var t=this.$refs.locationSelect.loc;this.filter.loc.lat=t.lat,this.filter.loc.lng=t.lng,this.UpdateFilterResult()}},UpdateFilterResult:function(){if(this.imageArr){var t=this.imageArr;if(!this.disableTag){for(var e={},i=0;i<this.filter.tag.length;i++){var a=this.filter.tag[i];e[a.name]=a.value}t=t.filter(function(t){if(!t.annotation)return e["未標註"];switch(this.dataset.annotationType){case"image":for(var i=t.annotation.annotation,a=0;a<i.length;a++){var r=i[a];if(e[r.name]&&"true"==r.value)return!0}break;case"bbox":var n=t.annotation.annotation;for(a=0;a<n.length;a++){r=n[a].tag;if(e[r])return!0}}return!1}.bind(this))}if(!this.disableTime){var r=spacetime.now();t=t.filter(function(t){var e=spacetime(t.dataTime).goto(r.timezone().name),i=this.filter.timeLimit.min.add(this.filter.time.min,"day"),a=this.filter.timeLimit.min.add(this.filter.time.max,"day");return e.isAfter(i)&&e.isBefore(a)}.bind(this))}this.disableLocation||this.filter.loc.enable&&(t=t.filter(function(t){var e=this.filter.loc,i=e.range/111,a=t.lat-e.lat,r=t.lng-e.lng;return a*a+r*r<=i*i}.bind(this))),this.disableForm||(t=t.filter(function(t){if(!this.dataset.form)return!0;for(var e=0;e<this.dataset.form.itemArr.length;e++){var i=this.dataset.form.itemArr[e],a=this.filter.form[i.id];if(a.use){if(!t.formReply||!t.formReply[i.id])return!1;var r=t.formReply[i.id].value;switch(i.type){case"text":if(!a.value)continue;if(-1==a.value.indexOf(r))return!1;break;case"radio":if(a.value!=r)return!1;break;case"checkbox":for(var n=!1,s=0;s<a.value.length;s++)if(r.includes(a.value[s])){n=!0;break}if(!n)return!1;break;case"number":if(!a.value)continue;if(a.value.min>r)return!1;if(a.value.max<r)return!1}}}return!0}.bind(this))),this.disableRemark||(t=t.filter(function(t){return""==this.filter.remark||!!t.remark&&-1!=t.remark.indexOf(this.filter.remark)}.bind(this))),this.filterArr=t,this.$emit("update")}}},computed:{minTimeLabel:function(){return this.disableTime?"":this.filter.timeLimit.min?this.filter.timeLimit.min.add(this.filter.time.min,"day").unixFmt("yyyy-MM-dd"):""},maxTimeLabel:function(){return this.disableTime?"":this.filter.timeLimit.min?this.filter.timeLimit.min.add(this.filter.time.max,"day").unixFmt("yyyy-MM-dd"):""}}},s=(i(97),i(0)),l=Object(s.a)(n,a,[],!1,null,null,null);l.options.__file="src/vue/image-info-filter.vue";e.a=l.exports},6:function(t,e,i){var a=i(1),r=i(44);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},s=(a(t.i,r,n),r.locals?r.locals:{});t.exports=s},7:function(t,e,i){"use strict";var a=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"location-select"},[e("div",{ref:"map",staticClass:"map"})])};a._withStripped=!0;var r={name:"location-select",props:{mode:String},components:{},data:function(){return{loc:null,status:"",OnGPSReady:null,map:null,locMarker:null,rangeMarker:null,range:10}},mounted:function(){this.InitMap()},methods:{InitMap:function(){switch(this.map=L.map(this.$refs.map).setView([23.682094,120.7764642],7),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="https://www.openstreetmap.org/">OSM</a>',maxZoom:18}).addTo(this.map),this.mode){case"selectLoc":this.map.on("click",function(t){var e=t.latlng;this.SetPosition(e.lat,e.lng)}.bind(this));break;case"selectRange":this.map.on("click",function(t){var e=t.latlng;this.SetRange(e.lat,e.lng,this.range)}.bind(this))}},SetPosition:function(t,e,i){t&&e&&(this.loc={lat:t,lng:e},this.status="座標: "+t.toFixed(5)+" "+e.toFixed(5),this.locMarker?this.locMarker.setLatLng(this.loc,{draggable:"selectLoc"==this.mode}).bindPopup(this.status).update():(this.locMarker=L.marker(this.loc,{draggable:"selectLoc"==this.mode}),this.locMarker.on("dragend",function(t){var e=this.locMarker.getLatLng();this.SetPosition(e.lat,e.lng)}.bind(this)),this.locMarker.addTo(this.map)),i&&this.map.setView([t,e],12),this.$emit("change"))},SetRange:function(t,e,i){t&&e&&(this.range=i,this.loc={lat:t,lng:e},this.status="座標: "+t.toFixed(5)+" "+e.toFixed(5),this.rangeMarker?(this.rangeMarker.setLatLng(this.loc),this.rangeMarker.setRadius(1e3*this.range)):(this.rangeMarker=L.circle(this.loc,{weight:1,color:"#ff0000",fillColor:"#ff3333",fillOpacity:.3,radius:1e3*this.range}),this.rangeMarker.addTo(this.map)),this.locMarker?this.locMarker.setLatLng(this.loc,{draggable:"selectRange"==this.mode}).bindPopup(this.status).update():(this.locMarker=L.marker(this.loc,{draggable:"selectRange"==this.mode}),this.locMarker.on("drag",function(t){var e=t.target.getLatLng();this.rangeMarker.setLatLng(e)}.bind(this)),this.locMarker.on("dragend",function(t){var e=this.locMarker.getLatLng();this.rangeMarker.setLatLng(e),this.loc={lat:e.lat,lng:e.lng},this.$emit("change")}.bind(this)),this.locMarker.addTo(this.map)),this.$emit("change"))},GetGPS:function(){this.status="無GPS-請點選位置",navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){switch(this.map.setView([t.coords.latitude,t.coords.longitude],12),this.mode){case"selectLoc":this.SetPosition(t.coords.latitude,t.coords.longitude);break;case"selectRange":this.SetRange(t.coords.latitude,t.coords.longitude,this.range)}this.OnGPSReady&&this.OnGPSReady()}.bind(this),function(t){this.status="讀取GPS失敗-請點選位置"}.bind(this)):this.status="瀏覽器不支援GPS-請點選位置"},RemoveMarker:function(){this.locMarker&&(this.map.removeLayer(this.locMarker),this.locMarker=null),this.rangeMarker&&(this.map.removeLayer(this.rangeMarker),this.rangeMarker=null)}}},n=(i(43),i(0)),s=Object(n.a)(r,a,[],!1,null,null,null);s.options.__file="src/vue/location-select.vue";e.a=s.exports},81:function(t,e,i){var a=i(1),r=i(121);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},s=(a(t.i,r,n),r.locals?r.locals:{});t.exports=s},82:function(t,e,i){var a=i(1),r=i(123);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},s=(a(t.i,r,n),r.locals?r.locals:{});t.exports=s},83:function(t,e,i){var a=i(1),r=i(125);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.i,r,""]]);var n={insert:"head",singleton:!1},s=(a(t.i,r,n),r.locals?r.locals:{});t.exports=s},97:function(t,e,i){"use strict";var a=i(38);i.n(a).a},98:function(t,e,i){(e=i(2)(!1)).push([t.i,".image-info-filter{width:100%}\n",""]),t.exports=e}});