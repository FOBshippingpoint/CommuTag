(()=>{var t={6528:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var a=i(8081),r=i.n(a),n=i(3645),s=i.n(n)()(r());s.push([t.id,'html,body{height:100%;margin:0;padding:0;background-color:#edffef}*{box-sizing:border-box;font-family:"微軟正黑體", "Microsoft JhengHei"}\n',""]);const l=s},4867:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var a=i(8081),r=i.n(a),n=i(3645),s=i.n(n)()(r());s.push([t.id,".dataset-statistic{width:100%;height:100%}\n",""]);const l=s},8898:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var a=i(8081),r=i.n(a),n=i(3645),s=i.n(n)()(r());s.push([t.id,".image-info-filter{width:100%}\n",""]);const l=s},7108:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var a=i(8081),r=i.n(a),n=i(3645),s=i.n(n)()(r());s.push([t.id,".location-select{width:100%}.location-select .map{width:100%;height:300px}\n",""]);const l=s},6313:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var a=i(8081),r=i.n(a),n=i(3645),s=i.n(n)()(r());s.push([t.id,".statistic-graph{width:100%;height:100%}.statistic-graph .graph-container{width:100%;height:350px;position:relative}.statistic-graph .graph-container .graph{width:100%;height:100%}.statistic-graph .graph-container .option-panel{width:100%;height:100%;position:absolute;top:0px;left:0px;padding:20px;background-color:rgba(255,255,255,0.9);overflow:auto}\n",""]);const l=s},7195:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var a=i(8081),r=i.n(a),n=i(3645),s=i.n(n)()(r());s.push([t.id,".statistic-map{width:100%;height:100%;position:relative}.statistic-map .map{width:100%;height:100%}.statistic-map .popup-image{display:block;width:150px;object-fit:contain;border-radius:3px}.statistic-map .popup-info{margin:5px 0px}.statistic-map .popup-info .tag{font-size:1.1em;padding:5px 0px}.statistic-map .popup-info .remark{white-space:pre-line;word-wrap:break-word}.statistic-map .popup-bt{display:inline-block;margin:5px;padding:5px 10px;background-color:#555555;color:#ffffff;border-radius:3px;cursor:pointer}\n",""]);const l=s},9007:(t,e,i)=>{"use strict";i.r(e),i.d(e,{default:()=>l});var a=i(8081),r=i.n(a),n=i(3645),s=i.n(n)()(r());s.push([t.id,".topbar{width:100%}.topbar a{text-decoration:none}\n",""]);const l=s},3645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",a=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),a&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),a&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,a,r,n){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(a)for(var l=0;l<this.length;l++){var o=this[l][0];null!=o&&(s[o]=!0)}for(var c=0;c<t.length;c++){var u=[].concat(t[c]);a&&s[u[0]]||(void 0!==n&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=n),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),r&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=r):u[4]="".concat(r)),e.push(u))}},e}},8081:t=>{"use strict";t.exports=function(t){return t[1]}},7896:(t,e,i)=>{var a=i(3379),r=i(6528);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.id,r,""]]);a(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},7345:(t,e,i)=>{var a=i(3379),r=i(4867);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.id,r,""]]);a(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},5402:(t,e,i)=>{var a=i(3379),r=i(8898);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.id,r,""]]);a(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},5904:(t,e,i)=>{var a=i(3379),r=i(7108);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.id,r,""]]);a(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},1218:(t,e,i)=>{var a=i(3379),r=i(6313);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.id,r,""]]);a(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},7460:(t,e,i)=>{var a=i(3379),r=i(7195);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.id,r,""]]);a(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},4890:(t,e,i)=>{var a=i(3379),r=i(9007);"string"==typeof(r=r.__esModule?r.default:r)&&(r=[[t.id,r,""]]);a(r,{insert:"head",singleton:!1}),t.exports=r.locals||{}},3379:(t,e,i)=>{"use strict";var a,r=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}(),n=[];function s(t){for(var e=-1,i=0;i<n.length;i++)if(n[i].identifier===t){e=i;break}return e}function l(t,e){for(var i={},a=[],r=0;r<t.length;r++){var l=t[r],o=e.base?l[0]+e.base:l[0],c=i[o]||0,u="".concat(o," ").concat(c);i[o]=c+1;var d=s(u),f={css:l[1],media:l[2],sourceMap:l[3]};-1!==d?(n[d].references++,n[d].updater(f)):n.push({identifier:u,updater:p(f,e),references:1}),a.push(u)}return a}function o(t){var e=document.createElement("style"),a=t.attributes||{};if(void 0===a.nonce){var n=i.nc;n&&(a.nonce=n)}if(Object.keys(a).forEach((function(t){e.setAttribute(t,a[t])})),"function"==typeof t.insert)t.insert(e);else{var s=r(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var c,u=(c=[],function(t,e){return c[t]=e,c.filter(Boolean).join("\n")});function d(t,e,i,a){var r=i?"":a.media?"@media ".concat(a.media," {").concat(a.css,"}"):a.css;if(t.styleSheet)t.styleSheet.cssText=u(e,r);else{var n=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(n,s[e]):t.appendChild(n)}}function f(t,e,i){var a=i.css,r=i.media,n=i.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),n&&"undefined"!=typeof btoa&&(a+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),t.styleSheet)t.styleSheet.cssText=a;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(a))}}var h=null,m=0;function p(t,e){var i,a,r;if(e.singleton){var n=m++;i=h||(h=o(e)),a=d.bind(null,i,n,!1),r=d.bind(null,i,n,!0)}else i=o(e),a=f.bind(null,i,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return a(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;a(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===a&&(a=Boolean(window&&document&&document.all&&!window.atob)),a));var i=l(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var a=0;a<i.length;a++){var r=s(i[a]);n[r].references--}for(var o=l(t,e),c=0;c<i.length;c++){var u=s(i[c]);0===n[u].references&&(n[u].updater(),n.splice(u,1))}i=o}}}}},e={};function i(a){var r=e[a];if(void 0!==r)return r.exports;var n=e[a]={id:a,exports:{}};return t[a](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nc=void 0,(()=>{"use strict";var t=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-layout",{staticClass:"dataset-statistic bg-grey-1 shadow-2",attrs:{view:"lHh lpr lFf",container:""}},[i("q-header",[i("topbar",{attrs:{user:t.user}})],1),t._v(" "),i("q-page-container",[i("q-page",{staticClass:"bg-grey-1"},[i("q-tab-panels",{staticClass:"absolute fit",attrs:{animated:""},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"graph"}},[i("statistic-graph",{ref:"statisticGraph"})],1),t._v(" "),i("q-tab-panel",{staticClass:"q-pa-none",attrs:{name:"map"}},[i("statistic-map",{ref:"statisticMap"})],1)],1)],1)],1),t._v(" "),i("q-footer",[i("q-tabs",{staticClass:"bg-grey-8 text-white",attrs:{"inline-label":"",align:"justify","active-bg-color":"grey-7"},on:{input:function(e){return t.InitTabContent()}},model:{value:t.tab,callback:function(e){t.tab=e},expression:"tab"}},[i("q-tab",{attrs:{name:"graph",icon:"bar_chart",label:"統計圖"}}),t._v(" "),t.info&&t.info.enableGPS?i("q-tab",{attrs:{name:"map",icon:"place",label:"地圖"}}):t._e(),t._v(" "),i("q-tab",{attrs:{name:"home",icon:"folder",label:"回資料集"},on:{click:function(e){return t.GoToDataset()}}})],1)],1)],1)};t._withStripped=!0;const e=function(){for(var t=window.location.search.substring(1).split("&"),e={},i=0;i<t.length;i++){var a=t[i].split("=");e[a[0]]=a[1]}return e},a=function(){for(var t=window.location.hash.substr(1).split("&"),e={},i=0;i<t.length;i++){var a=t[i].split("=");e[a[0]]=a[1]}return e},r=function(t,e,i){var a=e-String(t).length+1;return a>0?new Array(a).join(i||"0")+t:t};i(7896);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"topbar bg-grey-8 text-white"},[i("q-toolbar",{staticClass:"q-px-md",attrs:{square:""}},[t.useMenu?i("q-btn",{attrs:{flat:"",round:"",icon:"menu"},on:{click:function(e){return t.ToggleMenu()}}}):t._e(),t._v(" "),i("a",{attrs:{href:"/"}},[i("q-btn",{attrs:{flat:"","no-caps":""}},[i("q-avatar",{attrs:{size:"md",square:""}},[i("img",{attrs:{src:t.logo}})]),t._v(" "),i("div",{staticClass:"gt-xs q-px-md text-white text-h5 inline"},[t._v(t._s(t.title))])],1)],1),t._v(" "),i("q-space"),t._v(" "),t.user?i("q-item",{attrs:{clickable:"",tag:"a",href:"/account"}},[i("q-avatar",{attrs:{size:"lg"}},[i("img",{staticStyle:{"object-fit":"cover"},attrs:{src:t.user.icon}})]),t._v(" "),i("q-item-section",{staticClass:"q-px-sm"},[i("q-item-label",{staticClass:"text-h6"},[t._v(t._s(t.user.name))])],1)],1):i("q-item",{attrs:{clickable:"",tag:"a",href:"/login"}},[i("q-icon",{attrs:{size:"md",name:"account_box"}}),t._v(" "),i("q-item-section",[i("q-item-label",{staticClass:"text-h6"},[t._v("登入")])],1)],1)],1)],1)};n._withStripped=!0;const s={name:"topbar",props:{user:Object,useMenu:Boolean},data:function(){return{title:"",logo:"/static/image/logo.png"}},created:function(){$.get("/site-info",function(t){"ok"==t.status&&(this.title=t.data.title,this.logo=t.data.logo)}.bind(this))},methods:{ToggleMenu:function(){this.$emit("toggleMenu")}}};function l(t,e,i,a,r,n,s,l){var o,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),a&&(c.functional=!0),n&&(c._scopeId="data-v-"+n),s?(o=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},c._ssrRegister=o):r&&(o=l?function(){r.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:r),o)if(c.functional){c._injectStyles=o;var u=c.render;c.render=function(t,e){return o.call(e),u(t,e)}}else{var d=c.beforeCreate;c.beforeCreate=d?[].concat(d,o):[o]}return{exports:t,options:c}}i(4890);const o=l(s,n,[],!1,null,null,null).exports;var c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.dataset&&t.imageArr?i("div",{staticClass:"statistic-graph"},[i("div",{staticClass:"row items-center q-col-gutter-md q-pa-md"},[i("div",{staticClass:"col-12 col-sm-6 column"},[i("div",{staticClass:"text-h6"},[t._v("標註標籤比例")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"tagRatio",staticClass:"graph"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.tagFilter.open,expression:"tagFilter.open"}],staticClass:"option-panel"},[i("image-info-filter",{ref:"tagFilter",attrs:{initFilter:t.tagFilter.filter,disableTag:""},on:{update:function(e){return t.UpdateTagFilterResult()}}}),t._v(" "),i("div",{staticClass:"row justify-center"},[i("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{label:"確定"},on:{click:function(e){t.tagFilter.open=!1}}})],1)],1)]),t._v(" "),i("q-btn",{staticClass:"bg-grey-6 text-white q-my-sm",attrs:{dense:"",label:"篩選"},on:{click:function(e){return t.OpenTagFilter()}}})],1),t._v(" "),i("div",{staticClass:"col-12 col-sm-6 column"},[i("div",{staticClass:"text-h6"},[t._v("資料時間分佈")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"timeline",staticClass:"graph"}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.timelineFilter.open,expression:"timelineFilter.open"}],staticClass:"option-panel"},[i("div",{staticClass:"text-subtitle2"},[t._v("\n\t\t\t\t\t\t顯示類型\n\t\t\t\t\t\t"),i("q-select",{attrs:{dense:"",options:t.typeOption,"option-value":"value","option-label":"label","emit-value":"","map-options":""},on:{input:function(e){return t.UpdateGraphTimeline()}},model:{value:t.timelineFilter.type,callback:function(e){t.$set(t.timelineFilter,"type",e)},expression:"timelineFilter.type"}})],1),t._v(" "),i("image-info-filter",{ref:"timelineFilter",attrs:{initFilter:t.timelineFilter.filter,disableTag:""},on:{update:function(e){return t.UpdateTimelineFilterResult()}}}),t._v(" "),i("div",{staticClass:"row justify-center"},[i("q-btn",{staticClass:"bg-grey-8 text-white",attrs:{label:"確定"},on:{click:function(e){t.timelineFilter.open=!1}}})],1)],1)]),t._v(" "),i("q-btn",{staticClass:"bg-grey-6 text-white q-my-sm",attrs:{dense:"",label:"篩選"},on:{click:function(e){return t.OpenTimelineFilter()}}})],1),t._v(" "),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"text-h6"},[t._v("驗證認同率分佈")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"agreeRate",staticClass:"graph"})])]),t._v(" "),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"text-h6"},[t._v("上傳排行榜")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"uploadRank",staticClass:"graph"})])]),t._v(" "),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"text-h6"},[t._v("標註排行榜")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"annotateRank",staticClass:"graph"})])]),t._v(" "),i("div",{staticClass:"col-12 col-sm-6"},[i("div",{staticClass:"text-h6"},[t._v("驗證排行榜")]),t._v(" "),i("div",{staticClass:"graph-container bg-grey-1"},[i("div",{ref:"verifyRank",staticClass:"graph"})])])])]):t._e()};c._withStripped=!0;var u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"image-info-filter q-pa-sm"},[t.disableTag?t._e():i("div",[i("div",{staticClass:"text-h6"},[t._v("標籤篩選")]),t._v(" "),i("div",{staticClass:"row items-center"},[i("q-checkbox",{staticClass:"text-bold",attrs:{label:"全選"},on:{input:function(e){return t.ToggleTagSelectAll()}},model:{value:t.filter.selectAll,callback:function(e){t.$set(t.filter,"selectAll",e)},expression:"filter.selectAll"}}),t._v(" "),t._l(t.filter.tag,(function(e){return i("q-checkbox",{key:e.name,attrs:{label:e.name},on:{input:function(e){return t.UpdateFilterResult()}},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"tag.value"}})}))],2),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1),t._v(" "),t.disableTime?t._e():i("div",[i("div",{staticClass:"text-h6 q-mb-lg"},[t._v("時間篩選")]),t._v(" "),i("div",{staticClass:"q-px-md"},[i("q-range",{attrs:{min:t.filter.timeLimit.rangeMin,max:t.filter.timeLimit.rangeMax,step:1,"left-label-value":t.minTimeLabel,"right-label-value":t.maxTimeLabel,"left-label-color":"grey-8","right-label-color":"grey-8","label-always":""},on:{change:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.time,callback:function(e){t.$set(t.filter,"time",e)},expression:"filter.time"}})],1),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1),t._v(" "),t.disableLocation?t._e():i("div",[i("div",{staticClass:"row items-center"},[i("div",{staticClass:"text-h6"},[t._v("地點篩選")]),t._v(" "),i("q-btn",{staticClass:"bg-grey-8 text-white q-ma-sm",attrs:{label:"選擇範圍"},on:{click:function(e){return t.OpenRangeSelect()}}})],1),t._v(" "),i("div",{staticClass:"row text-subtitle2 q-gutter-xs"},[i("div",[t._v(t._s(t.filter.loc.enable?"已啟用":"未啟用"))]),t._v(" "),t.filter.loc.enable&&t.filter.loc.lat&&t.filter.loc.lng?i("div",[t._v("中心點: ("+t._s(t.filter.loc.lat.toFixed(5)+" "+t.filter.loc.lng.toFixed(5))+")")]):t._e(),t._v(" "),t.filter.loc.enable&&t.filter.loc.range?i("div",[t._v("範圍:"+t._s(t.filter.loc.range+"公里"))]):t._e()]),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1),t._v(" "),!t.disableForm&&t.dataset&&t.dataset.form?i("div",[i("div",{staticClass:"text-h6"},[t._v("表單篩選")]),t._v(" "),t.dataset.form?i("div",t._l(t.dataset.form.itemArr,(function(e,a){return i("div",[i("div",{staticClass:"text-subtitle2"},[i("q-checkbox",{key:e.quest,attrs:{label:a+1+"."+e.quest},on:{input:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].use,callback:function(i){t.$set(t.filter.form[e.id],"use",i)},expression:"filter.form[item.id].use"}})],1),t._v(" "),t.filter.form[e.id].use?i("div",{staticClass:"q-mx-md"},["text"==e.type?i("div",[i("q-input",{ref:e.id,refInFor:!0,attrs:{dense:"",placeholder:"請輸入篩選文字"},on:{blur:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].value,callback:function(i){t.$set(t.filter.form[e.id],"value",i)},expression:"filter.form[item.id].value"}})],1):t._e(),t._v(" "),"radio"==e.type?i("div",t._l(e.option,(function(a,r){return i("q-radio",{key:a,attrs:{label:a,val:a},on:{input:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].value,callback:function(i){t.$set(t.filter.form[e.id],"value",i)},expression:"filter.form[item.id].value"}})})),1):t._e(),t._v(" "),"checkbox"==e.type?i("div",t._l(e.option,(function(a,r){return i("q-checkbox",{key:a,attrs:{label:a,val:a},on:{input:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].value,callback:function(i){t.$set(t.filter.form[e.id],"value",i)},expression:"filter.form[item.id].value"}})})),1):t._e(),t._v(" "),"number"==e.type?i("div",[i("div",{staticClass:"q-mt-lg q-mx-md"},[i("q-range",{attrs:{min:t.filter.form[e.id].minValue,max:t.filter.form[e.id].maxValue,step:1,"label-always":""},on:{change:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.form[e.id].value,callback:function(i){t.$set(t.filter.form[e.id],"value",i)},expression:"filter.form[item.id].value"}})],1)]):t._e()]):t._e()])})),0):t._e(),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1):t._e(),t._v(" "),t.disableRemark?t._e():i("div",[i("div",{staticClass:"text-h6"},[t._v("備註篩選")]),t._v(" "),i("q-input",{staticClass:"q-ma-sm",attrs:{dense:""},on:{blur:function(e){return t.UpdateFilterResult()}},model:{value:t.filter.remark,callback:function(e){t.$set(t.filter,"remark",e)},expression:"filter.remark"}}),t._v(" "),i("q-separator",{staticClass:"q-my-sm"})],1),t._v(" "),t.imageArr&&t.filterArr?i("div",{staticClass:"row justify-center q-gutter-sm text-red"},[i("div",[t._v("原始資料 "+t._s(t.imageArr.length)+" 筆")]),t._v(" "),i("div",[t._v("篩選後 "+t._s(t.filterArr.length)+" 筆")])]):t._e(),t._v(" "),i("q-dialog",{model:{value:t.openRangeSelect,callback:function(e){t.openRangeSelect=e},expression:"openRangeSelect"}},[i("q-card",{staticClass:"full-width q-pa-sm"},[i("div",{staticClass:"text-h6"},[t._v("選擇範圍")]),t._v(" "),i("q-toggle",{attrs:{"left-label":"",label:"啟用範圍篩選"},on:{input:function(e){return t.UpdateRangeSelectMap()}},model:{value:t.filter.loc.enable,callback:function(e){t.$set(t.filter.loc,"enable",e)},expression:"filter.loc.enable"}}),t._v(" "),i("div",{staticClass:"text-subtitle2"},[t._v("\n\t\t\t\t半徑(公里)\n\t\t\t\t"),i("q-slider",{attrs:{label:"",min:10,max:400},on:{change:function(e){return t.UpdateRangeSelectMap()}},model:{value:t.filter.loc.range,callback:function(e){t.$set(t.filter.loc,"range",e)},expression:"filter.loc.range"}})],1),t._v(" "),i("location-select",{ref:"locationSelect",attrs:{mode:"selectRange"},on:{change:function(e){return t.UpdateLoc()}}}),t._v(" "),t.$refs.locationSelect?i("div",{staticClass:"text-center"},[t._v(t._s(t.$refs.locationSelect.status))]):t._e(),t._v(" "),i("q-card-actions",{attrs:{align:"center"}},[i("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){t.openRangeSelect=!1,t.UpdateFilterResult()}}})],1)],1)],1)],1)};u._withStripped=!0;var d=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"location-select"},[e("div",{ref:"map",staticClass:"map"})])};d._withStripped=!0;const f={name:"location-select",props:{mode:String},components:{},data:function(){return{loc:null,status:"",OnGPSReady:null,map:null,locMarker:null,rangeMarker:null,range:10}},mounted:function(){this.InitMap()},methods:{InitMap:function(){switch(this.map=L.map(this.$refs.map).setView([23.682094,120.7764642],7),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="https://www.openstreetmap.org/">OSM</a>',maxZoom:18}).addTo(this.map),this.mode){case"selectLoc":this.map.on("click",function(t){var e=t.latlng;this.SetPosition(e.lat,e.lng)}.bind(this));break;case"selectRange":this.map.on("click",function(t){var e=t.latlng;this.SetRange(e.lat,e.lng,this.range)}.bind(this))}},SetPosition:function(t,e,i){t&&e&&(this.loc={lat:t,lng:e},this.status="座標: "+t.toFixed(5)+" "+e.toFixed(5),this.locMarker?this.locMarker.setLatLng(this.loc,{draggable:"selectLoc"==this.mode}).bindPopup(this.status).update():(this.locMarker=L.marker(this.loc,{draggable:"selectLoc"==this.mode}),this.locMarker.on("dragend",function(t){var e=this.locMarker.getLatLng();this.SetPosition(e.lat,e.lng)}.bind(this)),this.locMarker.addTo(this.map)),i&&this.map.setView([t,e],12),this.$emit("change"))},SetRange:function(t,e,i){t&&e&&(this.range=i,this.loc={lat:t,lng:e},this.status="座標: "+t.toFixed(5)+" "+e.toFixed(5),this.rangeMarker?(this.rangeMarker.setLatLng(this.loc),this.rangeMarker.setRadius(1e3*this.range)):(this.rangeMarker=L.circle(this.loc,{weight:1,color:"#ff0000",fillColor:"#ff3333",fillOpacity:.3,radius:1e3*this.range}),this.rangeMarker.addTo(this.map)),this.locMarker?this.locMarker.setLatLng(this.loc,{draggable:"selectRange"==this.mode}).bindPopup(this.status).update():(this.locMarker=L.marker(this.loc,{draggable:"selectRange"==this.mode}),this.locMarker.on("drag",function(t){var e=t.target.getLatLng();this.rangeMarker.setLatLng(e)}.bind(this)),this.locMarker.on("dragend",function(t){var e=this.locMarker.getLatLng();this.rangeMarker.setLatLng(e),this.loc={lat:e.lat,lng:e.lng},this.$emit("change")}.bind(this)),this.locMarker.addTo(this.map)),this.$emit("change"))},GetGPS:function(){this.status="無GPS-請點選位置",navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){switch(this.map.setView([t.coords.latitude,t.coords.longitude],12),this.mode){case"selectLoc":this.SetPosition(t.coords.latitude,t.coords.longitude);break;case"selectRange":this.SetRange(t.coords.latitude,t.coords.longitude,this.range)}this.OnGPSReady&&this.OnGPSReady()}.bind(this),function(t){this.status="讀取GPS失敗-請點選位置"}.bind(this)):this.status="瀏覽器不支援GPS-請點選位置"},RemoveMarker:function(){this.locMarker&&(this.map.removeLayer(this.locMarker),this.locMarker=null),this.rangeMarker&&(this.map.removeLayer(this.rangeMarker),this.rangeMarker=null)}}};i(5904);const h=l(f,d,[],!1,null,null,null).exports,m={name:"image-info-filter",props:{disableTag:Boolean,disableTime:Boolean,disableLocation:Boolean,disableRemark:Boolean,disableForm:Boolean,initFilter:Object},components:{"location-select":h},data:function(){return{dataset:null,imageArr:null,filter:{selectAll:!0,tag:[],time:{min:null,max:null},loc:{enable:!1,lat:null,lng:null,range:50},remark:"",timeLimit:{min:null,max:null,rangeMin:0,rangeMax:0},form:{}},openRangeSelect:!1,rangeTarget:null,filterArr:[]}},mounted:function(){this.initFilter&&(this.filter=Object.assign({},this.initFilter)),Vue.nextTick(function(){this.UpdateRangeSelectMap()}.bind(this))},methods:{SetData:function(t,e){this.dataset=t,this.imageArr=e,this.initFilter||(this.InitTimeSelect(),this.InitTagSelect(),this.InitFormSelect()),Vue.nextTick(function(){this.UpdateFilterResult()}.bind(this))},InitTimeSelect:function(){if(!this.disableTime){for(var t=spacetime.now(),e=0;e<this.imageArr.length;e++){var i=spacetime(this.imageArr[e].dataTime).goto(t.timezone().name);this.filter.timeLimit.min&&!this.filter.timeLimit.min.isAfter(i)||(this.filter.timeLimit.min=i.clone().last("day")),this.filter.timeLimit.max&&!this.filter.timeLimit.max.isBefore(i)||(this.filter.timeLimit.max=i.clone().next("day"))}this.filter.timeLimit.min&&this.filter.timeLimit.max&&(this.filter.timeLimit.rangeMin=0,this.filter.timeLimit.rangeMax=this.filter.timeLimit.min.diff(this.filter.timeLimit.max,"day")+1,this.filter.time.min=this.filter.timeLimit.rangeMin,this.filter.time.max=this.filter.timeLimit.rangeMax)}},InitTagSelect:function(){if(!this.disableTag&&this.dataset){this.filter.tag=[],this.filter.tag.push({name:"未標註",value:!0});for(var t=0;t<this.dataset.tagArr.length;t++){var e=this.dataset.tagArr[t];this.filter.tag.push({name:e,value:!0})}}},InitFormSelect:function(){if(this.dataset.form){for(var t={},e=0;e<this.dataset.form.itemArr.length;e++){var i=this.dataset.form.itemArr[e],a={id:i.id,use:!1};if("checkbox"==i.type&&(a.value=[]),"number"==i.type){for(var r=Number.MAX_VALUE,n=Number.MIN_VALUE,s=0;s<this.imageArr.length;s++)if(this.imageArr[s].formReply){var l=this.imageArr[s].formReply[i.id];if(l){var o=parseFloat(l.value);o>n&&(n=o),o<r&&(r=o)}}a.minValue=r,a.maxValue=n}t[i.id]=a}this.filter.form=t}},ToggleTagSelectAll:function(){if(!this.disableTag){for(var t=0;t<this.filter.tag.length;t++)this.filter.tag[t].value=this.filter.selectAll;this.UpdateFilterResult()}},OpenRangeSelect:function(){this.openRangeSelect=!0,Vue.nextTick(function(){this.$refs.locationSelect.range=this.filter.loc.range,this.UpdateRangeSelectMap()}.bind(this))},UpdateRangeSelectMap:function(){if(!this.disableLocation){var t=this.$refs.locationSelect;t&&(t.range=this.filter.loc.range,this.filter.loc.enable?(this.filter.loc.lat&&this.filter.loc.lng||t.GetGPS(),t.SetRange(this.filter.loc.lat,this.filter.loc.lng,this.filter.loc.range)):t.RemoveMarker(),this.UpdateFilterResult())}},UpdateLoc(){if(!this.disableLocation){this.filter.loc.enable=!0;var t=this.$refs.locationSelect.loc;this.filter.loc.lat=t.lat,this.filter.loc.lng=t.lng,this.UpdateFilterResult()}},UpdateFilterResult:function(){if(this.imageArr){var t=this.imageArr;if(!this.disableTag){for(var e={},i=0;i<this.filter.tag.length;i++){var a=this.filter.tag[i];e[a.name]=a.value}t=t.filter(function(t){if(!t.annotation)return e["未標註"];switch(this.dataset.annotationType){case"image":for(var i=t.annotation.annotation,a=0;a<i.length;a++){var r=i[a];if(e[r.name]&&"true"==r.value)return!0}break;case"bbox":var n=t.annotation.annotation;for(a=0;a<n.length;a++)if(r=n[a].tag,e[r])return!0}return!1}.bind(this))}if(!this.disableTime){var r=spacetime.now();t=t.filter(function(t){var e=spacetime(t.dataTime).goto(r.timezone().name),i=this.filter.timeLimit.min.add(this.filter.time.min,"day"),a=this.filter.timeLimit.min.add(this.filter.time.max,"day");return e.isAfter(i)&&e.isBefore(a)}.bind(this))}this.disableLocation||this.filter.loc.enable&&(t=t.filter(function(t){var e=this.filter.loc,i=e.range/111,a=t.lat-e.lat,r=t.lng-e.lng;return a*a+r*r<=i*i}.bind(this))),this.disableForm||(t=t.filter(function(t){if(!this.dataset.form)return!0;for(var e=0;e<this.dataset.form.itemArr.length;e++){var i=this.dataset.form.itemArr[e],a=this.filter.form[i.id];if(a.use){if(!t.formReply||!t.formReply[i.id])return!1;var r=t.formReply[i.id].value;switch(i.type){case"text":if(!a.value)continue;if(-1==a.value.indexOf(r))return!1;break;case"radio":if(a.value!=r)return!1;break;case"checkbox":for(var n=!1,s=0;s<a.value.length;s++)if(r.includes(a.value[s])){n=!0;break}if(!n)return!1;break;case"number":if(!a.value)continue;if(a.value.min>r)return!1;if(a.value.max<r)return!1}}}return!0}.bind(this))),this.disableRemark||(t=t.filter(function(t){return""==this.filter.remark||!!t.remark&&-1!=t.remark.indexOf(this.filter.remark)}.bind(this))),this.filterArr=t,this.$emit("update")}}},computed:{minTimeLabel:function(){return this.disableTime?"":this.filter.timeLimit.min?this.filter.timeLimit.min.add(this.filter.time.min,"day").unixFmt("yyyy-MM-dd"):""},maxTimeLabel:function(){return this.disableTime?"":this.filter.timeLimit.min?this.filter.timeLimit.min.add(this.filter.time.max,"day").unixFmt("yyyy-MM-dd"):""}}};i(5402);const p=l(m,u,[],!1,null,null,null).exports,g={name:"statistic-graph",props:{},components:{"image-info-filter":p},data:function(){return{dataset:null,imageArr:[],tagFilter:{arr:[],open:!1,filter:null},timelineFilter:{type:"time",arr:[],open:!1,filter:null},typeOption:[{label:"時間分佈",value:"time"},{label:"小時變化",value:"hour"},{label:"月份變化",value:"month"}]}},mounted:function(){},methods:{SetGraphData:function(t,e){this.dataset=t,this.imageArr=e,this.tagFilter.arr=e,this.timelineFilter.arr=e,Vue.nextTick(function(){this.UpdateGraph()}.bind(this))},OpenTagFilter:function(){this.tagFilter.open=!0,Vue.nextTick(function(){this.$refs.tagFilter.SetData(this.dataset,this.imageArr)}.bind(this))},OpenTimelineFilter:function(){this.timelineFilter.open=!0,Vue.nextTick(function(){this.$refs.timelineFilter.SetData(this.dataset,this.imageArr)}.bind(this))},UpdateTagFilterResult:function(){var t=this.$refs.tagFilter;this.tagFilter.filter=t.filter,this.tagFilter.arr=t.filterArr,this.UpdateGraphTag()},UpdateTimelineFilterResult:function(){var t=this.$refs.timelineFilter;this.timelineFilter.filter=Object.assign({type:this.timelineFilter.type},t.filter),this.timelineFilter.arr=t.filterArr,this.UpdateGraphTimeline()},UpdateGraph:function(){this.UpdateGraphTag(),this.UpdateGraphTimeline(),this.UpdateGraphUploadRank(),this.UpdateGraphAgreeRate(),this.UpdateGraphAnnotateRank(),this.UpdateGraphVerifyRank()},UpdateGraphTag:function(){var t=this.tagFilter.arr,e={};switch(this.dataset.annotationType){case"image":for(var i=0;i<t.length;i++){var a=[];if((s=t[i]).annotation)for(var r=0;r<s.annotation.annotation.length;r++)"true"==(n=s.annotation.annotation[r]).value&&a.push(n.name);else a=["未標註"];for(r=0;r<a.length;r++){var n=a[r];e[n]?e[n].value++:e[n]={name:n,value:1}}}break;case"bbox":for(i=0;i<t.length;i++){var s,l;for(l=(s=t[i]).annotation?s.annotation.annotation:[{tag:"未標註"}],r=0;r<l.length;r++)n=l[r].tag,e[n]?e[n].value++:e[n]={name:n,value:1}}}if(0==(a=Object.keys(e).sort((function(t,i){return e[t].value-e[i].value}))).length)return Plotly.purge(this.$refs.tagRatio);var o={values:a.map((function(t){return e[t].value})),labels:a,type:"pie"};Plotly.newPlot(this.$refs.tagRatio,[o],{paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:40,r:40,b:40,t:40}},{displayModeBar:!1})},UpdateGraphTimeline:function(){var t=this.timelineFilter,e=this.timelineFilter.arr,i=spacetime().name,a={},n="",s={fixedrange:!1};switch(t.type){case"time":n="yyyy-MM-dd",s.tickformat="%Y-%m-%d";break;case"hour":n="HH",s.title="小時變化",s.tickformat=".0f";break;case"month":n="MM",s.title="月份變化",s.tickformat=".0f"}switch(this.dataset.annotationType){case"image":for(var l=0;l<e.length;l++){var o=[];if((d=e[l]).annotation)for(var c=0;c<d.annotation.annotation.length;c++)"true"==(v=d.annotation.annotation[c]).value&&o.push(v.name);else o=["未標註"];var u=(g=spacetime(d.dataTime).goto(i)).unixFmt(n);for(c=0;c<o.length;c++)a[v=o[c]]||(a[v]={}),a[v][u]?a[v][u].value++:a[v][u]={key:u,value:1}}break;case"bbox":for(l=0;l<e.length;l++){var d,f;for(f=(d=e[l]).annotation?d.annotation.annotation:[{tag:"未標註"}],u=(g=spacetime(d.dataTime).goto(i)).unixFmt(n),c=0;c<f.length;c++)a[v=f[c].tag]||(a[v]={}),a[v][u]?a[v][u].value++:a[v][u]={key:u,value:1}}}var h,m,p=spacetime.now();for(l=0;l<e.length;l++){var g=spacetime(e[l].dataTime,p.timezone().name);h&&!h.isAfter(g)||(h=g.clone().last("day")),m&&!m.isBefore(g)||(m=g.clone().next("day"))}for(var v in a)switch(t.type){case"time":for(var b=h;b.isBefore(m);){var x=b.unixFmt(n);a[v][x]||(a[v][x]={key:x,value:0}),b=b.add(1,"day")}break;case"hour":for(l=0;l<24;l++)x=r(l,2),a[v][x]||(a[v][x]={key:x,value:0});break;case"month":for(l=1;l<=12;l++)x=r(l,2),a[v][x]||(a[v][x]={key:x,value:0})}if(0==(o=Object.keys(a)).length)return Plotly.purge(this.$refs.timeline);var y=[];for(l=0;l<o.length;l++){var _=a[o[l]],k=Object.keys(_).sort((function(t,e){return t<e?-1:t>e?1:0})),w={x:k,y:k.map((function(t){return _[t].value})),name:o[l],type:"scatter"};y.push(w)}var C={hovermode:"closest",xaxis:s,yaxis:{fixedrange:!1,title:"標籤數"},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:60,r:40,b:60,t:40}};Plotly.newPlot(this.$refs.timeline,y,C,{displayModeBar:!0})},UpdateGraphAgreeRate:function(){for(var t=[],e=0;e<=1;e+=.1)t.push({x:e,y:0});for(e=0;e<this.imageArr.length;e++){var i=this.imageArr[e];if(i.verification.length>0){for(var a=0,r=0;r<i.verification.length;r++)"1"==i.verification[r].agree&&(a+=1);a/=i.verification.length,t[parseInt(10*a)].y++}}var n={type:"bar",x:t.map((function(t){return t.x})),y:t.map((function(t){return t.y}))};Plotly.newPlot(this.$refs.agreeRate,[n],{xaxis:{tickformat:"%",fixedrange:!0,title:"認同率"},yaxis:{fixedrange:!0,title:"影像數"},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:80,r:40,b:80,t:40}},{displayModeBar:!1})},UpdateGraphUploadRank:function(){for(var t={},e=0;e<this.imageArr.length;e++){var i=this.imageArr[e];i.uploader&&"user"==i.uploadFrom&&(t[i.uploader]?t[i.uploader].value++:t[i.uploader]={value:1})}var a=Object.keys(t).sort((function(e,i){return t[i].value-t[e].value})).slice(0,10);$.get("/user/list-name?id="+a.join(","),function(e){if("ok"==e.status){for(var i={},r=0;r<e.data.length;r++){var n=e.data[r];n.name in i?(n.name+=i[n.name],i[n.name]++):i[n.name]=1,t[n._id].name=n.name}var s={type:"bar",x:a.map((function(e){return t[e].value})),y:a.map((function(e){return t[e].name})),orientation:"h"};Plotly.newPlot(this.$refs.uploadRank,[s],{xaxis:{fixedrange:!0,title:"影像數"},yaxis:{autorange:"reversed",fixedrange:!0,title:""},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:80,r:40,b:80,t:40}},{displayModeBar:!1})}}.bind(this))},UpdateGraphAnnotateRank:function(){for(var t={},e=0;e<this.imageArr.length;e++){var i=this.imageArr[e];if(i.annotation){var a=i.annotation.user;t[a]?t[a].value++:t[a]={value:1}}}var r=Object.keys(t).sort((function(e,i){return t[i].value-t[e].value})).slice(0,10);$.get("/user/list-name?id="+r.join(","),function(e){if("ok"==e.status){for(var i={},a=0;a<e.data.length;a++){var n=e.data[a];n.name in i?(n.name+=i[n.name],i[n.name]++):i[n.name]=1,t[n._id].name=n.name}var s={type:"bar",x:r.map((function(e){return t[e].value})),y:r.map((function(e){return t[e].name})),orientation:"h"};Plotly.newPlot(this.$refs.annotateRank,[s],{xaxis:{fixedrange:!0,title:"影像數"},yaxis:{autorange:"reversed",fixedrange:!0,title:""},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:80,r:40,b:80,t:40}},{displayModeBar:!1})}}.bind(this))},UpdateGraphVerifyRank:function(){for(var t={},e=0;e<this.imageArr.length;e++){var i=this.imageArr[e];if(i.verification.length>0)for(var a=0;a<i.verification.length;a++){var r=i.verification[a].user;t[r]?t[r].value++:t[r]={value:1}}}var n=Object.keys(t).sort((function(e,i){return t[i].value-t[e].value})).slice(0,10);$.get("/user/list-name?id="+n.join(","),function(e){if("ok"==e.status){for(var i={},a=0;a<e.data.length;a++){var r=e.data[a];r.name in i?(r.name+=i[r.name],i[r.name]++):i[r.name]=1,t[r._id].name=r.name}var s={type:"bar",x:n.map((function(e){return t[e].value})),y:n.map((function(e){return t[e].name})),orientation:"h"};Plotly.newPlot(this.$refs.verifyRank,[s],{xaxis:{fixedrange:!0,title:"影像數"},yaxis:{autorange:"reversed",fixedrange:!0,title:""},paper_bgcolor:"rgba(250,250,250,1)",plot_bgcolor:"rgba(250,250,250,1)",margin:{l:80,r:40,b:80,t:40}},{displayModeBar:!1})}}.bind(this))}}};i(1218);const v=l(g,c,[],!1,null,null,null).exports;var b=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"statistic-map"},[i("div",{ref:"map",staticClass:"map"}),t._v(" "),i("q-page-sticky",{staticClass:"z-top",attrs:{position:"bottom-left",offset:[18,18]}},[i("q-btn",{staticClass:"bg-primary text-white",attrs:{flat:"",round:"",size:"md",icon:"insert_chart",disable:null==t.dataset||0==t.imageArr.length},on:{click:function(e){return t.OpenFilterPanel()}}},[i("q-tooltip",{attrs:{"content-class":"bg-primary"}},[t._v("資料篩選")])],1)],1),t._v(" "),i("q-dialog",{model:{value:t.openFilterPanel,callback:function(e){t.openFilterPanel=e},expression:"openFilterPanel"}},[i("q-card",{staticClass:"full-width q-px-md"},[i("q-card-section",{staticClass:"column"},[i("image-info-filter",{ref:"imageInfoFilter",attrs:{initFilter:t.curFilter},on:{update:function(e){return t.UpdateFilterResult()}}})],1),t._v(" "),i("q-card-actions",{attrs:{align:"center"}},[i("q-btn",{attrs:{flat:"",label:"確定"},on:{click:function(e){t.openFilterPanel=!1}}})],1)],1)],1)],1)};b._withStripped=!0;const x={name:"statistic-map",props:{},components:{"image-info-filter":p},data:function(){return{map:null,openFilterPanel:!1,markerGroup:null,dataset:null,imageArr:[],filterArr:[],curFilter:null,rangeMarker:null}},created:function(){Vue.nextTick(function(){this.InitMap()}.bind(this))},methods:{InitMap:function(){this.map=L.map(this.$refs.map).setView([23.682094,120.7764642],7),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="https://www.openstreetmap.org/">OSM</a>',maxZoom:18}).addTo(this.map),this.markerGroup=L.markerClusterGroup(),this.map.addLayer(this.markerGroup)},SetGraphData:function(t,e){this.dataset=t,this.imageArr=e,this.filterArr=e,Vue.nextTick(function(){this.UpdateMap()}.bind(this))},OpenFilterPanel:function(){this.openFilterPanel=!0,Vue.nextTick(function(){this.$refs.imageInfoFilter.SetData(this.dataset,this.imageArr)}.bind(this))},UpdateFilterResult:function(){var t=this.$refs.imageInfoFilter;this.curFilter=t.filter,this.filterArr=t.filterArr,this.UpdateMap()},UpdateMap:function(){this.ClearMarker();for(var t=this.filterArr,e=0;e<t.length;e++){var i=t[e];if(i.lat&&i.lng){var a="<div class='tag'>";if(i.annotation)switch(this.dataset.annotationType){case"image":for(var r=i.annotation.annotation,n=0;n<r.length;n++)"true"==(o=r[n]).value&&(a+="#"+o.name+" ");break;case"bbox":var s=i.annotation.annotation,l={};for(n=0;n<s.length;n++){var o=s[n].tag;l[o]?l[o]++:l[o]=1}a+=Object.keys(l).map((function(t){return t+":"+l[t]})).join("<br>")}else a+="未標註";a+="</div>",i.remark&&(a+="<div class='remark'>"+i.remark+"</div>");var c="";c+="<a href='/image?dataset="+this.dataset._id+"&image="+i._id+"' target='_blank'>",c+="<img src='"+i.url+"' class='popup-image' />",c+="</a>",c+="<div class='popup-info'>"+a+"</div>",c+="<div class='popup-bt' onclick=\"window.open('"+(f="/image?dataset="+this.dataset._id+"&image="+i._id)+"','_blank');\">前往影像</div>";var u=spacetime().name,d=spacetime(i.dataTime).goto(u);switch(d=d.subtract(d.minute()%10,"minute"),this.dataset.externalLink){case"riverlog":var f="https://riverlog.lass-net.org/";f+="#year="+d.year(),f+="&date="+d.unixFmt("MM-dd"),f+="&time="+d.unixFmt("HH:mm"),f+="&lat="+i.lat,f+="&lng="+i.lng,c+="<div class='popup-bt' onclick=\"window.open('"+(f+="&zoom=12")+"','_blank');\">前往山河事件簿</div>";break;case"purbao":f="https://purbao.lass-net.org/",f+="?year="+d.year(),f+="&date="+d.unixFmt("M/d"),f+="&lat="+i.lat,f+="&lng="+i.lng,c+="<div class='popup-bt'  onclick=\"window.open('"+(f+="&zoom=12")+"','_blank');\">前往紫豹在哪裡</div>"}var h=L.marker({lat:i.lat,lng:i.lng}).bindPopup(c);this.markerGroup.addLayer(h)}}if(this.curFilter){var m=this.curFilter.loc;m.enable&&m.lat&&m.lng&&m.range&&(this.rangeMarker=L.circle(m,{weight:1,fillOpacity:0,color:"#ff0000",dashArray:"10, 10",radius:1e3*m.range}),this.rangeMarker.addTo(this.map))}},ClearMarker:function(){this.markerGroup.clearLayers(),this.rangeMarker&&(this.map.removeLayer(this.rangeMarker),this.rangeMarker=null)}}};i(7460);const y={name:"dataset-statistic",components:{topbar:o,"statistic-graph":v,"statistic-map":l(x,b,[],!1,null,null,null).exports},data:function(){return{tab:"graph",user:null,datasetID:null,info:null,imageArr:[]}},created:function(){var t=e();this.datasetID=t.id;var i=a();i.tab&&(this.tab=i.tab),$.get("/user/info",function(t){"ok"==t.status&&(this.user=t.data)}.bind(this)),$.get("/dataset/view-dataset?id="+t.id,function(e){if("ok"!=e.status)return window.location.href="/?message="+encodeURIComponent("無法取得資料集資訊");this.info=e.data,this.info.enableGPS&&!i.tab&&(this.tab="map"),$.get("/dataset/list-image?all=1&dataset="+t.id,function(e){if("ok"!=e.status)return window.location.href="/?message="+encodeURIComponent("無法取得影像資訊");this.imageArr=e.data;for(var i=0;i<this.imageArr.length;i++){var a=this.imageArr[i];a.url="/static/upload/dataset/"+t.id+"/image/"+a._id+".jpg"}this.InitTabContent()}.bind(this))}.bind(this))},methods:{GoToDataset:function(){window.location.href="/dataset?id="+this.datasetID},InitTabContent:function(){Vue.nextTick(function(){switch(window.location.hash="#tab="+this.tab,this.tab){case"graph":this.$refs.statisticGraph.SetGraphData(this.info,this.imageArr);break;case"map":this.$refs.statisticMap.SetGraphData(this.info,this.imageArr)}}.bind(this))}}};i(7345);const _=l(y,t,[],!1,null,null,null).exports;new Vue({el:"#statisticApp",components:{"dataset-statistic":_}})})()})();